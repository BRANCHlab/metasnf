<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Label propagate cluster solutions to unclustered observations — label_propagate • metasnf</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Label propagate cluster solutions to unclustered observations — label_propagate"><meta name="description" content="Given a solutions data frame containing clustered observations and a
data list containing those clustered observations as well as additional
to-be-clustered observations, this function will re-run SNF to generate a
similarity matrix of all observations and use the label propagation
algorithm to assigned predicted clusters to the unclustered observations."><meta property="og:description" content="Given a solutions data frame containing clustered observations and a
data list containing those clustered observations as well as additional
to-be-clustered observations, this function will re-run SNF to generate a
similarity matrix of all observations and use the label propagation
algorithm to assigned predicted clusters to the unclustered observations."><meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a></li>
    <li><a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BRANCHlab/metasnf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Label propagate cluster solutions to unclustered observations</h1>
      <small class="dont-index">Source: <a href="https://github.com/BRANCHlab/metasnf/blob/main/R/label_propagation.R" class="external-link"><code>R/label_propagation.R</code></a></small>
      <div class="d-none name"><code>label_propagate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a solutions data frame containing clustered observations and a
data list containing those clustered observations as well as additional
to-be-clustered observations, this function will re-run SNF to generate a
similarity matrix of all observations and use the label propagation
algorithm to assigned predicted clusters to the unclustered observations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">label_propagate</span><span class="op">(</span><span class="va">partial_sol_df</span>, <span class="va">full_dl</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-partial-sol-df">partial_sol_df<a class="anchor" aria-label="anchor" href="#arg-partial-sol-df"></a></dt>
<dd><p>A solutions data frame derived from the training set.</p></dd>


<dt id="arg-full-dl">full_dl<a class="anchor" aria-label="anchor" href="#arg-full-dl"></a></dt>
<dd><p>A data list containing observations from both the training
and testing sets.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>If TRUE, output progress to console.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with one row per observation containing a column for
UIDs, a column for whether the observation was in the train (original) or test
(held out) set, and one column per row of the solutions data frame
indicating the original and propagated clusters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Function to identify obervations with complete data</span></span></span>
<span class="r-in"><span><span class="co">#uids_with_complete_obs &lt;- get_complete_uids(</span></span></span>
<span class="r-in"><span><span class="co">#    list(subc_v, income, pubertal, anxiety, depress),</span></span></span>
<span class="r-in"><span><span class="co">#    uid = "unique_id"</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Dataframe assigning 80% of observations to train and 20% to test</span></span></span>
<span class="r-in"><span><span class="co">#train_test_split &lt;- train_test_assign(</span></span></span>
<span class="r-in"><span><span class="co">#    train_frac = 0.8,</span></span></span>
<span class="r-in"><span><span class="co">#    uids = uids_with_complete_obs</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Pulling the training and testing observations specifically</span></span></span>
<span class="r-in"><span><span class="co">#train_obs &lt;- train_test_split$"train"</span></span></span>
<span class="r-in"><span><span class="co">#test_obs &lt;- train_test_split$"test"</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Partition a training set</span></span></span>
<span class="r-in"><span><span class="co">#train_subc_v &lt;- subc_v[subc_v$"unique_id" %in% train_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#train_income &lt;- income[income$"unique_id" %in% train_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#train_pubertal &lt;- pubertal[pubertal$"unique_id" %in% train_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#train_anxiety &lt;- anxiety[anxiety$"unique_id" %in% train_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#train_depress &lt;- depress[depress$"unique_id" %in% train_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Partition a test set</span></span></span>
<span class="r-in"><span><span class="co">#test_subc_v &lt;- subc_v[subc_v$"unique_id" %in% test_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#test_income &lt;- income[income$"unique_id" %in% test_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#test_pubertal &lt;- pubertal[pubertal$"unique_id" %in% test_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#test_anxiety &lt;- anxiety[anxiety$"unique_id" %in% test_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#test_depress &lt;- depress[depress$"unique_id" %in% test_obs, ]</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Find cluster solutions in the training set</span></span></span>
<span class="r-in"><span><span class="co">#train_dl &lt;- data_list(</span></span></span>
<span class="r-in"><span><span class="co">#    list(train_subc_v, "subc_v", "neuroimaging", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    list(train_income, "household_income", "demographics", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    list(train_pubertal, "pubertal_status", "demographics", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    uid = "unique_id"</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## We'll pick a solution that has good separation over our target features</span></span></span>
<span class="r-in"><span><span class="co">#train_target_dl &lt;- data_list(</span></span></span>
<span class="r-in"><span><span class="co">#    list(train_anxiety, "anxiety", "behaviour", "ordinal"),</span></span></span>
<span class="r-in"><span><span class="co">#    list(train_depress, "depressed", "behaviour", "ordinal"),</span></span></span>
<span class="r-in"><span><span class="co">#    uid = "unique_id"</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#sc &lt;- snf_config(</span></span></span>
<span class="r-in"><span><span class="co">#    train_dl,</span></span></span>
<span class="r-in"><span><span class="co">#    n_solutions = 5,</span></span></span>
<span class="r-in"><span><span class="co">#    min_k = 10,</span></span></span>
<span class="r-in"><span><span class="co">#    max_k = 30</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#train_sol_df &lt;- batch_snf(</span></span></span>
<span class="r-in"><span><span class="co">#    train_dl,</span></span></span>
<span class="r-in"><span><span class="co">#    sc,</span></span></span>
<span class="r-in"><span><span class="co">#    return_sim_mats = TRUE</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#ext_sol_df &lt;- extend_solutions(</span></span></span>
<span class="r-in"><span><span class="co">#    train_sol_df,</span></span></span>
<span class="r-in"><span><span class="co">#    train_target_dl</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Determining solution with the lowest minimum p-value</span></span></span>
<span class="r-in"><span><span class="co">#lowest_min_pval &lt;- min(ext_sol_df$"min_pval")</span></span></span>
<span class="r-in"><span><span class="co">#which(ext_sol_df$"min_pval" == lowest_min_pval)</span></span></span>
<span class="r-in"><span><span class="co">#top_row &lt;- ext_sol_df[1, ]</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Propagate that solution to the observations in the test set</span></span></span>
<span class="r-in"><span><span class="co">## data list below has both training and testing observations</span></span></span>
<span class="r-in"><span><span class="co">#full_dl &lt;- data_list(</span></span></span>
<span class="r-in"><span><span class="co">#    list(subc_v, "subc_v", "neuroimaging", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    list(income, "household_income", "demographics", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    list(pubertal, "pubertal_status", "demographics", "continuous"),</span></span></span>
<span class="r-in"><span><span class="co">#    uid = "unique_id"</span></span></span>
<span class="r-in"><span><span class="co">#)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## Use the solutions data frame from the training observations and the data list</span></span></span>
<span class="r-in"><span><span class="co">## from the training and testing observations to propagate labels to the test observations</span></span></span>
<span class="r-in"><span><span class="co">#propagated_labels &lt;- label_propagate(top_row, full_dl)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#propagated_labels_all &lt;- label_propagate(ext_sol_df, full_dl)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">#head(propagated_labels_all)</span></span></span>
<span class="r-in"><span><span class="co">#tail(propagated_labels_all)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth S Velayudhan, Xiaoqiao Xu, Prajkta Kallurkar, Ana Patricia Balbon, Maria T Secara, Adam Taback, Denise Sabac, Nicholas Chan, Shihao Ma, Bo Wang, Daniel Felsky, Stephanie H Ameis, Brian Cox, Colin Hawco, Lauren Erdman, Anne L Wheeler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

