<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>Feature Weighting • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Feature Weighting">
<meta property="og:description" content="metasnf">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Example workflows</h6>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_less_simple_example.html">A Less Simple Example</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Essentials</h6>
    <a class="dropdown-item" href="../articles/settings_matrix.html">The Settings Matrix</a>
    <a class="dropdown-item" href="../articles/data_list.html">The Data List</a>
    <a class="dropdown-item" href="../articles/snf_schemes.html">SNF schemes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Further customization</h6>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/clustering_algorithms.html">Clustering Algorithms</a>
    <a class="dropdown-item" href="../articles/feature_weights.html">Feature Weights</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Additional functionality</h6>
    <a class="dropdown-item" href="../articles/stability_measures.html">Stability Measures and Consensus Clustering</a>
    <a class="dropdown-item" href="../articles/confounders.html">Confounders and Unwanted Signal</a>
    <a class="dropdown-item" href="../articles/parallel_processing.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/label_propagation.html">Label propagation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plotting</h6>
    <a class="dropdown-item" href="../articles/similarity_matrix_heatmap.html">Similarity Matrix Heatmaps</a>
    <a class="dropdown-item" href="../articles/manhattan_plots.html">Manhattan Plots</a>
    <a class="dropdown-item" href="../articles/alluvial_plots.html">Alluvial Plots</a>
    <a class="dropdown-item" href="../articles/correlation_plots.html">Correlation Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Feature Weighting</h1>
            
      
      
      <div class="d-none name"><code>feature_weights.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/feature_weights.Rmd" class="external-link">feature_weights.Rmd</a></p>
<div class="section level2">
<h2 id="generating-and-using-the-weights-matrix">Generating and Using the Weights Matrix<a class="anchor" aria-label="anchor" href="#generating-and-using-the-weights-matrix"></a>
</h2>
<p>The <a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics</a> used in metasnf are all capable of applying custom weights
to included features. The code below outlines how to generate and use a
weights_matrix (dataframe containing feature weights) object.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make sure to throw in all the data you're interested in visualizing for this</span></span>
<span><span class="co"># data_list, including out-of-model measures and confounding variables.</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_colour</span>, <span class="st">"favourite_colour"</span>, <span class="st">"demographics"</span>, <span class="st">"categorical"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_dl.html">summarize_dl</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;               name        type       domain length width</span></span>
<span><span class="co">#&gt; 1 household_income     ordinal demographics    136     2</span></span>
<span><span class="co">#&gt; 2  pubertal_status  continuous demographics    136     2</span></span>
<span><span class="co">#&gt; 3 favourite_colour categorical demographics    136     2</span></span>
<span><span class="co">#&gt; 4          anxiety     ordinal    behaviour    136     2</span></span>
<span><span class="co">#&gt; 5        depressed     ordinal    behaviour    136     2</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span>
<span></span>
<span><span class="va">weights_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_weights_matrix.html">generate_weights_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">weights_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt;      household_income pubertal_status colour cbcl_anxiety_r cbcl_depress_r</span></span>
<span><span class="co">#&gt; [1,]                1               1      1              1              1</span></span>
<span><span class="co">#&gt; [2,]                1               1      1              1              1</span></span>
<span><span class="co">#&gt; [3,]                1               1      1              1              1</span></span>
<span><span class="co">#&gt; [4,]                1               1      1              1              1</span></span>
<span><span class="co">#&gt; [5,]                1               1      1              1              1</span></span>
<span><span class="co">#&gt; [6,]                1               1      1              1              1</span></span></code></pre></div>
<p>By default, the weights are all 1. This is what
<code>batch_snf</code> uses when no weights_matrix is supplied.</p>
<p>If you have custom feature weights you’d like to be used you can
manually populate this dataframe. There’s one column per variable (no
need to worry about column orders) and the number of rows should match
the number of rows in the settings_matrix.</p>
<p>If you are just looking to broaden the space of cluster solutions you
generate, you can use some of the built-in randomization options for the
weights:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Random uniformly distributed values</span></span>
<span><span class="fu"><a href="../reference/generate_weights_matrix.html">generate_weights_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"uniform"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      household_income pubertal_status    colour cbcl_anxiety_r cbcl_depress_r</span></span>
<span><span class="co">#&gt; [1,]       0.08161542       0.3198375 0.8328815      0.9943410      0.3955367</span></span>
<span><span class="co">#&gt; [2,]       0.40378037       0.4627980 0.3132912      0.7119147      0.9593465</span></span>
<span><span class="co">#&gt; [3,]       0.83551451       0.9353873 0.2794196      0.4951427      0.1132382</span></span>
<span><span class="co">#&gt; [4,]       0.59499701       0.5917005 0.7100717      0.8079317      0.2355968</span></span>
<span><span class="co">#&gt; [5,]       0.35140389       0.5460431 0.3481677      0.5611197      0.5104740</span></span>
<span></span>
<span><span class="co"># Random exponentially distributed values</span></span>
<span><span class="fu"><a href="../reference/generate_weights_matrix.html">generate_weights_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"exponential"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;      household_income pubertal_status    colour cbcl_anxiety_r cbcl_depress_r</span></span>
<span><span class="co">#&gt; [1,]        0.5123907       0.1624127 1.6042481      3.7447548     1.53441037</span></span>
<span><span class="co">#&gt; [2,]        3.9471338       0.4178442 0.2354796      0.3647522     0.22186034</span></span>
<span><span class="co">#&gt; [3,]        0.4215409       0.2394908 0.1519102      0.8262260     0.03348363</span></span>
<span><span class="co">#&gt; [4,]        1.4107604       2.3230736 2.0428148      0.2279961     0.48877057</span></span>
<span><span class="co">#&gt; [5,]        0.1756311       0.5256458 1.3623835      0.1072554     0.24304379</span></span></code></pre></div>
<p>Once you’re happy with your weights_matrix, you can pass it into
batch_snf:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    settings_matrix <span class="op">=</span> <span class="va">settings_matrix</span>,</span>
<span>    weights_matrix <span class="op">=</span> <span class="va">weights_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-nitty-gritty-of-how-weights-are-used">The Nitty Gritty of How Weights are Used<a class="anchor" aria-label="anchor" href="#the-nitty-gritty-of-how-weights-are-used"></a>
</h2>
<p>The specific implementation of the weights during distance matrix
calculations is dependent on the distance metric used, which you can
learn more about in the <a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics vignette</a>.</p>
<p>The other aspect to understand if you want to know precisely how your
weights are being used is related to the SNF schemes. Depending on which
scheme is specified in the settings_matrix row, the variable columns
that are involved at each distance matrix calculation can differ
substantially.</p>
<p>For example, in the domain scheme, all variables of the same domain
are concatenated prior to distance matrix calculation. If you have any
domains with multiple types of variables (e.g., continuous and
categorical), that will mean that the mixed distance metric (Gower’s
method by default) will be used, and weights will be applied but only on
a per-domain basis.</p>
<p>Here’s a more concrete example on how data set-up and SNF scheme can
influence the variable weighting process: consider generating a
data_list where every single input dataframe contains only 1 input
variable. If that data_list is processed exclusively using the
“individual” SNF scheme, <em>feature weights won’t matter</em>. This is
because the individual SNF scheme calculates individual distance metrics
for every input dataframe separately before fusing them together with
SNF. Anytime a distance matrix is calculated, it’ll be for a single
variable only, and the purpose of feature weighting (changing the
relative contributions of input variables during the distance matrix
calculations) will be lost.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
