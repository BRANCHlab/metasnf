<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>Distance Metrics • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Distance Metrics">
<meta property="og:description" content="metasnf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/metasnf-vignette.html">An example metasnf pipeline</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Distance Metrics</h1>
            
      
      
      <div class="d-none name"><code>distance_metrics.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<div class="section level2">
<h2 id="the-distance_metrics_list">The distance_metrics_list<a class="anchor" aria-label="anchor" href="#the-distance_metrics_list"></a>
</h2>
<p>r-package enables users to customize what distance metrics are used
in the SNF pipeline. All information about distance metrics are stored
in a <code>distance_metrics_list</code> object.</p>
<p>By default, <code>batch_snf</code> will create its own
<code>distance_metrics_list</code> by calling the
<code>generate_distance_metrics_list</code> function with no additional
arguments.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">distance_metrics_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The list is a list of functions (<code><a href="../reference/euclidean_distance.html">euclidean_distance()</a></code>
and <code><a href="../reference/gower_distance.html">gower_distance()</a></code>), and printing them out directly can
be messy. The <code><a href="../reference/summarize_distance_metrics_list.html">summarize_distance_metrics_list()</a></code> function
prints the object with a nicer format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_distance_metrics_list.html">summarize_distance_metrics_list</a></span><span class="op">(</span><span class="va">distance_metrics_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Continuous distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrete distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ordinal distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Categorical distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mixed distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span></code></pre></div>
<p>These lists must always contain at least 1 distance metric for each
of the 5 recognized types of variables: continuous, discrete, ordinal,
categorical, and mixed (any combination of the previous four).</p>
<p>By default, continuous, discrete, and ordinal data are converted to
distance matrices using simple Euclidean distance. Categorical and mixed
data are handled using Gower’s formula as implemented by the cluster
package (see <code><a href="https://rdrr.io/pkg/cluster/man/daisy.html" class="external-link">?cluster::daisy</a></code>).</p>
</div>
<div class="section level2">
<h2 id="how-the-distance_metrics_list-is-used">How the distance_metrics_list is used<a class="anchor" aria-label="anchor" href="#how-the-distance_metrics_list-is-used"></a>
</h2>
<p>To show how the distance_metrics_list is used, we’ll start by
extending our distance_metrics_list beyond just the default options.
r-package provides a Euclidean distance function that applies standard
normalization first, <code><a href="../reference/sn_euclidean_distance.html">sn_euclidean_distance()</a></code> (a wrapper
around <code><a href="https://rdrr.io/pkg/SNFtool/man/standardNormalization.html" class="external-link">SNFtool::standardNormalization</a></code>). Here’s how we can
create a custom distance_metrics_list that includes this metric for
continuous and discrete variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_distance_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list</a></span><span class="op">(</span></span>
<span>    continuous_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_distance_metrics_list.html">summarize_distance_metrics_list</a></span><span class="op">(</span><span class="va">my_distance_metrics</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Continuous distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance </span></span>
<span><span class="co">#&gt; 2. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrete distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance </span></span>
<span><span class="co">#&gt; 2. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ordinal distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Categorical distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mixed distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span></code></pre></div>
<p>Now, during settings_matrix generation, we can provide our
distance_metrics_list to ensure our new distance metrics will be used on
some of our SNF runs.</p>
<p>Before making the settings_matrix, we’ll quickly need to setup some
data (as was done in <a href="https://branchlab.github.io/metasnf/articles/a_simple_example.html">A
Simple Example</a>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SNFtool</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Data1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Data2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Data1</span><span class="op">$</span><span class="st">"patient_id"</span> <span class="op">&lt;-</span> <span class="fl">101</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Data1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">Data2</span><span class="op">$</span><span class="st">"patient_id"</span> <span class="op">&lt;-</span> <span class="fl">101</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Data2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Data1</span>, <span class="st">"genes_1_and_2_exp"</span>, <span class="st">"gene_expression"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Data2</span>, <span class="st">"genes_1_and_2_meth"</span>, <span class="st">"gene_methylation"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "UID successfully converted to subjectkey."</span></span></code></pre></div>
<p>And then the settings_matrix can be generated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    distance_metrics_list <span class="op">=</span> <span class="va">my_distance_metrics</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># showing just the columns that are related to distances</span></span>
<span><span class="va">settings_matrix</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cont_dist disc_dist ord_dist cat_dist mix_dist</span></span>
<span><span class="co">#&gt; 1          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 2          2         2        1        1        1</span></span>
<span><span class="co">#&gt; 3          1         1        1        1        1</span></span>
<span><span class="co">#&gt; 4          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 5          2         2        1        1        1</span></span>
<span><span class="co">#&gt; 6          2         2        1        1        1</span></span>
<span><span class="co">#&gt; 7          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 8          2         2        1        1        1</span></span>
<span><span class="co">#&gt; 9          1         1        1        1        1</span></span>
<span><span class="co">#&gt; 10         2         2        1        1        1</span></span></code></pre></div>
<p>The continuous and discrete distance metrics values randomly
fluctuate between 1 and 2, where 1 means that the first metric
(<code><a href="../reference/euclidean_distance.html">euclidean_distance()</a></code>) will be used and 2 means that the
second metric (<code>sn_euclidean_distance</code>) will be used.</p>
<p>It’s important to note that the settings_matrix itself <strong>does
not store the distance metrics</strong>, just the pointers to which
position metric in the distance_metrics_list should be used for that SNF
run. Because of that, you’ll need to supply the distance_metrics_list
once again when calling <code><a href="../reference/batch_snf.html">batch_snf()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    distance_metrics_list <span class="op">=</span> <span class="va">my_distance_metrics</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="removing-the-default-distance_metrics">Removing the default distance_metrics<a class="anchor" aria-label="anchor" href="#removing-the-default-distance_metrics"></a>
</h2>
<p>There are two ways to avoid using the default distance metrics if you
don’t want to ever use them.</p>
<p>The first way is to use the <code>keep_defaults</code> parameter in
<code><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">no_default_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list</a></span><span class="op">(</span></span>
<span>    continuous_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    ordinal_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    categorical_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    mixed_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    keep_defaults <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_distance_metrics_list.html">summarize_distance_metrics_list</a></span><span class="op">(</span><span class="va">no_default_metrics</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Continuous distances:</span></span>
<span><span class="co">#&gt; 1. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrete distances:</span></span>
<span><span class="co">#&gt; 1. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ordinal distances:</span></span>
<span><span class="co">#&gt; 1. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Categorical distances:</span></span>
<span><span class="co">#&gt; 1. standard_norm_euclidean</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mixed distances:</span></span>
<span><span class="co">#&gt; 1. standard_norm_euclidean</span></span></code></pre></div>
<p>For this option, it is necessary to provide at least one distance
metric for every variable type. A distance_metrics_list cannot have any
of its variable types be completely empty (even if you have no data for
that variable type in the first place).</p>
<p>The second way is to explicitly specify which indices you want to
sample from during settings_matrix generation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_distance_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list</a></span><span class="op">(</span></span>
<span>    continuous_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span>,</span>
<span>        <span class="st">"some_other_metric"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"standard_norm_euclidean"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span>,</span>
<span>        <span class="st">"some_other_metric"</span> <span class="op">=</span> <span class="va">sn_euclidean_distance</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_distance_metrics_list.html">summarize_distance_metrics_list</a></span><span class="op">(</span><span class="va">my_distance_metrics</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Continuous distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance </span></span>
<span><span class="co">#&gt; 2. standard_norm_euclidean </span></span>
<span><span class="co">#&gt; 3. some_other_metric</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Discrete distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance </span></span>
<span><span class="co">#&gt; 2. standard_norm_euclidean </span></span>
<span><span class="co">#&gt; 3. some_other_metric</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Ordinal distances:</span></span>
<span><span class="co">#&gt; 1. euclidean_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Categorical distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mixed distances:</span></span>
<span><span class="co">#&gt; 1. gower_distance</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    distance_metrics_list <span class="op">=</span> <span class="va">my_distance_metrics</span>,</span>
<span>    continuous_distances <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cont_dist disc_dist ord_dist cat_dist mix_dist</span></span>
<span><span class="co">#&gt; 1          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 2          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 3          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 4          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 5          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 6          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 7          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 8          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 9          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 10         1         2        1        1        1</span></span></code></pre></div>
<p>The second option can be quite useful when paired with
<code><a href="../reference/add_settings_matrix_rows.html">add_settings_matrix_rows()</a></code>, enabling you to build up
distinct blocks of rows in the settings matrix that have different
combinations of distance metrics. This can save you the trouble of
needing to manage several distinct distance metrics lists or manage your
solution space over separate runs of <code>batch_snf</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    distance_metrics_list <span class="op">=</span> <span class="va">my_distance_metrics</span>,</span>
<span>    continuous_distances <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_settings_matrix_rows.html">add_settings_matrix_rows</a></span><span class="op">(</span></span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    distance_metrics_list <span class="op">=</span> <span class="va">my_distance_metrics</span>,</span>
<span>    continuous_distances <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    discrete_distances <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"dist"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    cont_dist disc_dist ord_dist cat_dist mix_dist</span></span>
<span><span class="co">#&gt; 1          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 2          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 3          1         3        1        1        1</span></span>
<span><span class="co">#&gt; 4          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 5          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 6          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 7          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 8          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 9          1         2        1        1        1</span></span>
<span><span class="co">#&gt; 10         1         2        1        1        1</span></span>
<span><span class="co">#&gt; 11         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 12         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 13         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 14         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 15         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 16         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 17         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 18         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 19         3         1        1        1        1</span></span>
<span><span class="co">#&gt; 20         3         1        1        1        1</span></span></code></pre></div>
<p>In rows 1 to 10, only continuous data will always be handled by the
first continuous distance metric while discrete data will be handled by
the second and third discrete distance metrics. In rows 11 to 20,
continuous data will always be handled by the third continuous distance
metric while discrete data will only be handled by the first distance
metric.</p>
</div>
<div class="section level2">
<h2 id="custom-distance-metrics">Custom distance metrics<a class="anchor" aria-label="anchor" href="#custom-distance-metrics"></a>
</h2>
<p>The remainder of this vignette deals with supplying custom distance
metrics (including custom feature weighting). Making use of this
functionality will require a good understanding of working with
functions in R.</p>
<p>You can also supply your own custom distance metrics. Looking at the
code from one of the package-provided distance functions shows some of
the essential aspects of a well-formated distance function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">euclidean_distance</span></span>
<span><span class="co">#&gt; function (df) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     distance_matrix &lt;- as.matrix(stats::dist(df, method = "euclidean"))</span></span>
<span><span class="co">#&gt;     return(distance_matrix)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x561482bce850&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:metasnf&gt;</span></span></code></pre></div>
<p>First, the function should only accept one argument: <code>df</code>,
and only give one output, <code>distance_matrix</code>.</p>
<p>By the time your data reaches a distance metric function, it
(referred to as <code>df</code>) will always:</p>
<ol style="list-style-type: decimal">
<li>have no UID column</li>
<li>have at least one variable column</li>
<li>have no missing values</li>
<li>be a data.frame (not a tibble)</li>
</ol>
<p>The variable column names won’t be altered from the values they had
when they were loaded into the data_list.</p>
<p>For example, consider the <code>abcd_anxiety</code> raw data supplied
by r-package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">abcd_anxiety</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   patient          cbcl_anxiety_r</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> NDAR_INV0567T2Y9              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> NDAR_INV0GLZNC2W              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> NDAR_INV0IZ157F8             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> NDAR_INV0J4PYA5F              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> NDAR_INV0OYE291Q              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> NDAR_INV0SM1JLXQ              2</span></span></code></pre></div>
<p>Here’s how to make it look more like what the distance metric
functions will expect to see:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed_abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># no NAs</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"subjectkey"</span> <span class="op">=</span> <span class="st">"patient"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># replace the UID with 'subjectkey'</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">processed_abcd_anxiety</span><span class="op">)</span></span>
<span><span class="co">#&gt;         subjectkey cbcl_anxiety_r</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9              3</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W              1</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0J4PYA5F              0</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0OYE291Q              2</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0SM1JLXQ              2</span></span>
<span><span class="co">#&gt; 6 NDAR_INV0Z87UJDR              0</span></span></code></pre></div>
<p>If we want to have a distance metric that calculates Euclidean
distance, but also scales the resulting matrix down such that the
biggest allowed distance is a 1, it would look like this:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_scaled_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># make sure it's formatted as a matrix</span></span>
<span>    <span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="va">distance_matrix</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">distance_matrix</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distance_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Error handling will be in your hands. For example, this function will
fail if the pairwise distances for all patients is 0 (a division by 0
will occur).</p>
<p>Once you’re happy that you distance function is working as you’d like
it to:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_scaled_euclidean</span><span class="op">(</span><span class="va">processed_abcd_anxiety</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; Warning in stats::dist(df, method = "euclidean"): NAs introduced by coercion</span></span>
<span><span class="co">#&gt;     1   2   3   4   5</span></span>
<span><span class="co">#&gt; 1 0.0 0.2 0.3 0.1 0.1</span></span>
<span><span class="co">#&gt; 2 0.2 0.0 0.1 0.1 0.1</span></span>
<span><span class="co">#&gt; 3 0.3 0.1 0.0 0.2 0.2</span></span>
<span><span class="co">#&gt; 4 0.1 0.1 0.2 0.0 0.0</span></span>
<span><span class="co">#&gt; 5 0.1 0.1 0.2 0.0 0.0</span></span></code></pre></div>
<p>You can load it into a custom distance_metrics_list:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_distance_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_distance_metrics_list.html">generate_distance_metrics_list</a></span><span class="op">(</span></span>
<span>    continuous_distances <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"my_scaled_euclidean"</span> <span class="op">=</span> <span class="va">my_scaled_euclidean</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-weighting">Custom weighting<a class="anchor" aria-label="anchor" href="#custom-weighting"></a>
</h2>
<p>Custom weighting at the variable level can get a little bit tricky.
Importantly, information of the variable weights need to be <strong>a
part of</strong> the distance metric functions themselves; weights
aren’t supplied to the distance metric functions as arguments. Below are
a few examples of incorporating custom weights into distance
matrices.</p>
<div class="section level3">
<h3 id="example-1-uniform-random-reweighting">Example 1: Uniform random reweighting<a class="anchor" aria-label="anchor" href="#example-1-uniform-random-reweighting"></a>
</h3>
<p>Here, we will set up a function that first standard normalizes all
the variables, then randomly reweights all the variables according to a
uniform distribution.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting up some data</span></span>
<span><span class="va">processed_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"subjectkey"</span> <span class="op">=</span> <span class="st">"patient"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>row.names <span class="op">=</span> <span class="st">"subjectkey"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">processed_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;                  mrisdp_1 mrisdp_2 mrisdp_3 mrisdp_4 mrisdp_5</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9    2.601    2.487    2.801    2.954    2.864</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W    2.619    2.851    2.784    2.846    3.012</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8    2.621    2.295    2.530    2.961    3.446</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F    2.599    2.670    2.676    2.938    2.809</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q    2.526    2.761    2.829    2.986    2.785</span></span>
<span></span>
<span><span class="va">uniform_weight_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/standardNormalization.html" class="external-link">standardNormalization</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="co"># generating the random weights</span></span>
<span>    <span class="va">number_of_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="va">random_weights</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">number_of_weights</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">random_weights</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># not necessary - for demonstration</span></span>
<span>    <span class="co"># applying the weights</span></span>
<span>    <span class="va">weighted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">random_weights</span><span class="op">)</span></span>
<span>    <span class="co"># distance calculation</span></span>
<span>    <span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="va">weighted_data</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distance_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">uniform_weight_euclidean</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.7164579</span></span>
<span><span class="co">#&gt;                  NDAR_INV0567T2Y9 NDAR_INV0GLZNC2W NDAR_INV0IZ157F8</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9         0.000000         8.927317         8.326549</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W         8.927317         0.000000         8.000050</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8         8.326549         8.000050         0.000000</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F         8.680014         9.462855         8.822674</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q         8.388372         7.807447         8.217962</span></span>
<span><span class="co">#&gt;                  NDAR_INV0J4PYA5F NDAR_INV0OYE291Q</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9         8.680014         8.388372</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W         9.462855         7.807447</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8         8.822674         8.217962</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F         0.000000         8.976554</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q         8.976554         0.000000</span></span></code></pre></div>
<p>The approach of formatting variable weights in a diagonal matrix and
then doing matrix multiplication with the original dataframe through the
<code>%*%</code> operator is very handy to know for this purpose:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    col1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    col2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   col1 col2</span></span>
<span><span class="co">#&gt; 1    1   50</span></span>
<span><span class="co">#&gt; 2    3  100</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    1  100</span></span>
<span><span class="co">#&gt; [2,]    3  200</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2-fixed-random-weights">Example 2: Fixed random weights<a class="anchor" aria-label="anchor" href="#example-2-fixed-random-weights"></a>
</h3>
<p>The approach above is limited in that you won’t easily be able to
find out what the actual weights being used were.</p>
<p>Using <a href="http://adv-r.had.co.nz/Functional-programming.html#closures" class="external-link">closures</a>,
we can efficiently churn out distance metric functions that we can
examine the weights of out of the gates.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_uniform_weight_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">max_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">random_weights</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">max_cols</span><span class="op">)</span></span>
<span>    <span class="va">uniform_weight_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/standardNormalization.html" class="external-link">standardNormalization</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>        <span class="co"># generating the random weights</span></span>
<span>        <span class="va">number_of_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>        <span class="va">random_weights_trimmed</span> <span class="op">&lt;-</span> <span class="va">random_weights</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">number_of_weights</span><span class="op">]</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">random_weights_trimmed</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># not necessary - for demonstration</span></span>
<span>        <span class="co"># applying the weights</span></span>
<span>        <span class="va">weighted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">random_weights_trimmed</span><span class="op">)</span></span>
<span>        <span class="co"># distance calculation</span></span>
<span>        <span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="va">weighted_data</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distance_matrix</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">uniform_weight_euclidean</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function will spit out another function that contains within it
a fixed string of random uniform numbers. The number of random numbers
contained is based on the <code>max_cols</code> parameter, and should be
chosen such that you’re certain you’ll never have a dataframe with more
columns than <code>max_cols</code> that needs to be evaluated. This may
be bigger than the number of columns in any individual dataframe,
depending on which SNF schemes you apply. A safe value in this case
would be something bigger than the total number of variables across all
your data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_metric_1</span> <span class="op">&lt;-</span> <span class="fu">fixed_uniform_weight_euclidean</span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>Both the original uniform weight function and the closure function
were given a print statement to report the first weight they apply.
Watch what happens when we repeatedly access either of these
functions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">uniform_weight_euclidean</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9355165</span></span>
<span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">uniform_weight_euclidean</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3305314</span></span>
<span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">uniform_weight_euclidean</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.188021</span></span>
<span></span>
<span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">my_metric_1</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.71851</span></span>
<span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">my_metric_1</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.71851</span></span>
<span><span class="va">uniform_weight</span> <span class="op">&lt;-</span> <span class="fu">my_metric_1</span><span class="op">(</span><span class="va">processed_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.71851</span></span></code></pre></div>
<p>For the first function, a new set of random numbers is generated each
time the distance metric is run. For the second function, a new set of
random numbers is only generated once (during
<code>fixed_uniform_weight_euclidean()</code>). This is particularly
useful for resampling purposes.</p>
</div>
<div class="section level3">
<h3 id="example-3-specific-variable-weights">Example 3: Specific variable weights<a class="anchor" aria-label="anchor" href="#example-3-specific-variable-weights"></a>
</h3>
<p>You can also have specific control over how each variable is
weighted. Like before, this information will need to be built into the
distance metric function. You may want to have a good understanding of
how the different SNF schemes work as they will ultimately define the
possible combinations of vectors that any one dataframe requiring
distance matrix conversion can have. To actually embed the custom
weights in this function, you may have to get a little creative. Here is
one approach, which involves creating a dataframe that stores all the
weights we’re interested in working with</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_of_data</span> <span class="op">&lt;-</span> <span class="va">processed_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">other_data</span> <span class="op">&lt;-</span> <span class="va">processed_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">40</span><span class="op">:</span><span class="fl">42</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">subset_of_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mrisdp_1" "mrisdp_2" "mrisdp_3"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">other_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mrisdp_40" "mrisdp_41" "mrisdp_42"</span></span></code></pre></div>
<p>Let’s pretend that is the totality of the data we’re working
with.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">all_variable_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">subset_of_data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">other_data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">number_of_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">all_variable_names</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many sets of reweightings we want to make</span></span>
<span><span class="va">number_of_weight_combinations</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">number_of_weights</span> <span class="op">&lt;-</span> <span class="va">number_of_weight_combinations</span> <span class="op">*</span> <span class="va">number_of_variables</span></span>
<span></span>
<span><span class="va">weights_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>    ncol <span class="op">=</span> <span class="va">number_of_variables</span>,</span>
<span>    nrow <span class="op">=</span> <span class="va">number_of_weight_combinations</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">number_of_weights</span><span class="op">)</span> <span class="co"># you could use something specific instead</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">weights_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">all_variable_names</span></span>
<span></span>
<span><span class="va">weights_df</span></span>
<span><span class="co">#&gt;     mrisdp_1  mrisdp_2   mrisdp_3 mrisdp_40 mrisdp_41 mrisdp_42</span></span>
<span><span class="co">#&gt; 1 0.92419071 0.9099840 0.42381647 0.4103982 0.5640359 0.2950651</span></span>
<span><span class="co">#&gt; 2 0.07596749 0.1410591 0.01340287 0.4855141 0.5945707 0.5821703</span></span>
<span><span class="co">#&gt; 3 0.64034856 0.7205406 0.30765299 0.3394514 0.3902091 0.6320073</span></span>
<span><span class="co">#&gt; 4 0.35021586 0.9815632 0.64053177 0.1426711 0.3823681 0.4766730</span></span>
<span><span class="co">#&gt; 5 0.04099998 0.4018660 0.62192043 0.0399489 0.4221297 0.4052951</span></span></code></pre></div>
<p>Those are all the weights. Let’s say our distance metric encounters
some odd subset of the data:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">odd_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">subset_of_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="va">other_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">odd_subset</span></span>
<span><span class="co">#&gt;                  mrisdp_1 mrisdp_2 mrisdp_40 mrisdp_41</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9    2.601    2.487     2.600     2.784</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W    2.619    2.851     2.849     2.600</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8    2.621    2.295     2.326     2.377</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F    2.599    2.670     2.803     2.550</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q    2.526    2.761     2.572     2.585</span></span></code></pre></div>
<p>This function can take in a row from <code>weights_df</code> and spit
out a function that always applies that row to weight any data it
encounters:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">specific_weighted_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">weights_row</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">weighted_euclidean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights_row</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="va">weighted_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>        <span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="va">weighted_data</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distance_matrix</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">weighted_euclidean</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In action:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">first_row_metric</span> <span class="op">&lt;-</span> <span class="fu">specific_weighted_euclidean</span><span class="op">(</span><span class="va">weights_df</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">first_row_metric</span><span class="op">(</span><span class="va">odd_subset</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  NDAR_INV0567T2Y9 NDAR_INV0GLZNC2W NDAR_INV0IZ157F8</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9        0.0000000        0.3622241        0.3101797</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W        0.3622241        0.0000000        0.5638086</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8        0.3101797        0.5638086        0.0000000</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F        0.2282439        0.1691798        0.4058378</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q        0.2823177        0.1645890        0.4598755</span></span>
<span><span class="co">#&gt;                  NDAR_INV0J4PYA5F NDAR_INV0OYE291Q</span></span>
<span><span class="co">#&gt; NDAR_INV0567T2Y9        0.2282439        0.2823177</span></span>
<span><span class="co">#&gt; NDAR_INV0GLZNC2W        0.1691798        0.1645890</span></span>
<span><span class="co">#&gt; NDAR_INV0IZ157F8        0.4058378        0.4598755</span></span>
<span><span class="co">#&gt; NDAR_INV0J4PYA5F        0.0000000        0.1441736</span></span>
<span><span class="co">#&gt; NDAR_INV0OYE291Q        0.1441736        0.0000000</span></span></code></pre></div>
<p>And that’s all there is on distance metrics! If there’s a metric
you’d like to see added as a prewritten option included in the package,
feel free to post an issue or make a pull request on the package’s
GitHub.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Wang, Bo, Aziz M. Mezlini, Feyyaz Demir, Marc Fiume, Zhuowen Tu,
Michael Brudno, Benjamin Haibe-Kains, and Anna Goldenberg. 2014.
“Similarity Network Fusion for Aggregating Data Types on a Genomic
Scale.” Nature Methods 11 (3): 333–37. <a href="https://doi.org/10.1038/nmeth.2810" class="external-link uri">https://doi.org/10.1038/nmeth.2810</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Prashanth Velayudhan, Eman Nishat, Sonja Stojanovski, Anne L Wheeler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
