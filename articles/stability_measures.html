<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<title>Stability Measures and Consensus Clustering • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stability Measures and Consensus Clustering">
<meta property="og:description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Stability Measures and Consensus Clustering</h1>
            
      
      
      <div class="d-none name"><code>stability_measures.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/stability_measures.Rmd" class="external-link">stability_measures.Rmd</a></p>
<p>In this vignette, we will highlight the main stability measure
options in the metasnf package.</p>
<p>Do brace yourself: stability measures scale SNF computation time by
the number of settings matrix rows <em>times</em> the number of
resamples of the data you use. Consider trying these functions on scaled
down versions of your data or on just a couple of rows of the
settings_matrix to get a sense of how long these functions may take to
complete on your full dataset. The code below isn’t actually evaluated
in this document (all documentation is re-rendered on every commit, and
this vignette simply takes too much time during development), but
descriptions of the outputs are provided and you should feel free to try
the functions yourself.</p>
<div class="section level2">
<h2 id="data-set-up">Data set-up<a class="anchor" aria-label="anchor" href="#data-set-up"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data_list</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gender_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"categorical"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">diagnosis_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"diagnosis"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"clinical"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"categorical"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">age_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"discrete"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate settings_matrix</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As an added part of the data set-up, we’ll also calculate some
subsamples of the data_list.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">3</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of patients</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>data_list_subsamples</code> contains a list of 3 variations of
the full data_list. Each variation only has a random 80% of the original
patients.</p>
</div>
<div class="section level2">
<h2 id="pairwise-adjusted-rand-indices-across-subsamples">Pairwise Adjusted Rand Indices Across Subsamples<a class="anchor" aria-label="anchor" href="#pairwise-adjusted-rand-indices-across-subsamples"></a>
</h2>
<p><code>pairwise_aris</code> is a dataframe that contains the mean and
standard deviation of the pairwise adjusted Rand indices between
patients for each row of the settings matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pairwise_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_pairwise_aris.html">subsample_pairwise_aris</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="persistence-of-co-clustering-across-subsamples">Persistence of Co-Clustering Across Subsamples<a class="anchor" aria-label="anchor" href="#persistence-of-co-clustering-across-subsamples"></a>
</h2>
<p>The <code>fraction_clustered_together</code> function calculates for
every pair of patients that clustered together in the full sample, how
often they continued to cluster together in data subsamples.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run SNF and clustering</span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fraction_together</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fraction_clustered_together.html">fraction_clustered_together</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    <span class="va">solutions_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="co-clustering-heatmaps">Co-clustering Heatmaps<a class="anchor" aria-label="anchor" href="#co-clustering-heatmaps"></a>
</h2>
<p>You can visualize co-clustering across the resamples <em>for a single
row of the settings matrix</em> using the
<code>generate_cocluster_data</code> and <code>cocluster_heatmap</code>
functions.</p>
<p><code>cocluster_heatmap</code> will only work if every pair of
patients were part of the same subsampled data at least 1 time. You’ll
see a descriptive warning if this didn’t end up happening in your own
data_list_subsamples. This can most easily be resolved by increasing the
number of subsamples you examine or the subsample fraction.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">30</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of patients</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cocluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    data_list_subsamples <span class="op">=</span> <span class="va">data_list_subsamples</span>,</span>
<span>    settings_matrix_row <span class="op">=</span> <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>cocluster_data</code> a list with two matrices:</p>
<ul>
<li>
<code>same_solution</code>: A patient x patient matrix where each
cell is the number of subsamples that contained both of those
patients</li>
<li>
<code>same_cluster</code>: A patient x patient matrix where each
cell is the number of subsamples where those patients were clustered
together</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">same_cluster</span> <span class="op">&lt;-</span> <span class="va">cocluster_data</span><span class="op">$</span><span class="st">"same_cluster"</span></span>
<span><span class="va">same_solution</span> <span class="op">&lt;-</span> <span class="va">cocluster_data</span><span class="op">$</span><span class="st">"same_solution"</span></span>
<span></span>
<span><span class="va">cocluster_matrix</span> <span class="op">&lt;-</span> <span class="va">same_cluster</span> <span class="op">/</span> <span class="va">same_solution</span></span></code></pre></div>
<p>This matrix is automatically calculated and plotted in the
<code>cocluster_heatmap</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cocluster_heatmap.html">cocluster_heatmap</a></span><span class="op">(</span><span class="va">cocluster_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hm</span></span></code></pre></div>
<p>You can pull out the patient order of the heatmap as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">hm</span><span class="op">)</span></span>
<span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/row_order-dispatch.html" class="external-link">row_order</a></span><span class="op">(</span><span class="va">hm</span><span class="op">)</span></span></code></pre></div>
<p><code>order</code> can now be applied to the data in the data_list to
get the same patient order as shown in the heatmap:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The order of patients as they appear in the heatmap</span></span>
<span><span class="va">data_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="st">"data"</span><span class="op">[</span><span class="va">order</span>, <span class="st">"subjectkey"</span><span class="op">]</span></span></code></pre></div>
<p>By default, <code>generate_cocluster_data</code> only operates on a
single row of the settings matrix and essentially just summarizes the
data across the resamplings. You can also pool together the results from
several rows using the <code>pooled_cocluster_heatmap</code> function as
follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cocluster_data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    full_data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cocluster_data_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    full_data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/pooled_cocluster_heatmap.html">pooled_cocluster_heatmap</a></span><span class="op">(</span></span>
<span>    cocluster_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">cocluster_data</span>,</span>
<span>        <span class="va">cocluster_data_2</span>,</span>
<span>        <span class="va">cocluster_data_3</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
