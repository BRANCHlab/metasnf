<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stability Measures • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stability Measures">
<meta name="description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<meta property="og:description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a></li>
    <li><a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BRANCHlab/metasnf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Stability Measures</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BRANCHlab/metasnf/blob/main/vignettes/stability_measures.Rmd" class="external-link"><code>vignettes/stability_measures.Rmd</code></a></small>
      <div class="d-none name"><code>stability_measures.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/stability_measures.Rmd" class="external-link">stability_measures.Rmd</a></p>
<p>In this vignette, we will highlight the main stability measure
options in the <code>metasnf</code> package.</p>
<div class="section level2">
<h2 id="data-set-up">Data set-up<a class="anchor" aria-label="anchor" href="#data-set-up"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cort_sa</span>, <span class="st">"cortical_area"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snf_config.html">snf_config</a></span><span class="op">(</span></span>
<span>    <span class="va">my_dl</span>,</span>
<span>    n_solutions <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">my_dl</span>, <span class="va">sc</span><span class="op">)</span></span></code></pre></div>
<p>To begin start calculating resampling-based stability measures, we’ll
build subsamples of the data list using the <code>subsample_dl</code>
function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_dl_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_dl.html">subsample_dl</a></span><span class="op">(</span></span>
<span>    <span class="va">my_dl</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.85</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>my_dl_subsamples</code> contains a list of 100 subsamples of
the full data list. Each variation only has a random 85% of the original
observations.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_subsample_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf_subsamples.html">batch_snf_subsamples</a></span><span class="op">(</span></span>
<span>    <span class="va">my_dl_subsamples</span>,</span>
<span>    <span class="va">sc</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>By default, the function returns a one-element list:
<code>cluster_solutions</code>, which is itself a list of cluster
solution data frames corresponding to each of the provided data list
subsamples. Setting the parameters <code>return_sim_mats</code> and
<code>return_solutions</code> to <code>TRUE</code> will turn the result
of the function to a three-element list containing the corresponding
solutions data frames and final fused similarity matrices of those
cluster solutions, should you require these objects for your own
stability calculations.</p>
<p>The function <code>subsample_pairwise_aris</code> can then be used to
calculate the ARIs between cluster solutions across the subsamples.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pairwise_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_pairwise_aris.html">subsample_pairwise_aris</a></span><span class="op">(</span></span>
<span>    <span class="va">batch_subsample_results</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>pairwise_aris</code> is a list containing a summary data frame
of the ARIs between subsamples for each row of the original settings
data frame as well as another list of all the generated inter-subsample
ARIs as a result of setting <code>return_raw_aris</code> to
<code>TRUE</code>. The raw inter-subsample ARIs corresponding to a
particualr settings data frame row can be visualized with a heatmap:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inter_ss_ari_hm</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">Heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">pairwise_aris</span><span class="op">$</span><span class="st">"raw_aris"</span><span class="op">$</span><span class="st">"s1"</span>,</span>
<span>    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        color_bar <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Inter-Subsample\nARI"</span>,</span>
<span>        at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_row_names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/inter_ss_ari_hm.png" width="700">
</center>
<p>To calculate information about how often each pair of observations
clustered together across the subsamples, we can use the
<code>calculate_coclustering</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coclustering_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_coclustering.html">calculate_coclustering</a></span><span class="op">(</span></span>
<span>    <span class="va">batch_subsample_results</span>,</span>
<span>    <span class="va">sol_df</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">coclustering_results</span><span class="op">$</span><span class="st">"cocluster_summary"</span></span></code></pre></div>
<p>The output of <code>calculate_coclustering</code> is a list
containing the following components: - <code>cocluster_dfs</code>: A
list of data frames, one per cluster solution, that shows the number of
times that every pair of observations in the original cluster solution
occurred in the same subsample, the number of times that every pair
clustered together in a subsample, and the corresponding fraction of
times that every pair clustered together in a subsample. -
<code>cocluster_ss_mats</code>: The number of times every pair of
observations occurred in the same subsample, formatted as a pairwise
matrix. - <code>cocluster_sc_mats</code>: The number of times every pair
of observations occurred in the same cluster, formatted as a pairwise
matrix. - <code>cocluster_cf_mats</code>: The fraction of times every
pair of observations occurred in the same cluster, formatted as a
pairwise matrix. - <code>cocluster_summary</code>: Among pairs of
observations that clustered together in the original cluster solution,
the mean fraction those pairs remained clustered together across the
subsample-derived solutions. This information is formatted as a data
frame with one row per cluster solution.</p>
<p>The <code>cocluster_dfs</code> component can be used to visualize
co-clustering across subsamples as a density plot:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cocluster_dfs</span> <span class="op">&lt;-</span> <span class="va">coclustering_results</span><span class="op">$</span><span class="st">"cocluster_dfs"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cocluster_density.html">cocluster_density</a></span><span class="op">(</span><span class="va">cocluster_dfs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/cocluster_density_l.png" width="700">
</center>
<p>Or as a heatmap:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fraction of co-clustering between observations, grouped by original</span></span>
<span><span class="co"># cluster membership</span></span>
<span><span class="fu"><a href="../reference/cocluster_heatmap.html">cocluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">cocluster_dfs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    dl <span class="op">=</span> <span class="va">my_dl</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Income"</span> <span class="op">=</span> <span class="st">"household_income"</span>,</span>
<span>        <span class="st">"Pubertal Status"</span> <span class="op">=</span> <span class="st">"pubertal_status"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Pubertal Status"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"purple"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Income"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"red"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/cc_hm_l.png" width="700">
</center>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth S Velayudhan, Xiaoqiao Xu, Prajkta Kallurkar, Ana Patricia Balbon, Maria T Secara, Adam Taback, Denise Sabac, Nicholas Chan, Shihao Ma, Bo Wang, Daniel Felsky, Stephanie H Ameis, Brian Cox, Colin Hawco, Lauren Erdman, Anne L Wheeler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
