<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stability Measures and Consensus Clustering • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stability Measures and Consensus Clustering">
<meta name="description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<meta property="og:description" content="Evaluating robustness of cluster solutions through resampling methods.
">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a></li>
    <li><a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Stability Measures and Consensus Clustering</h1>
            
      

      <div class="d-none name"><code>stability_measures.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/stability_measures.Rmd" class="external-link">stability_measures.Rmd</a></p>
<p>In this vignette, we will highlight the main stability measure
options in the metasnf package.</p>
<p>Do brace yourself: stability measures scale SNF computation time by
the number of settings matrix rows <em>times</em> the number of
resamples of the data you use. Consider trying these functions on scaled
down versions of your data or on just a couple of rows of the
settings_matrix to get a sense of how long these functions may take to
complete on your full dataset. The code below isn’t actually evaluated
in this document (all documentation is re-rendered on every commit, and
this vignette simply takes too much time during development), but
descriptions of the outputs are provided and you should feel free to try
the functions yourself.</p>
<div class="section level2">
<h2 id="data-set-up">Data set-up<a class="anchor" aria-label="anchor" href="#data-set-up"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate data_list</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gender_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"gender"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"categorical"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">diagnosis_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"diagnosis"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"clinical"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"categorical"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">age_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"discrete"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate settings_matrix</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As an added part of the data set-up, we’ll also calculate some
subsamples of the data_list.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">3</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of obs</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>data_list_subsamples</code> contains a list of 3 variations of
the full data_list. Each variation only has a random 80% of the original
observations.</p>
</div>
<div class="section level2">
<h2 id="pairwise-adjusted-rand-indices-across-subsamples">Pairwise Adjusted Rand Indices Across Subsamples<a class="anchor" aria-label="anchor" href="#pairwise-adjusted-rand-indices-across-subsamples"></a>
</h2>
<p><code>pairwise_aris</code> is a dataframe that contains the mean and
standard deviation of the pairwise adjusted Rand indices between
observations for each row of the settings matrix.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pairwise_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_pairwise_aris.html">subsample_pairwise_aris</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="persistence-of-co-clustering-across-subsamples">Persistence of Co-Clustering Across Subsamples<a class="anchor" aria-label="anchor" href="#persistence-of-co-clustering-across-subsamples"></a>
</h2>
<p>The <code>fraction_clustered_together</code> function calculates for
every pair of observations that clustered together in the full sample,
how often they continued to cluster together in data subsamples.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run SNF and clustering</span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fraction_together</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fraction_clustered_together.html">fraction_clustered_together</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    <span class="va">solutions_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="co-clustering-heatmaps">Co-clustering Heatmaps<a class="anchor" aria-label="anchor" href="#co-clustering-heatmaps"></a>
</h2>
<p>You can visualize co-clustering across the resamples <em>for a single
row of the settings matrix</em> using the
<code>generate_cocluster_data</code> and <code>cocluster_heatmap</code>
functions.</p>
<p><code>cocluster_heatmap</code> will only work if every pair of
observations were part of the same subsampled data at least 1 time.
You’ll see a descriptive warning if this didn’t end up happening in your
own data_list_subsamples. This can most easily be resolved by increasing
the number of subsamples you examine or the subsample fraction.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">30</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of obs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cocluster_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    data_list_subsamples <span class="op">=</span> <span class="va">data_list_subsamples</span>,</span>
<span>    settings_matrix_row <span class="op">=</span> <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>cocluster_data</code> a list with two matrices:</p>
<ul>
<li>
<code>same_solution</code>: A pairwise observation matrix where each
cell is the number of subsamples that contained both of those
observations</li>
<li>
<code>same_cluster</code>: A pairwise observation matrix where each
cell is the number of subsamples where those observations were clustered
together</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">same_cluster</span> <span class="op">&lt;-</span> <span class="va">cocluster_data</span><span class="op">$</span><span class="st">"same_cluster"</span></span>
<span><span class="va">same_solution</span> <span class="op">&lt;-</span> <span class="va">cocluster_data</span><span class="op">$</span><span class="st">"same_solution"</span></span>
<span></span>
<span><span class="va">cocluster_matrix</span> <span class="op">&lt;-</span> <span class="va">same_cluster</span> <span class="op">/</span> <span class="va">same_solution</span></span></code></pre></div>
<p>This matrix is automatically calculated and plotted in the
<code>cocluster_heatmap</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cocluster_heatmap.html">cocluster_heatmap</a></span><span class="op">(</span><span class="va">cocluster_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hm</span></span></code></pre></div>
<p>You can pull out the observation order of the heatmap as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hm</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span><span class="va">hm</span><span class="op">)</span></span>
<span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/row_order-dispatch.html" class="external-link">row_order</a></span><span class="op">(</span><span class="va">hm</span><span class="op">)</span></span></code></pre></div>
<p><code>order</code> can now be applied to the data in the data_list to
get the same observation order as shown in the heatmap:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The order of observations as they appear in the heatmap</span></span>
<span><span class="va">data_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="st">"data"</span><span class="op">[</span><span class="va">order</span>, <span class="st">"subjectkey"</span><span class="op">]</span></span></code></pre></div>
<p>By default, <code>generate_cocluster_data</code> only operates on a
single row of the settings matrix and essentially just summarizes the
data across the resamplings. You can also pool together the results from
several rows using the <code>pooled_cocluster_heatmap</code> function as
follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cocluster_data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    full_data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cocluster_data_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_cocluster_data.html">generate_cocluster_data</a></span><span class="op">(</span></span>
<span>    full_data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/pooled_cocluster_heatmap.html">pooled_cocluster_heatmap</a></span><span class="op">(</span></span>
<span>    cocluster_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">cocluster_data</span>,</span>
<span>        <span class="va">cocluster_data_2</span>,</span>
<span>        <span class="va">cocluster_data_3</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth Velayudhan, Xiaoqiao Xu, Prajkta Kallurkar, Ana Patricia Balbon, Maria T Secara, Adam Taback, Denise Sabac, Nicholas Chan, Shihao Ma, Anna Goldenberg, Bo Wang, Daniel Felsky, Stephanie H Ameis, Brian Cox, Colin Hawco, Lauren Erdman, Anne L Wheeler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
