<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Complete Example • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Complete Example">
<meta name="description" content="Step through a complex subtyping workflow.
">
<meta property="og:description" content="Step through a complex subtyping workflow.
">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a></li>
    <li><a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/BRANCHlab/metasnf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A Complete Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BRANCHlab/metasnf/blob/main/vignettes/a_complete_example.Rmd" class="external-link"><code>vignettes/a_complete_example.Rmd</code></a></small>
      <div class="d-none name"><code>a_complete_example.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/a_complete_example.Rmd" class="external-link">a_complete_example.Rmd</a></p>
<p>We recommend you go through the <a href="https://branchlab.github.io/metasnf/articles/a_simple_example.html">simple
example</a> before working through this one.</p>
<p>This vignette walks through how the core functionality of this
package, including:</p>
<ol style="list-style-type: decimal">
<li>Setting up the data</li>
<li>Building a space of settings to cluster over</li>
<li>Running SNF</li>
<li>Identifying and visualizing meta clusters</li>
<li>Characterizing and selecting top meta clusters</li>
<li>Selecting a representative cluster solution from a meta cluster</li>
<li>Cluster solution characterization</li>
<li>Cluster solution validation</li>
</ol>
<div class="section level2">
<h2 id="data-set-up">Data Set-up<a class="anchor" aria-label="anchor" href="#data-set-up"></a>
</h2>
<div class="section level3">
<h3 id="pre-processing">Pre-processing<a class="anchor" aria-label="anchor" href="#pre-processing"></a>
</h3>
<p>Your data should be loaded into the R environment in the following
format:</p>
<ol style="list-style-type: decimal">
<li>The data is in one or more <code>data.frame</code> class
objects</li>
<li>The data is in wide form (one row per observation to cluster)</li>
<li>All data frames should have exactly one column that uniquely
identifies each observation</li>
<li>All data should be complete (no missing values)</li>
</ol>
<p>If you wish to use imputation to handle missingness in your data, you
can take a look at the <a href="https://branchlab.github.io/metasnf/articles/imputations.html">imputation
vignette</a> which outlines a basic workflow for meta clustering across
multiple imputations of the same dataset.</p>
<p>The package comes with a few mock data frames based on real data from
the Adolescent Brain Cognitive Development study:</p>
<ul>
<li>
<code>anxiety</code> (anxiety scores from the CBCL)</li>
<li>
<code>depress</code> (depression scores from the CBCL)</li>
<li>
<code>cort_t</code> (cortical thicknesses)</li>
<li>
<code>cort_sa</code> (cortical surface areas in mm^2)</li>
<li>
<code>subc_v</code> (subcortical volumes in mm^3)</li>
<li>
<code>income</code> (household income on a 1-3 scale)</li>
<li>
<code>pubertal</code> (pubertal status on a 1-5 scale)</li>
</ul>
<p>Here’s what the cortical thickness data looks like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ unique_id: chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ mrisdp_1 : num  2.6 2.62 2.62 2.6 2.53</span></span>
<span><span class="co">#&gt;  $ mrisdp_2 : num  2.49 2.85 2.29 2.67 2.76</span></span>
<span><span class="co">#&gt;  $ mrisdp_3 : num  2.8 2.78 2.53 2.68 2.83</span></span>
<span><span class="co">#&gt;  $ mrisdp_4 : num  2.95 2.85 2.96 2.94 2.99</span></span>
<span></span>
<span><span class="va">cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;          unique_id mrisdp_1 mrisdp_2 mrisdp_3 mrisdp_4</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9    2.601    2.487    2.801    2.954</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W    2.619    2.851    2.784    2.846</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8    2.621    2.295    2.530    2.961</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F    2.599    2.670    2.676    2.938</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q    2.526    2.761    2.829    2.986</span></span></code></pre></div>
<p>The first column <code>unique_id</code> is the unique identifier
(UID) for all observations in the data.</p>
<p>Here’s the household income data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ unique_id       : chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ household_income: num  3 NA 1 2 1</span></span>
<span></span>
<span><span class="va">income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;          unique_id household_income</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9                3</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W               NA</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8                1</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F                2</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q                1</span></span></code></pre></div>
<p>Putting everything in a list will help us get quicker summaries of
all the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">anxiety</span>,</span>
<span>    <span class="va">depress</span>,</span>
<span>    <span class="va">cort_t</span>,</span>
<span>    <span class="va">cort_sa</span>,</span>
<span>    <span class="va">subc_v</span>,</span>
<span>    <span class="va">income</span>,</span>
<span>    <span class="va">pubertal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The number of rows in each data frame:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_list</span>, <span class="va">dim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 174  31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span></span>
<span><span class="co"># Whether or not each data frame has missing values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df_list</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Some of the data has missing values and not all of the data frames
have the same number of participants. SNF can only be run with complete
data, so you’ll need to either use complete case analysis (removal of
observations with any missing values) or impute the missing values to
proceed with the clustering. As mentioned above, <code>metasnf</code>
can be used to visualize changes in clustering results across different
imputations of the data.</p>
<p>For now, we’ll just examine the simpler complete-case analysis
approach by reducing our data frames to only common and complete
observations. This can be made easier using the
<code>get_complete_uids</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complete_uids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_complete_uids.html">get_complete_uids</a></span><span class="op">(</span><span class="va">df_list</span>, uid <span class="op">=</span> <span class="st">"unique_id"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">complete_uids</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 87</span></span>
<span></span>
<span><span class="co"># Reducing data frames to only common observations with no missing data</span></span>
<span><span class="va">anxiety</span> <span class="op">&lt;-</span> <span class="va">anxiety</span><span class="op">[</span><span class="va">anxiety</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">depress</span> <span class="op">&lt;-</span> <span class="va">depress</span><span class="op">[</span><span class="va">depress</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">cort_t</span> <span class="op">&lt;-</span> <span class="va">cort_t</span><span class="op">[</span><span class="va">cort_t</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">cort_sa</span> <span class="op">&lt;-</span> <span class="va">cort_sa</span><span class="op">[</span><span class="va">cort_sa</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">subc_v</span> <span class="op">&lt;-</span> <span class="va">subc_v</span><span class="op">[</span><span class="va">subc_v</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">income</span> <span class="op">&lt;-</span> <span class="va">income</span><span class="op">[</span><span class="va">income</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span>
<span><span class="va">pubertal</span> <span class="op">&lt;-</span> <span class="va">pubertal</span><span class="op">[</span><span class="va">pubertal</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">complete_uids</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-the-data-list">Generating the data list<a class="anchor" aria-label="anchor" href="#generating-the-data-list"></a>
</h3>
<p>The <code>data_list</code> class is a structured list of data frames
(like the one already created), but with some additional metadata about
each data frame. It should only contain the data frames we want to
directly use as inputs for the clustering. Let’s say we are working in a
context where the anxiety and depression data are especially important
outcomes and we want to know if we can find subtypes using the other
data which still do a good job of separating out observations by their
anxiety and depression scores.</p>
<p>We’ll start by initializing a data list that stores our input
features.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that you do not need to explicitly name every single named element</span></span>
<span><span class="co"># (data = ..., name = ..., etc.)</span></span>
<span><span class="va">input_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">cort_t</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_thickness"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">cort_sa</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_surface_area"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">subc_v</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"subcortical_volume"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">income</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"household_income"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">pubertal</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"pubertal_status"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This process removes any observations that did not have complete data
across all provided input data frames. The structure of the data list is
a nested list tracking the data, the name of the data frame, what domain
(broader source of information) the data frame belongs to, and the type
of feature stored in that data frame. Options for feature type include
“continuous”, “discrete”, “ordinal”, “categorical”, and “mixed”.</p>
<p>The <code>uid</code> parameter is the name of the column in the data
frames that uniquely identifies each observation. Upon data list
creation, the UID will be converted to <code>"uid"</code> and the UIDs
themselves will be prefixed with <code>"_uid"</code> for ease of
management across other functions in the package.</p>
<p>We can get a summary of our constructed data list with the
<code>summary</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">input_dl</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    name       type       domain length width</span></span>
<span><span class="co">#&gt; 1    cortical_thickness continuous neuroimaging     87   151</span></span>
<span><span class="co">#&gt; 2 cortical_surface_area continuous neuroimaging     87   151</span></span>
<span><span class="co">#&gt; 3    subcortical_volume continuous neuroimaging     87    30</span></span>
<span><span class="co">#&gt; 4      household_income continuous demographics     87     1</span></span>
<span><span class="co">#&gt; 5       pubertal_status continuous demographics     87     1</span></span></code></pre></div>
<p>Each input data frame now has the same 87 observations with complete
data. The width refers to the number of features in each data frame (not
including the UID column).</p>
<p><code>data_list</code> now stores all the features we intend on using
for the clustering. We’re interested in knowing if any of the clustering
solutions we generate can distinguish children apart based on their
anxiety and depression scores. To do this, we’ll also create a data list
storing only features that we’ll use for evaluating our cluster
solutions and not for the clustering itself. We’ll refer to this as the
target data list.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">target_dl</span><span class="op">)</span></span>
<span><span class="co">#&gt;        name    type    domain length width</span></span>
<span><span class="co">#&gt; 1   anxiety ordinal behaviour     87     1</span></span>
<span><span class="co">#&gt; 2 depressed ordinal behaviour     87     1</span></span></code></pre></div>
<p>Note that it is not necessary to make use of a partition of input and
out-of-model measures in this way. If you’d like to have no target data
list and instead use every single feature of interest for the
clustering, you can stick to just using one data list.</p>
</div>
</div>
<div class="section level2">
<h2 id="defining-sets-of-hyperparameters-to-use-for-snf-and-clustering">Defining sets of hyperparameters to use for SNF and clustering<a class="anchor" aria-label="anchor" href="#defining-sets-of-hyperparameters-to-use-for-snf-and-clustering"></a>
</h2>
<p>The SNF config stores all the information about the settings and
functions to be used for each SNF run to be completed. Calling the
<code>snf_config</code> function with a specified number of rows will
automatically build a randomly populated <code>snf_config</code> class
object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">my_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snf_config.html">snf_config</a></span><span class="op">(</span></span>
<span>    dl <span class="op">=</span> <span class="va">input_dl</span>,</span>
<span>    n_solutions <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ No distance functions specified. Using defaults.</span></span>
<span><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span></span>
<span><span class="va">my_sc</span></span>
<span><span class="co">#&gt; Settings Data Frame:</span></span>
<span><span class="co">#&gt;                            1    2    3    4    5    6    7    8    9   10</span></span>
<span><span class="co">#&gt; SNF hyperparameters:</span></span>
<span><span class="co">#&gt; alpha                    0.5  0.4  0.3  0.3  0.5  0.4  0.7  0.8  0.3  0.6</span></span>
<span><span class="co">#&gt; k                         29   26   44   43   29   26   36   21   29   35  </span></span>
<span><span class="co">#&gt; t                         20   20   20   20   20   20   20   20   20   20  </span></span>
<span><span class="co">#&gt; SNF scheme:</span></span>
<span><span class="co">#&gt;                            2    1    2    1    2    2    2    3    1    3  </span></span>
<span><span class="co">#&gt; Clustering functions:</span></span>
<span><span class="co">#&gt;                            1    1    2    1    2    1    1    2    1    1  </span></span>
<span><span class="co">#&gt; Distance functions:</span></span>
<span><span class="co">#&gt; CNT                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; DSC                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; ORD                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; CAT                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; MIX                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; Component dropout:</span></span>
<span><span class="co">#&gt; cortical_thickness         ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; cortical_surface_area      ✖    ✔    ✖    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; subcortical_volume         ✔    ✔    ✖    ✖    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; household_income           ✖    ✔    ✔    ✔    ✔    ✔    ✔    ✖    ✔    ✖  </span></span>
<span><span class="co">#&gt; pubertal_status            ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✖  </span></span>
<span><span class="co">#&gt; …and settings defined to create 10 more cluster solutions.</span></span>
<span><span class="co">#&gt; Distance Functions List:</span></span>
<span><span class="co">#&gt; Continuous (1):</span></span>
<span><span class="co">#&gt; [1] euclidean_distance</span></span>
<span><span class="co">#&gt; Discrete (1):</span></span>
<span><span class="co">#&gt; [1] euclidean_distance</span></span>
<span><span class="co">#&gt; Ordinal (1):</span></span>
<span><span class="co">#&gt; [1] euclidean_distance</span></span>
<span><span class="co">#&gt; Categorical (1):</span></span>
<span><span class="co">#&gt; [1] gower_distance</span></span>
<span><span class="co">#&gt; Mixed (1):</span></span>
<span><span class="co">#&gt; [1] gower_distance</span></span>
<span><span class="co">#&gt; Clustering Functions List:</span></span>
<span><span class="co">#&gt; [1] spectral_eigen</span></span>
<span><span class="co">#&gt; [2] spectral_rot</span></span>
<span><span class="co">#&gt; Weights Matrix:</span></span>
<span><span class="co">#&gt; Weights defined for 20 cluster solutions.</span></span>
<span><span class="co">#&gt; $ mrisdp_1 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… </span></span>
<span><span class="co">#&gt; $ mrisdp_2 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… </span></span>
<span><span class="co">#&gt; $ mrisdp_3 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… </span></span>
<span><span class="co">#&gt; $ mrisdp_4 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… </span></span>
<span><span class="co">#&gt; $ mrisdp_5 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… </span></span>
<span><span class="co">#&gt; …and 329 more features.</span></span></code></pre></div>
<p>The SNF config contains multiple parts that all play a role in
determining how the data in a data list will be converted into a cluster
solution.</p>
<div class="section level3">
<h3 id="the-settings-data-frame">The settings data frame<a class="anchor" aria-label="anchor" href="#the-settings-data-frame"></a>
</h3>
<p>The first part is the settings data frame:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_sc</span><span class="op">$</span><span class="st">"settings_df"</span></span>
<span><span class="co">#&gt;                            1    2    3    4    5    6    7    8    9   10</span></span>
<span><span class="co">#&gt; SNF hyperparameters:</span></span>
<span><span class="co">#&gt; alpha                    0.5  0.4  0.3  0.3  0.5  0.4  0.7  0.8  0.3  0.6</span></span>
<span><span class="co">#&gt; k                         29   26   44   43   29   26   36   21   29   35  </span></span>
<span><span class="co">#&gt; t                         20   20   20   20   20   20   20   20   20   20  </span></span>
<span><span class="co">#&gt; SNF scheme:</span></span>
<span><span class="co">#&gt;                            2    1    2    1    2    2    2    3    1    3  </span></span>
<span><span class="co">#&gt; Clustering functions:</span></span>
<span><span class="co">#&gt;                            1    1    2    1    2    1    1    2    1    1  </span></span>
<span><span class="co">#&gt; Distance functions:</span></span>
<span><span class="co">#&gt; CNT                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; DSC                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; ORD                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; CAT                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; MIX                        1    1    1    1    1    1    1    1    1    1  </span></span>
<span><span class="co">#&gt; Component dropout:</span></span>
<span><span class="co">#&gt; cortical_thickness         ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; cortical_surface_area      ✖    ✔    ✖    ✔    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; subcortical_volume         ✔    ✔    ✖    ✖    ✔    ✔    ✔    ✔    ✔    ✔  </span></span>
<span><span class="co">#&gt; household_income           ✖    ✔    ✔    ✔    ✔    ✔    ✔    ✖    ✔    ✖  </span></span>
<span><span class="co">#&gt; pubertal_status            ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✔    ✖  </span></span>
<span><span class="co">#&gt; …and settings defined to create 10 more cluster solutions.</span></span></code></pre></div>
<p>The settings data frame stores information about:</p>
<ul>
<li>
<strong>SNF hyperparameters</strong>: <code>alpha</code>,
<code>k</code>, and <code>t</code> hyperparameters that are directly
used by the SNF algorithm.</li>
<li>
<strong>SNF scheme</strong>: the specific way in which input data
gets collapsed into a final fused network (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/snf_schemes.html">SNF
schemes vignette</a>).</li>
<li>
<strong>Clustering functions</strong>: Which clustering algorithm
will be applied to the final fused network produced by SNF.</li>
<li>
<strong>Distance function</strong>: Which distance metric will be
used when converting continuous, discrete, ordinal, categorical, or
mixed type data into intermediate distance matrices (discussed further
in the <a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics vignette</a>).</li>
<li>
<strong>Component dropout</strong> - Information on whether or not a
particular input data frame in the data list will be in included or
excluded from the corresponding SNF run (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/snf_config.html">SNF
config vignette</a>).</li>
</ul>
<p>The underlying structure of a settings data frame can be viewed by
converting it from a <code>settings_df</code> class object into a
regular <code>data.frame</code> class object:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">my_sc</span><span class="op">$</span><span class="st">"settings_df"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   solution alpha  k  t snf_scheme clust_alg cnt_dist dsc_dist ord_dist cat_dist</span></span>
<span><span class="co">#&gt; 1        1   0.5 29 20          2         1        1        1        1        1</span></span>
<span><span class="co">#&gt; 2        2   0.4 26 20          1         1        1        1        1        1</span></span>
<span><span class="co">#&gt; 3        3   0.3 44 20          2         2        1        1        1        1</span></span>
<span><span class="co">#&gt; 4        4   0.3 43 20          1         1        1        1        1        1</span></span>
<span><span class="co">#&gt; 5        5   0.5 29 20          2         2        1        1        1        1</span></span>
<span><span class="co">#&gt; 6        6   0.4 26 20          2         1        1        1        1        1</span></span>
<span><span class="co">#&gt;   mix_dist inc_cortical_thickness inc_cortical_surface_area</span></span>
<span><span class="co">#&gt; 1        1                      1                         0</span></span>
<span><span class="co">#&gt; 2        1                      1                         1</span></span>
<span><span class="co">#&gt; 3        1                      1                         0</span></span>
<span><span class="co">#&gt; 4        1                      1                         1</span></span>
<span><span class="co">#&gt; 5        1                      1                         1</span></span>
<span><span class="co">#&gt; 6        1                      1                         1</span></span>
<span><span class="co">#&gt;   inc_subcortical_volume inc_household_income inc_pubertal_status</span></span>
<span><span class="co">#&gt; 1                      1                    0                   1</span></span>
<span><span class="co">#&gt; 2                      1                    1                   1</span></span>
<span><span class="co">#&gt; 3                      0                    1                   1</span></span>
<span><span class="co">#&gt; 4                      0                    1                   1</span></span>
<span><span class="co">#&gt; 5                      1                    1                   1</span></span>
<span><span class="co">#&gt; 6                      1                    1                   1</span></span></code></pre></div>
<p>Each row of the settings data frame corresponds to a set of
hyperparameters that can be used for generating a cluster solution.
Without specifying any additional parameters, the
<code>snf_config</code> function randomly populates these columns and
ensures that no generated rows are identical. Further customization of
the <code>settings_df</code> and the other parts of the SNF config will
enable you to generate a broader space of cluster solutions from your
data and ideally get you closer to finding a more useful solution for
your context. More on <code>settings_df</code> customization can be
found in the <a href="https://branchlab.github.io/metasnf/articles/snf_config.html">SNF
config vignette</a>.</p>
<p>Setting a seed prior to calling <code><a href="../reference/snf_config.html">snf_config()</a></code> ensures
that the same random settings are generated each time we run the
code.</p>
</div>
<div class="section level3">
<h3 id="other-parts-of-the-snf-config">Other parts of the SNF config<a class="anchor" aria-label="anchor" href="#other-parts-of-the-snf-config"></a>
</h3>
<p>There are three other parts to an SNF config object: a distance
functions list (<code>dist_fns_list</code> class object) that stores
distance metric functions, a clustering functions list
(<code>clust_fns_list</code> class object) that stores clustering
algorithm functions, and a weights matrix (<code>weights_matrix</code>)
class object that stores feature weights.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_sc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "settings_df"    "dist_fns_list"  "clust_fns_list" "weights_matrix"</span></span></code></pre></div>
<p>Customizing each of these parts is explained in more detail in
separate vignettes:</p>
<ul>
<li><a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics</a></li>
<li><a href="https://branchlab.github.io/metasnf/articles/clustering_algorithms.html">clustering
functions list</a></li>
<li><a href="https://branchlab.github.io/metasnf/articles/feature_weights.html">weights
matrix</a></li>
</ul>
<p>For now, we’ll leave them as the default values generated during our
<code>snf_config</code> call.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-snf-and-clustering">Running SNF and clustering<a class="anchor" aria-label="anchor" href="#running-snf-and-clustering"></a>
</h2>
<p>The <code><a href="../reference/batch_snf.html">batch_snf()</a></code> function integrates the data in the data
list using all the hyperparameters, and functions contained in the SNF
config. The resulting structure is a <code>solutions_df</code> class
object, which contains an index column (<code>solution</code>), a column
tracking the number of clusters in the cluster solution
(<code>nclust</code>), a column labeling which meta cluster a solution
belongs to (<code>mc</code>; more on this later) and columns specifying
which cluster each subject was assigned to for each corresponding
solution.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">input_dl</span>, <span class="va">my_sc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol_df</span></span>
<span><span class="co">#&gt; 20 cluster solutions of 88 observations:</span></span>
<span><span class="co">#&gt; solution nclust mc uid_NDAR_INV0567T2Y9 uid_NDAR_INV0J4PYA5F </span></span>
<span><span class="co">#&gt;        1      5  .                    5                    2 </span></span>
<span><span class="co">#&gt;        2      3  .                    3                    3 </span></span>
<span><span class="co">#&gt;        3      9  .                    1                    7 </span></span>
<span><span class="co">#&gt;        4      2  .                    1                    2 </span></span>
<span><span class="co">#&gt;        5      8  .                    1                    6 </span></span>
<span><span class="co">#&gt;        6      2  .                    1                    2 </span></span>
<span><span class="co">#&gt;        7      4  .                    1                    4 </span></span>
<span><span class="co">#&gt;        8      5  .                    3                    4 </span></span>
<span><span class="co">#&gt;        9      3  .                    3                    3 </span></span>
<span><span class="co">#&gt;       10      4  .                    2                    4 </span></span>
<span><span class="co">#&gt;       11      8  .                    6                    5 </span></span>
<span><span class="co">#&gt;       12      8  .                    1                    7 </span></span>
<span><span class="co">#&gt;       13      2  .                    1                    2 </span></span>
<span><span class="co">#&gt;       14      3  .                    3                    3 </span></span>
<span><span class="co">#&gt;       15      3  .                    2                    2 </span></span>
<span><span class="co">#&gt;       16      8  .                    1                    4 </span></span>
<span><span class="co">#&gt;       17      3  .                    1                    2 </span></span>
<span><span class="co">#&gt;       18      9  .                    1                    7 </span></span>
<span><span class="co">#&gt;       19      2  .                    1                    2 </span></span>
<span><span class="co">#&gt;       20      3  .                    1                    3 </span></span>
<span><span class="co">#&gt; 85 observations not shown.</span></span>
<span><span class="co">#&gt; Use `print(n = ...)` to change the number of rows printed.</span></span>
<span><span class="co">#&gt; Use `t()` to view compact cluster solution format.</span></span></code></pre></div>
<p>Just like that, 20 different cluster solutions have been generated!
In practice, you may end up wanting to create hundreds or thousands of
cluster solutions at a time. If you have access to a multi-core system,
<code>batch_snf</code> can be run with parallel processing enabled. See
<code><a href="../reference/batch_snf.html">?batch_snf</a></code> or the <a href="https://branchlab.github.io/metasnf/articles/parallel_processing.html">parallel
processing vignette</a> for more information.</p>
<p>You can pull the clustering results out of each row in a more
convenient, transposed format using the <code><a href="https://rdrr.io/r/base/t.html" class="external-link">t()</a></code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">sol_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cluster_solutions</span></span>
<span><span class="co">#&gt; 20 cluster solutions of 87 observations:</span></span>
<span><span class="co">#&gt;                  uid      s1    s2    s3    s4    s5    s6    s7    s8    s9 </span></span>
<span><span class="co">#&gt; uid_NDAR_INV0567T2Y9       5     3     1     1     1     1     1     3     3</span></span>
<span><span class="co">#&gt; uid_NDAR_INV0J4PYA5F       2     3     7     2     6     2     4     4     3</span></span>
<span><span class="co">#&gt; uid_NDAR_INV10OMKVLE       1     2     3     1     4     2     3     1     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV15FPCW4O       1     2     5     2     5     2     3     1     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV19NB4RJK       4     2     9     1     7     2     3     2     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV1HLGR738       4     2     9     1     7     2     3     2     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV1KR0EZFU       4     2     9     1     7     2     3     2     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV1L3Y9EOP       1     2     5     2     5     2     3     1     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV1TCP5GNM       1     2     3     1     4     2     3     1     2</span></span>
<span><span class="co">#&gt; uid_NDAR_INV1ZHRDJ6B       3     1     4     1     7     1     3     5     2</span></span>
<span><span class="co">#&gt; 11 solutions and 77 observations not shown.</span></span></code></pre></div>
<p>When transposed, the <code>solutions_df</code> class object is
converted to a <code>t_solutions_df</code> class object, which only
contains columns indicating what cluster each observation was assigned
to for each solution. Calling <code><a href="https://rdrr.io/r/base/t.html" class="external-link">t()</a></code> on a
<code>t_solutions_df</code> class object will return it back to its
original <code>solutions_df</code> form.</p>
</div>
<div class="section level2">
<h2 id="identifying-and-visualizing-meta-clusters">Identifying and visualizing meta clusters<a class="anchor" aria-label="anchor" href="#identifying-and-visualizing-meta-clusters"></a>
</h2>
<p>Now that we have access to 20 different clustering solutions, we’ll
need to find some way to pick an optimal one to move forward with for
additional characterization. In this case, plotting or running stats
manually on each of the solutions might be a reasonable way to determine
which ones may be the most suitable for our purpose. But when the number
of solutions generated goes up into the hundreds (or thousands), these
approaches can become impractical or inefficient.</p>
<p>The main approach we recommend using is the meta clustering approach
described in Caruana et al., 2006. Meta clustering is a useful approach
when the criteria for cluster solution evaluation is difficult to
formalize and fully automate. Meta clustering consists of clustering the
<em>clustering solutions themselves</em> to yield a manageable number of
qualitatively similar meta cluster solutions that are representative of
the full set of solutions. Characterization of these representative
solutions then enables efficient identification of a maximally useful
cluster solution for the user’s context.</p>
<p>The first step in meta clustering is to calculate the <a href="https://en.wikipedia.org/wiki/Rand_index" class="external-link">adjusted Rand index</a>
(ARI) between each pair of cluster solutions. This metric tells us how
similar the solutions are to each other, thereby allowing us to find
clusters of cluster solutions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_aris.html">calc_aris</a></span><span class="op">(</span><span class="va">sol_df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sol_aris</span><span class="op">)</span></span>
<span><span class="co">#&gt;              1           2          3           4         5            6</span></span>
<span><span class="co">#&gt; 1  1.000000000 0.218100590 0.35800283  0.09198688 0.3339236 -0.009662126</span></span>
<span><span class="co">#&gt; 2  0.218100590 1.000000000 0.12228563  0.39080820 0.1105609  0.003498222</span></span>
<span><span class="co">#&gt; 3  0.358002830 0.122285629 1.00000000  0.09223984 0.9198380  0.148497948</span></span>
<span><span class="co">#&gt; 4  0.091986880 0.390808202 0.09223984  1.00000000 0.1044646 -0.010992366</span></span>
<span><span class="co">#&gt; 5  0.333923648 0.110560919 0.91983800  0.10446463 1.0000000  0.139423435</span></span>
<span><span class="co">#&gt; 6 -0.009662126 0.003498222 0.14849795 -0.01099237 0.1394234  1.000000000</span></span>
<span><span class="co">#&gt;           7            8            9           10         11         12</span></span>
<span><span class="co">#&gt; 1 0.3122805  0.985571647  0.184638496 -0.007803111 0.33345117 0.32740960</span></span>
<span><span class="co">#&gt; 2 0.2266315  0.218100590  0.739642746  0.110378721 0.11011298 0.10590391</span></span>
<span><span class="co">#&gt; 3 0.4016563  0.352103928  0.116420078  0.025181313 0.34801226 0.86702876</span></span>
<span><span class="co">#&gt; 4 0.1473154  0.090888255  0.383117736  0.056136556 0.06492901 0.09895702</span></span>
<span><span class="co">#&gt; 5 0.4287386  0.328140061  0.113350503  0.026586178 0.37117718 0.94930818</span></span>
<span><span class="co">#&gt; 6 0.1173848 -0.008587445 -0.009399846  0.080927374 0.03658809 0.12770892</span></span>
<span><span class="co">#&gt;             13         14          15         16          17         18</span></span>
<span><span class="co">#&gt; 1 -0.004345222 0.26524492 0.454325992 0.34471546 0.040016509 0.33147042</span></span>
<span><span class="co">#&gt; 2  0.015687397 0.82701443 0.540257037 0.08517795 0.346046427 0.11234084</span></span>
<span><span class="co">#&gt; 3  0.129327985 0.16382156 0.150978496 0.36949470 0.308667407 0.83178781</span></span>
<span><span class="co">#&gt; 4 -0.011113440 0.33362219 0.262466384 0.08044088 0.346814616 0.09886886</span></span>
<span><span class="co">#&gt; 5  0.119335766 0.16097201 0.130494941 0.40333960 0.323486798 0.90132585</span></span>
<span><span class="co">#&gt; 6  0.820431860 0.01761236 0.003709145 0.05849401 0.001163327 0.11636380</span></span>
<span><span class="co">#&gt;             19           20</span></span>
<span><span class="co">#&gt; 1 -0.011728122 -0.003824144</span></span>
<span><span class="co">#&gt; 2  0.001609130  0.220132508</span></span>
<span><span class="co">#&gt; 3  0.132539025  0.378077560</span></span>
<span><span class="co">#&gt; 4 -0.006284415  0.234968435</span></span>
<span><span class="co">#&gt; 5  0.141545836  0.409562670</span></span>
<span><span class="co">#&gt; 6  0.820046953 -0.004462880</span></span></code></pre></div>
<p>We can visualize the resulting inter-cluster similarities with a
heatmap. Heatmaps in the <code>metasnf</code> package are constructed
using the <a href="https://bioconductor.org/packages/release/bioc/html/ComplexHeatmap.html" class="external-link"><code>ComplexHeatmap</code></a>
and <a href="https://bioconductor.org/packages/release/bioc/html/InteractiveComplexHeatmap.html" class="external-link"><code>InteractiveComplexHeatmap</code></a>
packages from <a href="https://bioconductor.org/" class="external-link">Bioconductor</a>. If
you don’t already have these packages, you can install them with the
following code:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.github.io/BiocManager/" class="external-link">"BiocManager"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To make heatmaps with metasnf</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"ComplexHeatmap"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To use heatmap shiny app (later in vignette) with metasnf</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"InteractiveComplexHeatmap"</span><span class="op">)</span></span></code></pre></div>
<p>First, call <code><a href="../reference/get_matrix_order.html">get_matrix_order()</a></code> to get a hierarchical
clustering-based ordering of the rows in the adjusted rand indices.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_cluster_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_matrix_order.html">get_matrix_order</a></span><span class="op">(</span><span class="va">sol_aris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Just a vector of numbers</span></span>
<span><span class="va">meta_cluster_order</span></span>
<span><span class="co">#&gt;  [1] 10 19  6 13  3 18  5 12  7 17 20  4 15  9  2 14  1  8 11 16</span></span></code></pre></div>
<p>This order can be passed into the <code>meta_cluster_heatmap</code>
function to get a clearer view of existing meta clusters.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_cluster_heatmap.html">meta_cluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ari_hm</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/meta_cluster_heatmap.png">
</center>
<p>The clustering solutions are along the rows and columns of the above
figure, and the cells at the intersection between two solutions show how
similar they are to each other based on their ARI. The diagonals should
always be red, representing the maximum value of 1, as they show
self-similarity. Complete-linkage, Euclidean-distance based hierarchical
clustering is being applied to these solutions to obtain the row
ordering. This is also the default approach used by the
<code>ComplexHeatmap</code> package, the backbone of all heatmap
functions in <code>metasnf</code>.</p>
<p>This heatmap is integral to identifying the meta clusters created
from your data using the space of parameters defined in the SNF config.
We will later see how to further customize this heatmap to add in rich
information about how each plotted cluster solution differs on various
measures of quality, different clustering settings, and different levels
of separation on input and out-of-model measures.</p>
<p>First, we’ll divide the heatmap into meta clusters by visual
inspection. The indices of our meta cluster boundaries can be passed
into the <code>meta_cluster_heatmap</code> function as the
<code>split_vector</code> parameter. You can determine this vector
either by trial and error (repeated replotting with different
<code>split_vector</code> values) or by using the
<code>shiny_annotator</code> function, a wrapper around functionality
from the <code>InteractiveComplexHeatmap</code> package.</p>
<p>While the shiny app is running, your R console will be unresponsive.
Clicking on meta cluster cell boundaries and tracking the row/column
indices (printed to the R console as well as displayed in the app) can
get us the following vector:</p>
<p>A demonstration of the shiny app can be seen here: <a href="https://pvelayudhan.shinyapps.io/shiny/" class="external-link">Meta Cluster
Identification</a></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/shiny_annotator.html">shiny_annotator</a></span><span class="op">(</span><span class="va">ari_hm</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/meta_cluster_shiny_l.png">
</center>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span></span></code></pre></div>
<p>This vector can be used to populate the meta cluster column in our
solutions data frame as well as visualize our meta cluster boundaries
more clearly.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/label_meta_clusters.html">label_meta_clusters</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_df</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mc_sol_df</span></span>
<span><span class="co">#&gt; 20 cluster solutions of 88 observations:</span></span>
<span><span class="co">#&gt; solution nclust mc uid_NDAR_INV0567T2Y9 uid_NDAR_INV0J4PYA5F </span></span>
<span><span class="co">#&gt;        1      5 E                     5                    2 </span></span>
<span><span class="co">#&gt;        2      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;        3      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;        4      2 D                     1                    2 </span></span>
<span><span class="co">#&gt;        5      8 C                     1                    6 </span></span>
<span><span class="co">#&gt;        6      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;        7      4 C                     1                    4 </span></span>
<span><span class="co">#&gt;        8      5 E                     3                    4 </span></span>
<span><span class="co">#&gt;        9      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       10      4 A                     2                    4 </span></span>
<span><span class="co">#&gt;       11      8 E                     6                    5 </span></span>
<span><span class="co">#&gt;       12      8 C                     1                    7 </span></span>
<span><span class="co">#&gt;       13      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       14      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       15      3 D                     2                    2 </span></span>
<span><span class="co">#&gt;       16      8 E                     1                    4 </span></span>
<span><span class="co">#&gt;       17      3 C                     1                    2 </span></span>
<span><span class="co">#&gt;       18      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;       19      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       20      3 C                     1                    3 </span></span>
<span><span class="co">#&gt; 85 observations not shown.</span></span>
<span><span class="co">#&gt; Use `print(n = ...)` to change the number of rows printed.</span></span>
<span><span class="co">#&gt; Use `t()` to view compact cluster solution format.</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ari_mc_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_cluster_heatmap.html">meta_cluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ari_mc_hm</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/ari_mc_hm.png">
</center>
<p>At this point, we have our meta clusters but are not yet sure of how
they differ in terms of their structure across our input and
out-of-model features.</p>
</div>
<div class="section level2">
<h2 id="characterizing-cluster-solutions">Characterizing cluster solutions<a class="anchor" aria-label="anchor" href="#characterizing-cluster-solutions"></a>
</h2>
<div class="section level3">
<h3 id="calculating-associations-between-cluster-solutions-and-initial-data">Calculating associations between cluster solutions and initial
data<a class="anchor" aria-label="anchor" href="#calculating-associations-between-cluster-solutions-and-initial-data"></a>
</h3>
<p>We start by running the <code>extend_solutions</code> function, which
will calculate p-values representing the strength of the association
between cluster membership (treated as a categorical feature) and any
feature present in a provided data list and/or target_list.</p>
<p><code>extend_solutions</code> also adds summary p-value measures
(min, mean, and max) of any features present in the target list. This
function can be quite slow depending on how large your data is; you can
monitor its progress by setting <code>verbose = TRUE</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only looking at our out-of-model p-values</span></span>
<span><span class="va">ext_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_sol_df</span>,</span>
<span>    target_dl <span class="op">=</span> <span class="va">target_dl</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; --</span></span>
<span></span>
<span><span class="va">ext_sol_df</span></span>
<span><span class="co">#&gt; 20 cluster solutions, 87 observations, and p-values for 2 features.</span></span>
<span><span class="co">#&gt; Cluster assignment columns:</span></span>
<span><span class="co">#&gt; solution nclust mc uid_NDAR_INV0567T2Y9 uid_NDAR_INV0J4PYA5F </span></span>
<span><span class="co">#&gt;        1      5 E                     5                    2 </span></span>
<span><span class="co">#&gt;        2      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;        3      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;        4      2 D                     1                    2 </span></span>
<span><span class="co">#&gt;        5      8 C                     1                    6 </span></span>
<span><span class="co">#&gt;        6      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;        7      4 C                     1                    4 </span></span>
<span><span class="co">#&gt;        8      5 E                     3                    4 </span></span>
<span><span class="co">#&gt;        9      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       10      4 A                     2                    4 </span></span>
<span><span class="co">#&gt;       11      8 E                     6                    5 </span></span>
<span><span class="co">#&gt;       12      8 C                     1                    7 </span></span>
<span><span class="co">#&gt;       13      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       14      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       15      3 D                     2                    2 </span></span>
<span><span class="co">#&gt;       16      8 E                     1                    4 </span></span>
<span><span class="co">#&gt;       17      3 C                     1                    2 </span></span>
<span><span class="co">#&gt;       18      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;       19      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       20      3 C                     1                    3 </span></span>
<span><span class="co">#&gt; Association p-value columns:</span></span>
<span><span class="co">#&gt; solution cbcl_anxiety_r_pval cbcl_depress_r_pval</span></span>
<span><span class="co">#&gt;        1 7.3443e-01          7.2635e-01         </span></span>
<span><span class="co">#&gt;        2 6.6445e-01          3.2380e-01         </span></span>
<span><span class="co">#&gt;        3 3.9613e-01          6.8171e-01         </span></span>
<span><span class="co">#&gt;        4 4.8438e-01          7.5641e-01         </span></span>
<span><span class="co">#&gt;        5 2.2567e-01          7.8953e-01         </span></span>
<span><span class="co">#&gt;        6 2.5664e-01          1.3248e-01         </span></span>
<span><span class="co">#&gt;        7 1.2296e-01          2.8322e-01         </span></span>
<span><span class="co">#&gt;        8 7.6478e-01          7.1118e-01         </span></span>
<span><span class="co">#&gt;        9 5.1104e-01          8.6022e-01         </span></span>
<span><span class="co">#&gt;       10 1.0338e-02          2.6313e-02         </span></span>
<span><span class="co">#&gt;       11 1.9628e-01          1.6880e-01         </span></span>
<span><span class="co">#&gt;       12 2.3521e-01          7.4583e-01         </span></span>
<span><span class="co">#&gt;       13 7.1565e-02          3.6618e-01         </span></span>
<span><span class="co">#&gt;       14 3.2599e-01          4.9897e-01         </span></span>
<span><span class="co">#&gt;       15 5.9020e-01          9.1458e-01         </span></span>
<span><span class="co">#&gt;       16 3.6360e-01          4.1880e-01         </span></span>
<span><span class="co">#&gt;       17 5.3258e-01          3.7772e-01         </span></span>
<span><span class="co">#&gt;       18 2.8001e-01          2.8812e-01         </span></span>
<span><span class="co">#&gt;       19 4.1679e-01          5.7198e-02         </span></span>
<span><span class="co">#&gt;       20 7.0783e-02          9.2083e-01         </span></span>
<span><span class="co">#&gt; Summary p-value columns:</span></span>
<span><span class="co">#&gt; solution min_pval  mean_pval max_pval  </span></span>
<span><span class="co">#&gt;        1 7.263e-01 7.304e-01 7.344e-01 </span></span>
<span><span class="co">#&gt;        2 3.238e-01 4.941e-01 6.644e-01 </span></span>
<span><span class="co">#&gt;        3 3.961e-01 5.389e-01 6.817e-01 </span></span>
<span><span class="co">#&gt;        4 4.844e-01 6.204e-01 7.564e-01 </span></span>
<span><span class="co">#&gt;        5 2.257e-01 5.076e-01 7.895e-01 </span></span>
<span><span class="co">#&gt;        6 1.325e-01 1.946e-01 2.566e-01 </span></span>
<span><span class="co">#&gt;        7 1.230e-01 2.031e-01 2.832e-01 </span></span>
<span><span class="co">#&gt;        8 7.112e-01 7.380e-01 7.648e-01 </span></span>
<span><span class="co">#&gt;        9 5.110e-01 6.856e-01 8.602e-01 </span></span>
<span><span class="co">#&gt;       10 1.034e-02 1.833e-02 2.631e-02 </span></span>
<span><span class="co">#&gt;       11 1.688e-01 1.825e-01 1.963e-01 </span></span>
<span><span class="co">#&gt;       12 2.352e-01 4.905e-01 7.458e-01 </span></span>
<span><span class="co">#&gt;       13 7.157e-02 2.189e-01 3.662e-01 </span></span>
<span><span class="co">#&gt;       14 3.260e-01 4.125e-01 4.990e-01 </span></span>
<span><span class="co">#&gt;       15 5.902e-01 7.524e-01 9.146e-01 </span></span>
<span><span class="co">#&gt;       16 3.636e-01 3.912e-01 4.188e-01 </span></span>
<span><span class="co">#&gt;       17 3.777e-01 4.552e-01 5.326e-01 </span></span>
<span><span class="co">#&gt;       18 2.800e-01 2.841e-01 2.881e-01 </span></span>
<span><span class="co">#&gt;       19 5.720e-02 2.370e-01 4.168e-01 </span></span>
<span><span class="co">#&gt;       20 7.078e-02 4.958e-01 9.208e-01 </span></span>
<span><span class="co">#&gt; Summaries calculated from 2 features. Use `summary_features(x)` to see them.</span></span>
<span><span class="co">#&gt; Use `print(n = ...)` to change the number of rows printed.</span></span>
<span><span class="co">#&gt; Use `t()` to view compact cluster solution format.</span></span>
<span></span>
<span><span class="co"># Re-running to calculate the p-value for every single input and out-of-model</span></span>
<span><span class="co"># feature:</span></span>
<span><span class="va">ext_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_sol_df</span>,</span>
<span>    dl <span class="op">=</span> <span class="va">input_dl</span>,</span>
<span>    target_dl <span class="op">=</span> <span class="va">target_dl</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; --</span></span>
<span></span>
<span><span class="va">ext_sol_df</span></span>
<span><span class="co">#&gt; 20 cluster solutions, 87 observations, and p-values for 336 features.</span></span>
<span><span class="co">#&gt; Cluster assignment columns:</span></span>
<span><span class="co">#&gt; solution nclust mc uid_NDAR_INV0567T2Y9 uid_NDAR_INV0J4PYA5F </span></span>
<span><span class="co">#&gt;        1      5 E                     5                    2 </span></span>
<span><span class="co">#&gt;        2      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;        3      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;        4      2 D                     1                    2 </span></span>
<span><span class="co">#&gt;        5      8 C                     1                    6 </span></span>
<span><span class="co">#&gt;        6      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;        7      4 C                     1                    4 </span></span>
<span><span class="co">#&gt;        8      5 E                     3                    4 </span></span>
<span><span class="co">#&gt;        9      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       10      4 A                     2                    4 </span></span>
<span><span class="co">#&gt;       11      8 E                     6                    5 </span></span>
<span><span class="co">#&gt;       12      8 C                     1                    7 </span></span>
<span><span class="co">#&gt;       13      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       14      3 D                     3                    3 </span></span>
<span><span class="co">#&gt;       15      3 D                     2                    2 </span></span>
<span><span class="co">#&gt;       16      8 E                     1                    4 </span></span>
<span><span class="co">#&gt;       17      3 C                     1                    2 </span></span>
<span><span class="co">#&gt;       18      9 C                     1                    7 </span></span>
<span><span class="co">#&gt;       19      2 B                     1                    2 </span></span>
<span><span class="co">#&gt;       20      3 C                     1                    3 </span></span>
<span><span class="co">#&gt; Association p-value columns:</span></span>
<span><span class="co">#&gt; solution mrisdp_1_pval mrisdp_2_pval mrisdp_3_pval mrisdp_4_pval</span></span>
<span><span class="co">#&gt;        1 4.0778e-01    8.7353e-01    1.8227e-01    6.4527e-01   </span></span>
<span><span class="co">#&gt;        2 2.9963e-01    3.7253e-01    6.0899e-01    2.9392e-02   </span></span>
<span><span class="co">#&gt;        3 2.4552e-01    2.2052e-01    1.1472e-01    5.2578e-01   </span></span>
<span><span class="co">#&gt;        4 2.0034e-01    8.0738e-01    3.5087e-01    4.7769e-01   </span></span>
<span><span class="co">#&gt;        5 1.8555e-01    4.5421e-01    1.0940e-01    4.5550e-01   </span></span>
<span><span class="co">#&gt;        6 7.9908e-01    3.7914e-02    4.8240e-01    7.0521e-01   </span></span>
<span><span class="co">#&gt;        7 4.7354e-01    3.7364e-01    1.0889e-01    8.1730e-01   </span></span>
<span><span class="co">#&gt;        8 4.0837e-01    6.6968e-01    1.6713e-01    6.7935e-01   </span></span>
<span><span class="co">#&gt;        9 2.5205e-01    3.4546e-01    3.6226e-01    1.4636e-02   </span></span>
<span><span class="co">#&gt;       10 5.2398e-01    4.1312e-01    2.9576e-01    1.9681e-01   </span></span>
<span><span class="co">#&gt;       11 7.0939e-01    6.5038e-01    1.8298e-01    4.1306e-01   </span></span>
<span><span class="co">#&gt;       12 8.9372e-02    5.4315e-01    8.2658e-02    4.6838e-01   </span></span>
<span><span class="co">#&gt;       13 8.0601e-01    1.4606e-01    4.2591e-01    9.5444e-01   </span></span>
<span><span class="co">#&gt;       14 5.7455e-01    7.0770e-01    7.9210e-01    1.0353e-01   </span></span>
<span><span class="co">#&gt;       15 2.1786e-01    5.9972e-01    4.7704e-01    6.4758e-01   </span></span>
<span><span class="co">#&gt;       16 8.5715e-01    2.2775e-01    4.6667e-01    1.3886e-01   </span></span>
<span><span class="co">#&gt;       17 3.2033e-01    8.5910e-01    2.8084e-02    6.1770e-01   </span></span>
<span><span class="co">#&gt;       18 2.2032e-01    7.6731e-01    1.6478e-01    2.1663e-01   </span></span>
<span><span class="co">#&gt;       19 3.8095e-01    5.3117e-02    9.6942e-01    6.3366e-01   </span></span>
<span><span class="co">#&gt;       20 6.3653e-01    4.2646e-01    9.0177e-02    4.1032e-01   </span></span>
<span><span class="co">#&gt; Summary p-value columns:</span></span>
<span><span class="co">#&gt; solution min_pval  mean_pval max_pval  </span></span>
<span><span class="co">#&gt;        1 7.263e-01 7.304e-01 7.344e-01 </span></span>
<span><span class="co">#&gt;        2 3.238e-01 4.941e-01 6.644e-01 </span></span>
<span><span class="co">#&gt;        3 3.961e-01 5.389e-01 6.817e-01 </span></span>
<span><span class="co">#&gt;        4 4.844e-01 6.204e-01 7.564e-01 </span></span>
<span><span class="co">#&gt;        5 2.257e-01 5.076e-01 7.895e-01 </span></span>
<span><span class="co">#&gt;        6 1.325e-01 1.946e-01 2.566e-01 </span></span>
<span><span class="co">#&gt;        7 1.230e-01 2.031e-01 2.832e-01 </span></span>
<span><span class="co">#&gt;        8 7.112e-01 7.380e-01 7.648e-01 </span></span>
<span><span class="co">#&gt;        9 5.110e-01 6.856e-01 8.602e-01 </span></span>
<span><span class="co">#&gt;       10 1.034e-02 1.833e-02 2.631e-02 </span></span>
<span><span class="co">#&gt;       11 1.688e-01 1.825e-01 1.963e-01 </span></span>
<span><span class="co">#&gt;       12 2.352e-01 4.905e-01 7.458e-01 </span></span>
<span><span class="co">#&gt;       13 7.157e-02 2.189e-01 3.662e-01 </span></span>
<span><span class="co">#&gt;       14 3.260e-01 4.125e-01 4.990e-01 </span></span>
<span><span class="co">#&gt;       15 5.902e-01 7.524e-01 9.146e-01 </span></span>
<span><span class="co">#&gt;       16 3.636e-01 3.912e-01 4.188e-01 </span></span>
<span><span class="co">#&gt;       17 3.777e-01 4.552e-01 5.326e-01 </span></span>
<span><span class="co">#&gt;       18 2.800e-01 2.841e-01 2.881e-01 </span></span>
<span><span class="co">#&gt;       19 5.720e-02 2.370e-01 4.168e-01 </span></span>
<span><span class="co">#&gt;       20 7.078e-02 4.958e-01 9.208e-01 </span></span>
<span><span class="co">#&gt; Summaries calculated from 2 features. Use `summary_features(x)` to see them.</span></span>
<span><span class="co">#&gt; 332 features not shown.</span></span>
<span><span class="co">#&gt; Use `print(n = ...)` to change the number of rows printed.</span></span>
<span><span class="co">#&gt; Use `t()` to view compact cluster solution format.</span></span></code></pre></div>
<p>Functionally, the only difference between the data list passed into
the <code>dl</code> parameter and the one passed into the
<code>target_dl</code> parameter is that the <code>target_dl</code>
features are the only ones used for generating the p-value summary
columns.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># No features are used to calculate summary p-values</span></span>
<span><span class="va">ext_sol_df_no_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_sol_df</span>,</span>
<span>    dl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_dl</span>, <span class="va">target_dl</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Every features are used to calculate summary p-values</span></span>
<span><span class="va">ext_sol_df_all_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">mc_sol_df</span>,</span>
<span>    target_dl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input_dl</span>, <span class="va">target_dl</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-feature-associations-with-meta-clustering-results">Visualizing feature associations with meta clustering results<a class="anchor" aria-label="anchor" href="#visualizing-feature-associations-with-meta-clustering-results"></a>
</h3>
<p>This <code>ext_sol_df</code> we created can be converted into a
standard data frame and passed into the
<code>meta_cluster_heatmap</code> function to easily visualize the level
of separation on each of our features for each of our cluster
solutions.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotated_ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_cluster_heatmap.html">meta_cluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ext_sol_df</span><span class="op">)</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Overall outcomes p-value"</span> <span class="op">=</span> <span class="st">"mean_pval"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Overall outcomes p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"mean_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/annotated_ari_hm_l.png">
</center>
<p>The <code>meta_cluster_heatmap</code> function wraps around a more
generic <code>similarity_matrix_heatmap</code> function in this package,
which itself is a wrapper around <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code>.
Consequently, any parameter that can be used with
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code> package can be used here. This
also makes the documentation for the <code>ComplexHeatmap</code> package
one of the best places to learn more about what can be done for further
customizing these heatmaps.</p>
<p>The data for the annotations don’t necessarily need to come from
functions in <code>metasnf</code>. For example, to highlight the
solutions where two very specific observations happened to cluster
together, we can easily add that information in as another annotation.
By converting an <code>ext_solutions_df</code> class object into a data
frame with the parameter <code>keep_attributes = TRUE</code>, the
resulting data frame will retain the p-value information from the
<code>ext_solutions_df</code> side of things, cluster assignment columns
from the <code>solutions_df</code> side of things, and
<code>settings_df</code> and <code>weights_matrix</code> columns from
the embedded original SNF config.</p>
<p>Then, we can use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate()</a></code> to create a new column
flagging when two observations co-cluster.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotation_data</span> <span class="op">&lt;-</span> <span class="va">ext_sol_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>keep_attributes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        key_subjects_cluster_together <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">uid_NDAR_INVLF3TNDUZ</span> <span class="op">==</span> <span class="va">uid_NDAR_INVLDQH8ATK</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">annotated_ari_hm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_cluster_heatmap.html">meta_cluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="va">annotation_data</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Key Subjects Clustered Together"</span> <span class="op">=</span> <span class="st">"key_subjects_cluster_together"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Key Subjects Clustered Together"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/annotated_ari_hm2_l.png">
</center>
</div>
<div class="section level3">
<h3 id="characterizing-individual-solutions-representative-of-each-meta-cluster">Characterizing individual solutions representative of each meta
cluster<a class="anchor" aria-label="anchor" href="#characterizing-individual-solutions-representative-of-each-meta-cluster"></a>
</h3>
<p>Now that we’ve visually delineated our meta clusters, we can get a
quick summary of what sort of separation exists across our input and
held out features by taking a closer look at one representative cluster
solution from each meta cluster.</p>
<p>This can be achieved by the <code>get_representative_solutions</code>
function, which extracts one cluster solution per meta cluster based on
having the highest average ARI with the other solutions in that meta
cluster.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_representative_solutions.html">get_representative_solutions</a></span><span class="op">(</span><span class="va">sol_aris</span>, <span class="va">ext_sol_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mc_manhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc_manhattan_plot.html">mc_manhattan_plot</a></span><span class="op">(</span></span>
<span>    <span class="va">rep_solutions</span>,</span>
<span>    dl <span class="op">=</span> <span class="va">input_dl</span>,</span>
<span>    target_dl <span class="op">=</span> <span class="va">target_dl</span>,</span>
<span>    hide_x_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    text_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    neg_log_pval_thresh <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>neg_log_pval_thresh</code> sets a threshold for the negative
log of the p-values to be displayed. At a value of 5, any p-value that
is smaller than 1e-5 will be truncated to 1e-5.</p>
<p>The plot as it is is a bit unwieldy plot given how many neuroimaging
ROIs are present. Let’s take out the cortical thickness and surface area
measures to make the plot a little clearer.</p>
<p>We’ll also be able to read some feature measures more clearly when we
dial the number of features plotted back a bit, as well.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_solutions_no_cort</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rep_solutions</span>, <span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"mrisdp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mc_manhattan2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc_manhattan_plot.html">mc_manhattan_plot</a></span><span class="op">(</span></span>
<span>    ext_sol_df <span class="op">=</span> <span class="va">rep_solutions_no_cort</span>,</span>
<span>    dl <span class="op">=</span> <span class="va">input_dl</span>,</span>
<span>    target_dl <span class="op">=</span> <span class="va">target_dl</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    text_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    domain_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"neuroimaging"</span> <span class="op">=</span> <span class="st">"cadetblue"</span>,</span>
<span>        <span class="st">"demographics"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>        <span class="st">"behaviour"</span> <span class="op">=</span> <span class="st">"firebrick"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/mc_manhattan2_l.png">
</center>
<p>Note that the Manhattan plot automatically uses a vertical line to
separate features in the data_list argument from those in the
target_list. Vertical boundaries can be controlled with the
<code>xints</code> parameter.</p>
</div>
<div class="section level3">
<h3 id="relating-results-to-metasnf-hyperparameters">Relating results to <code>metasnf</code> hyperparameters<a class="anchor" aria-label="anchor" href="#relating-results-to-metasnf-hyperparameters"></a>
</h3>
<p>If you see something interesting in your heatmap, you may be curious
to know how that corresponds to the settings that were in your settings
data frame.</p>
<p>You could certainly stack on each setting to the ARI heatmap as
annotations, but that may be a bit cumbersome given how many settings
there are. Another option is to start by taking a first look at entire
<code>settings_df</code>, sorted by the meta cluster results, through
the <code>settings_df_heatmap</code> function. The settings can be
passed in through either an <code>snf_config</code> or
<code>settings_df</code> class object.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">config_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/config_heatmap.html">config_heatmap</a></span><span class="op">(</span></span>
<span>    sc <span class="op">=</span> <span class="va">my_sc</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    hide_fixed <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/config_hm.png">
</center>
<p>This heatmap rescales all the columns in the settings_df to have a
maximum value of 1. The purpose of re-ordering the settings data frame
in this way is to see if any associations exist between certain settings
values and pairwise cluster solution similarities. If there are any
particular important settings, you can simply add them into your
adjusted rand index heatmap annotations. Recall that the
<code>solutions_df</code> class (and, by extension, the
<code>ext_solutions_df</code> class that contains a
<code>solutions_df</code> object as an attribute) contain the SNF config
as an attribute, so no further data manipulation is needed to add a
setting as a heatmap annotation.</p>
<p>Give it a try with the code below:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotation_data</span> <span class="op">&lt;-</span> <span class="va">ext_sol_df</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>keep_attributes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        key_subjects_cluster_together <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">uid_NDAR_INVLF3TNDUZ</span> <span class="op">==</span> <span class="va">uid_NDAR_INVLDQH8ATK</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">annotation_data</span><span class="op">$</span><span class="st">"clust_alg"</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">annotation_data</span><span class="op">$</span><span class="st">"clust_alg"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annotated_ari_hm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_cluster_heatmap.html">meta_cluster_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">sol_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="va">annotation_data</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Key Subjects Clustered Together"</span> <span class="op">=</span> <span class="st">"key_subjects_cluster_together"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Clustering Algorithm"</span> <span class="op">=</span> <span class="st">"clust_alg"</span> <span class="co"># from the original settings</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span> <span class="co"># also from the original settings</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Key Subjects Clustered Together"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">annotated_ari_hm3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quality-measures">Quality measures<a class="anchor" aria-label="anchor" href="#quality-measures"></a>
</h3>
<p>Quality metrics are another useful heuristic for the goodness of a
cluster that don’t require any contextualization of results in the
domain they may be used in. metasnf enables measures of silhouette
scores, Dunn indices, and Davies-Bouldin indices. To calculate these
values, we’ll need not only the cluster results but also the final fused
network (the similarity matrices produced by SNF) that the clusters came
from. These similarity matrices can be collected from the
<code>batch_snf</code> using the <code>return_sim_mats</code>
parameter:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span>dl <span class="op">=</span> <span class="va">input_dl</span>, sc <span class="op">=</span> <span class="va">my_sc</span>, return_sim_mats <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now, the solutions data frame contains a non-empty list of similarity
matrices as one of its attributes. These similarity matrices are the
final SNF-derived networks from each SNF run. Using that attribute, we
can calculate the above mentioned quality metrics:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silhouette_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quality_measures.html">calculate_silhouettes</a></span><span class="op">(</span><span class="va">sol_df</span><span class="op">)</span></span>
<span><span class="va">dunn_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quality_measures.html">calculate_dunn_indices</a></span><span class="op">(</span><span class="va">sol_df</span><span class="op">)</span></span>
<span><span class="va">db_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quality_measures.html">calculate_db_indices</a></span><span class="op">(</span><span class="va">sol_df</span><span class="op">)</span></span></code></pre></div>
<p>The first function is a wrapper around
<code><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">cluster::silhouette</a></code> while the second and third come from
the <em>clv</em> package. <em>clv</em> isn’t set as a mandatory part of
the installation, so you’ll ned to install it yourself to calculate
these two metrics.</p>
<p>The original documentation on these functions can be helpful for
interpreting and working with them:</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.rdocumentation.org/packages/cluster/versions/2.1.4/topics/silhouette" class="external-link"><code>cluster::silhouette</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Dunn" class="external-link"><code>clv::clv.Dunn</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Davies.Bouldin" class="external-link"><code>clv::clv.Davies.Bouldin</code>
documentation</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="stability-measures">Stability measures<a class="anchor" aria-label="anchor" href="#stability-measures"></a>
</h3>
<p>metasnf offers tools to evaluate two different measures of
stability:</p>
<ol style="list-style-type: decimal">
<li>Pairwise adjusted Rand indices (across resamplings of the
clustering, on average, how similar was every pair of solutions
according to the adjusted Rand index?)</li>
<li>Fraction clustered together (what is the average fraction of times
that observations who clustered together in the full results clustered
together in resampled results?)</li>
</ol>
<p>You can learn more about running stability calculations in the <a href="https://branchlab.github.io/metasnf/articles/stability_measures.html">stability
and coclustering vignette</a>.</p>
</div>
<div class="section level3">
<h3 id="evaluating-separation-across-target-features-of-importance">Evaluating separation across “target features” of importance<a class="anchor" aria-label="anchor" href="#evaluating-separation-across-target-features-of-importance"></a>
</h3>
<p>If you can specify a metric or objective function that may tell you
how useful a clustering solution will be for your purposes in advance,
that makes the cluster selection process much less arbitrary.</p>
<p>There are many ways to go about doing this, but this package offers
one way through a <code>target_list</code>. The <code>target_list</code>
contains data frames what we can examine our clustering results over
through linear regression (continuous data), ordinal regression (ordinal
data), or the Chi-squared test (categorical data).</p>
<p>Just like when generating the initial <code>data_list</code>, we need
to specify the name of the column in the provided data frames that is
originally being used to uniquely identify the different observations
from each other with the <code>uid</code> parameter.</p>
<p>We will next extend our <code>sol_df</code> with p-values from
regressing the <code>target_list</code> features onto our generated
clusters.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ext_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span><span class="va">sol_df</span>, <span class="va">target_dl</span><span class="op">)</span></span>
<span><span class="co">#&gt; --</span></span></code></pre></div>
<p>There is a heatmap for visualizing this too:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pval_heatmap.html">pval_heatmap</a></span><span class="op">(</span><span class="va">ext_sol_df</span>, order <span class="op">=</span> <span class="va">meta_cluster_order</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pval_hm</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/pval_heatmap_ordered.png">
</center>
<p>These p-values hold no real meaning for the traditional
hypothesis-testing context, but they are reasonable proxies of the
magnitude of the effect size / separation of the clusters across the
features in question. Here, they are just a tool to find clustering
solutions that are well-separated according to the outcome measures
you’ve specified. Finding a cluster solution like this is similar to a
supervised learning approach, but where the optimization method is just
random sampling. The risk for overfitting your data with this approach
is considerable, so make sure you have some rigorous external validation
before reporting your findings.</p>
<p>We recommend using <em>label propagation</em> (provided by the
SNFtool package in the <code>groupPredict</code> function) for
validation: take the top clustering solutions found in some training
data, assign predicted clusters to some held out test observations, and
then characterize those test observations to see how well the clustering
solution seemed to have worked.</p>
</div>
</div>
<div class="section level2">
<h2 id="validating-results-with-label-propagation">Validating results with label propagation<a class="anchor" aria-label="anchor" href="#validating-results-with-label-propagation"></a>
</h2>
<p>Here’s a quick step through of the complete procedure, from the
beginning, with label propagation to validate our findings.</p>
<p>The <code>metasnf</code> package comes equipped with the function
<code>train_test_assign</code> to provide random splitting for you.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All the observations present in all data frames with no NAs</span></span>
<span><span class="va">all_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/uids.html">uids</a></span><span class="op">(</span><span class="va">input_dl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_observations</span></span>
<span><span class="co">#&gt;  [1] "uid_NDAR_INV0567T2Y9" "uid_NDAR_INV0J4PYA5F" "uid_NDAR_INV10OMKVLE"</span></span>
<span><span class="co">#&gt;  [4] "uid_NDAR_INV15FPCW4O" "uid_NDAR_INV19NB4RJK" "uid_NDAR_INV1HLGR738"</span></span>
<span><span class="co">#&gt;  [7] "uid_NDAR_INV1KR0EZFU" "uid_NDAR_INV1L3Y9EOP" "uid_NDAR_INV1TCP5GNM"</span></span>
<span><span class="co">#&gt; [10] "uid_NDAR_INV1ZHRDJ6B" "uid_NDAR_INV2EJ41YSZ" "uid_NDAR_INV2PK6C85M"</span></span>
<span><span class="co">#&gt; [13] "uid_NDAR_INV2XO1PHCT" "uid_NDAR_INV3CU5Y9BZ" "uid_NDAR_INV3MBSY16V"</span></span>
<span><span class="co">#&gt; [16] "uid_NDAR_INV3N0QFDLO" "uid_NDAR_INV3N1476QE" "uid_NDAR_INV3Y027GVK"</span></span>
<span><span class="co">#&gt; [19] "uid_NDAR_INV40Z7GVYJ" "uid_NDAR_INV49UPOXHJ" "uid_NDAR_INV4N5XGZE8"</span></span>
<span><span class="co">#&gt; [22] "uid_NDAR_INV4OWRB536" "uid_NDAR_INV4X80QUZY" "uid_NDAR_INV50JL2RXP"</span></span>
<span><span class="co">#&gt; [25] "uid_NDAR_INV5BRNFYQC" "uid_NDAR_INV64F9GH0V" "uid_NDAR_INV6RVH5KZS"</span></span>
<span><span class="co">#&gt; [28] "uid_NDAR_INV6WBQCY2I" "uid_NDAR_INV752EFAQ0" "uid_NDAR_INV7O30HFV6"</span></span>
<span><span class="co">#&gt; [31] "uid_NDAR_INV7QO93CJH" "uid_NDAR_INV84G9ONXP" "uid_NDAR_INV8EHP6W1U"</span></span>
<span><span class="co">#&gt; [34] "uid_NDAR_INV8MJFUKIW" "uid_NDAR_INV8WGK6ECZ" "uid_NDAR_INV94AKNGMJ"</span></span>
<span><span class="co">#&gt; [37] "uid_NDAR_INV9GAZYV8Q" "uid_NDAR_INV9IREH05N" "uid_NDAR_INV9KC3GVMU"</span></span>
<span><span class="co">#&gt; [40] "uid_NDAR_INV9NFKZ82A" "uid_NDAR_INV9S1BMDE5" "uid_NDAR_INVA68OU0YK"</span></span>
<span><span class="co">#&gt; [43] "uid_NDAR_INVADCYZ38B" "uid_NDAR_INVAYM8WTIN" "uid_NDAR_INVB8O4LAQV"</span></span>
<span><span class="co">#&gt; [46] "uid_NDAR_INVBAP80W1R" "uid_NDAR_INVBTRW1NUK" "uid_NDAR_INVCIXE0496"</span></span>
<span><span class="co">#&gt; [49] "uid_NDAR_INVCYBSZD0N" "uid_NDAR_INVD37Z9N61" "uid_NDAR_INVD61ZUBC7"</span></span>
<span><span class="co">#&gt; [52] "uid_NDAR_INVDXKG2UBF" "uid_NDAR_INVEQ1OBNSM" "uid_NDAR_INVEQ4D2M8P"</span></span>
<span><span class="co">#&gt; [55] "uid_NDAR_INVEVBDLSTM" "uid_NDAR_INVEY0FMJDI" "uid_NDAR_INVFLU0YINE"</span></span>
<span><span class="co">#&gt; [58] "uid_NDAR_INVFNZPWMSI" "uid_NDAR_INVFY76P8AJ" "uid_NDAR_INVG3T0PXW6"</span></span>
<span><span class="co">#&gt; [61] "uid_NDAR_INVG5CI7XK4" "uid_NDAR_INVG8BRLSO9" "uid_NDAR_INVGDBYXWV4"</span></span>
<span><span class="co">#&gt; [64] "uid_NDAR_INVH1KV76BQ" "uid_NDAR_INVH3P4T8C2" "uid_NDAR_INVH4FZC2XB"</span></span>
<span><span class="co">#&gt; [67] "uid_NDAR_INVH8QN7WLT" "uid_NDAR_INVHERPS382" "uid_NDAR_INVHEUWA52I"</span></span>
<span><span class="co">#&gt; [70] "uid_NDAR_INVHM3XS68O" "uid_NDAR_INVI1RKT9MX" "uid_NDAR_INVIZFV08RU"</span></span>
<span><span class="co">#&gt; [73] "uid_NDAR_INVJ574KX6A" "uid_NDAR_INVK3FL5CP2" "uid_NDAR_INVK9ULDQA2"</span></span>
<span><span class="co">#&gt; [76] "uid_NDAR_INVKB0CYO1H" "uid_NDAR_INVKHWS26UN" "uid_NDAR_INVKTUMPLXY"</span></span>
<span><span class="co">#&gt; [79] "uid_NDAR_INVKYH529RD" "uid_NDAR_INVL4NIUZYF" "uid_NDAR_INVLDQH8ATK"</span></span>
<span><span class="co">#&gt; [82] "uid_NDAR_INVLF3TNDUZ" "uid_NDAR_INVLI58ERQC" "uid_NDAR_INVLIQRM8KC"</span></span>
<span><span class="co">#&gt; [85] "uid_NDAR_INVLXDP1SWT" "uid_NDAR_INVMBOZVEA4" "uid_NDAR_INVMIWOSHJN"</span></span>
<span></span>
<span><span class="co"># Remove the "uid_" prefix to allow merges with the original data</span></span>
<span><span class="va">all_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"uid_"</span>, <span class="st">""</span>, <span class="va">all_observations</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data frame assigning 80% of observations to train and 20% to test</span></span>
<span><span class="va">assigned_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_test_assign.html">train_test_assign</a></span><span class="op">(</span>train_frac <span class="op">=</span> <span class="fl">0.8</span>, uids <span class="op">=</span> <span class="va">all_observations</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pulling the training and testing observations specifically</span></span>
<span><span class="va">train_obs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"train"</span></span>
<span><span class="va">test_obs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"test"</span></span>
<span></span>
<span><span class="co"># Partition a training set</span></span>
<span><span class="va">train_cort_t</span> <span class="op">&lt;-</span> <span class="va">cort_t</span><span class="op">[</span><span class="va">cort_t</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_cort_sa</span> <span class="op">&lt;-</span> <span class="va">cort_sa</span><span class="op">[</span><span class="va">cort_sa</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_subc_v</span> <span class="op">&lt;-</span> <span class="va">subc_v</span><span class="op">[</span><span class="va">subc_v</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_income</span> <span class="op">&lt;-</span> <span class="va">income</span><span class="op">[</span><span class="va">income</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_pubertal</span> <span class="op">&lt;-</span> <span class="va">pubertal</span><span class="op">[</span><span class="va">pubertal</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_anxiety</span> <span class="op">&lt;-</span> <span class="va">anxiety</span><span class="op">[</span><span class="va">anxiety</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span><span class="va">train_depress</span> <span class="op">&lt;-</span> <span class="va">depress</span><span class="op">[</span><span class="va">depress</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_obs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Partition a test set</span></span>
<span><span class="va">test_cort_t</span> <span class="op">&lt;-</span> <span class="va">cort_t</span><span class="op">[</span><span class="va">cort_t</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_cort_sa</span> <span class="op">&lt;-</span> <span class="va">cort_sa</span><span class="op">[</span><span class="va">cort_sa</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_subc_v</span> <span class="op">&lt;-</span> <span class="va">subc_v</span><span class="op">[</span><span class="va">subc_v</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_income</span> <span class="op">&lt;-</span> <span class="va">income</span><span class="op">[</span><span class="va">income</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_pubertal</span> <span class="op">&lt;-</span> <span class="va">pubertal</span><span class="op">[</span><span class="va">pubertal</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_anxiety</span> <span class="op">&lt;-</span> <span class="va">anxiety</span><span class="op">[</span><span class="va">anxiety</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span><span class="va">test_depress</span> <span class="op">&lt;-</span> <span class="va">depress</span><span class="op">[</span><span class="va">depress</span><span class="op">$</span><span class="st">"unique_id"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_obs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># A data list with just training observations</span></span>
<span><span class="va">train_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_cort_sa</span>, <span class="st">"cortical_sa"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A data list with training and testing observations</span></span>
<span><span class="va">full_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cort_sa</span>, <span class="st">"cortical_surface_area"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct the target lists</span></span>
<span><span class="va">train_target_dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_list.html">data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"unique_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find a clustering solution in your training data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">my_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snf_config.html">snf_config</a></span><span class="op">(</span></span>
<span>    <span class="va">train_dl</span>,</span>
<span>    n_solutions <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ No distance functions specified. Using defaults.</span></span>
<span><span class="co">#&gt; ℹ No clustering functions specified. Using defaults.</span></span>
<span></span>
<span><span class="va">train_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">train_dl</span>,</span>
<span>    <span class="va">my_sc</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ext_sol_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">train_sol_df</span>,</span>
<span>    <span class="va">train_target_dl</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; --</span></span>
<span></span>
<span><span class="co"># The first row had the lowest minimum p-value across our outcomes</span></span>
<span><span class="va">lowest_min_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"min_pval"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ext_sol_df</span><span class="op">$</span><span class="st">"min_pval"</span> <span class="op">==</span> <span class="va">lowest_min_pval</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># Keep track of your top solution</span></span>
<span><span class="va">top_row</span> <span class="op">&lt;-</span> <span class="va">ext_sol_df</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use the solutions data frame from the training observations and the data list from</span></span>
<span><span class="co"># the training and testing observations to propagate labels to the test observations</span></span>
<span><span class="va">propagated_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/label_propagate.html">label_propagate</a></span><span class="op">(</span><span class="va">top_row</span>, <span class="va">full_dl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    uid     group 1</span></span>
<span><span class="co">#&gt; 1 uid_NDAR_INV0567T2Y9 clustered 1</span></span>
<span><span class="co">#&gt; 2 uid_NDAR_INV0J4PYA5F clustered 2</span></span>
<span><span class="co">#&gt; 3 uid_NDAR_INV10OMKVLE clustered 1</span></span>
<span><span class="co">#&gt; 4 uid_NDAR_INV15FPCW4O clustered 1</span></span>
<span><span class="co">#&gt; 5 uid_NDAR_INV19NB4RJK clustered 1</span></span>
<span><span class="co">#&gt; 6 uid_NDAR_INV1HLGR738 clustered 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     uid       group 1</span></span>
<span><span class="co">#&gt; 82 uid_NDAR_INVG5CI7XK4 unclustered 1</span></span>
<span><span class="co">#&gt; 83 uid_NDAR_INVGDBYXWV4 unclustered 1</span></span>
<span><span class="co">#&gt; 84 uid_NDAR_INVHEUWA52I unclustered 2</span></span>
<span><span class="co">#&gt; 85 uid_NDAR_INVK9ULDQA2 unclustered 1</span></span>
<span><span class="co">#&gt; 86 uid_NDAR_INVKYH529RD unclustered 1</span></span>
<span><span class="co">#&gt; 87 uid_NDAR_INVLDQH8ATK unclustered 1</span></span></code></pre></div>
<p>You could, if you wanted, see how <em>all</em> of your clustering
solutions propagate to the test set, but that would mean reusing your
test set and removing the protection against overfitting conferred by
this procedure.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">propagated_labels_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/label_propagate.html">label_propagate</a></span><span class="op">(</span></span>
<span>    <span class="va">ext_sol_df</span>,</span>
<span>    <span class="va">full_dl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    uid     group 1 2 3 4  5</span></span>
<span><span class="co">#&gt; 1 uid_NDAR_INV0567T2Y9 clustered 1 1 5 1 10</span></span>
<span><span class="co">#&gt; 2 uid_NDAR_INV0J4PYA5F clustered 2 1 5 1  3</span></span>
<span><span class="co">#&gt; 3 uid_NDAR_INV10OMKVLE clustered 1 1 3 2  5</span></span>
<span><span class="co">#&gt; 4 uid_NDAR_INV15FPCW4O clustered 1 1 4 1  4</span></span>
<span><span class="co">#&gt; 5 uid_NDAR_INV19NB4RJK clustered 1 1 8 2  9</span></span>
<span><span class="co">#&gt; 6 uid_NDAR_INV1HLGR738 clustered 1 2 8 1  9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     uid       group 1 2 3 4 5</span></span>
<span><span class="co">#&gt; 82 uid_NDAR_INVG5CI7XK4 unclustered 1 1 2 1 2</span></span>
<span><span class="co">#&gt; 83 uid_NDAR_INVGDBYXWV4 unclustered 1 1 4 1 4</span></span>
<span><span class="co">#&gt; 84 uid_NDAR_INVHEUWA52I unclustered 2 1 1 2 1</span></span>
<span><span class="co">#&gt; 85 uid_NDAR_INVK9ULDQA2 unclustered 1 1 1 1 1</span></span>
<span><span class="co">#&gt; 86 uid_NDAR_INVKYH529RD unclustered 1 1 7 1 7</span></span>
<span><span class="co">#&gt; 87 uid_NDAR_INVLDQH8ATK unclustered 1 1 6 2 8</span></span></code></pre></div>
<p>That’s all!</p>
<p>If you have any questions, comments, suggestions, bugs, etc. feel
free to post an issue at <a href="https://github.com/BRANCHlab/metasnf" class="external-link">https://github.com/BRANCHlab/metasnf</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Caruana, Rich, Mohamed Elhawary, Nam Nguyen, and Casey Smith. 2006.
“Meta Clustering.” In Sixth International Conference on Data Mining
(ICDM’06), 107–18. <a href="https://doi.org/10.1109/ICDM.2006.103" class="external-link uri">https://doi.org/10.1109/ICDM.2006.103</a>.</p>
<p>Wang, Bo, Aziz M. Mezlini, Feyyaz Demir, Marc Fiume, Zhuowen Tu,
Michael Brudno, Benjamin Haibe-Kains, and Anna Goldenberg. 2014.
“Similarity Network Fusion for Aggregating Data Types on a Genomic
Scale.” Nature Methods 11 (3): 333–37. <a href="https://doi.org/10.1038/nmeth.2810" class="external-link uri">https://doi.org/10.1038/nmeth.2810</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth S Velayudhan, Xiaoqiao Xu, Prajkta Kallurkar, Ana Patricia Balbon, Maria T Secara, Adam Taback, Denise Sabac, Nicholas Chan, Shihao Ma, Bo Wang, Daniel Felsky, Stephanie H Ameis, Brian Cox, Colin Hawco, Lauren Erdman, Anne L Wheeler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
