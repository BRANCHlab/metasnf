<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Step through a complex subtyping workflow.
">
<title>A Complete Example • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Complete Example">
<meta property="og:description" content="Step through a complex subtyping workflow.
">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_complete_example.html">A Complete Example</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>A Complete Example</h1>
            
      
      
      <div class="d-none name"><code>a_complete_example.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/a_complete_example.Rmd" class="external-link">a_complete_example.Rmd</a></p>
<p>We recommend you go through the <a href="https://branchlab.github.io/metasnf/articles/a_simple_example.html">simple
example</a> before working through this one.</p>
<p>This vignette walks through how the core functionality of this
package, including:</p>
<ol style="list-style-type: decimal">
<li>Setting up the data</li>
<li>Building a space of settings to cluster over</li>
<li>Running SNF</li>
<li>Identifying and visualizing meta clusters</li>
<li>Characterizing and selecting top meta clusters</li>
<li>Selecting a representative cluster solution from a meta cluster</li>
<li>Cluster solution characterization</li>
<li>Cluster solution validation</li>
</ol>
<div class="section level2">
<h2 id="setting-up-the-data">1. Setting up the data<a class="anchor" aria-label="anchor" href="#setting-up-the-data"></a>
</h2>
<div class="section level3">
<h3 id="load-the-library-and-data-into-the-r-environment">Load the library and data into the R environment<a class="anchor" aria-label="anchor" href="#load-the-library-and-data-into-the-r-environment"></a>
</h3>
<p>Your data should be loaded into the R environment in the following
format:</p>
<ol style="list-style-type: decimal">
<li>The data is in one or more <em>data.frame</em> objects</li>
<li>The data is in wide form (one row per patient to cluster)</li>
<li>All dataframes should have exactly one column that uniquely
identifies which patient the row has data for</li>
<li>All data should be complete (no missing values)</li>
</ol>
<p>A future vignette will outline how metaSNF can be used to
simultaneously cluster over distinct imputations of a dataset.</p>
<p>The package comes with a few mock dataframes based on real data from
the Adolescent Brain Cognitive Development study:</p>
<ul>
<li>
<code>abcd_anxiety</code> (anxiety scores from the CBCL)</li>
<li>
<code>abcd_depress</code> (depression scores from the CBCL)</li>
<li>
<code>abcd_cort_t</code> (cortical thicknesses)</li>
<li>
<code>abcd_cort_sa</code> (cortical surface areas in mm^2)</li>
<li>
<code>abcd_subc_v</code> (subcortical volumes in mm^3)</li>
<li>
<code>abcd_h_income</code> (household income on a 1-3 scale)</li>
<li>
<code>abcd_pubertal</code> (pubertal status on a 1-5 scale)</li>
</ul>
<p>Here’s what the cortical thickness data looks like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ patient : chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ mrisdp_1: num  2.6 2.62 2.62 2.6 2.53</span></span>
<span><span class="co">#&gt;  $ mrisdp_2: num  2.49 2.85 2.29 2.67 2.76</span></span>
<span><span class="co">#&gt;  $ mrisdp_3: num  2.8 2.78 2.53 2.68 2.83</span></span>
<span><span class="co">#&gt;  $ mrisdp_4: num  2.95 2.85 2.96 2.94 2.99</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">abcd_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;            patient mrisdp_1 mrisdp_2 mrisdp_3 mrisdp_4</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9    2.601    2.487    2.801    2.954</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W    2.619    2.851    2.784    2.846</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8    2.621    2.295    2.530    2.961</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F    2.599    2.670    2.676    2.938</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q    2.526    2.761    2.829    2.986</span></span></code></pre></div>
<p>The first column “patient” is the unique identifier (UID) for all
subjects in the data.</p>
<p>Here’s the household income data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">abcd_h_income</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">abcd_h_income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ patient         : chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ household_income: num  3 NA 1 2 1</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">abcd_h_income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;            patient household_income</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9                3</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W               NA</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8                1</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F                2</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q                1</span></span></code></pre></div>
<p>Putting everything in a list will help us get quicker summaries of
all the data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abcd_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">abcd_anxiety</span>,</span>
<span>    <span class="va">abcd_depress</span>,</span>
<span>    <span class="va">abcd_cort_t</span>,</span>
<span>    <span class="va">abcd_cort_sa</span>,</span>
<span>    <span class="va">abcd_subc_v</span>,</span>
<span>    <span class="va">abcd_h_income</span>,</span>
<span>    <span class="va">abcd_pubertal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The number of rows in each dataframe:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">abcd_data</span>, <span class="va">dim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 174  31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Whether or not each dataframe has missing values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">abcd_data</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Some of our data has missing values and not all of our dataframes
have the same number of participants. SNF can only be run with complete
data, so you’ll need to either use complete case analysis (removal of
observations with any missing values) or impute the missing values to
proceed with the clustering.</p>
<p>As mentioned above, <code>metaSNF</code> can be used to visualize
changes in clustering results across different imputations of the data.
For now, we’ll just examine the simpler complete-case analysis approach
by reducing our dataframes to only common and complete patients.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abcd_merged_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_df_list.html">merge_df_list</a></span><span class="op">(</span><span class="va">abcd_data</span>, uid <span class="op">=</span> <span class="st">"patient"</span>, no_na <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">common_patients</span> <span class="op">&lt;-</span> <span class="va">abcd_merged_df</span><span class="op">$</span><span class="st">"patient"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">common_patients</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 87</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Reducing dataframes to only common subjects with no missing data</span></span>
<span><span class="va">abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span><span class="op">[</span><span class="va">abcd_anxiety</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_depress</span> <span class="op">&lt;-</span> <span class="va">abcd_depress</span><span class="op">[</span><span class="va">abcd_depress</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span><span class="op">[</span><span class="va">abcd_cort_t</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_cort_sa</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_sa</span><span class="op">[</span><span class="va">abcd_cort_sa</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_subc_v</span> <span class="op">&lt;-</span> <span class="va">abcd_subc_v</span><span class="op">[</span><span class="va">abcd_subc_v</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_h_income</span> <span class="op">&lt;-</span> <span class="va">abcd_h_income</span><span class="op">[</span><span class="va">abcd_h_income</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span>
<span><span class="va">abcd_pubertal</span> <span class="op">&lt;-</span> <span class="va">abcd_pubertal</span><span class="op">[</span><span class="va">abcd_pubertal</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">common_patients</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-the-data-list">Generating the data list<a class="anchor" aria-label="anchor" href="#generating-the-data-list"></a>
</h3>
<p>The <code>data_list</code> structure is a structured list of
dataframes (like the one already created), but with some additional
metadata about each dataframe. It should only contain the input
dataframes we want to directly use as inputs for the clustering. Out of
all the data we have available to us, we may be working in a context
where the anxiety and depression data are especially important patient
outcomes, and we want to know if we can find subtypes using the rest of
the data which still do a good job of separating out patients by their
anxiety and depression scores.</p>
<p>We’ll start by creating a data list that stores our input
variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that you do not need to explicitly name every single named element</span></span>
<span><span class="co"># (data = ..., name = ..., etc.)</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_t</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_thickness"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_sa</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_surface_area"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_subc_v</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"subcortical_volume"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_h_income</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"household_income"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_pubertal</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"pubertal_status"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This process removes any patients who did not have complete data
across all provided input dataframes. If you’d like to keep track of
that information, you can set the “return_missing” parameter to
<code>TRUE</code> and receive a list containing the data_list as well as
the removed patients. The structure of the data list is a nested list
tracking the data, the name of the dataframe, what domain (broader
source of information) the data belongs to, and the type of variable
stored in the dataframe. Options for variable type include “continuous”,
“discrete”, “ordinal”, and “categorical”.</p>
<p>The “uid” parameter is the name of the column in the dataframes that
uniquely identifies each patient. Upon data list creation, the UID will
be converted to “subjectkey” for consistency across other functions in
the package.</p>
<p>We can get a summary of our constructed <code>data_list</code> with
the <code>summarize_dl</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_dl.html">summarize_dl</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                        name       type       domain length</span></span>
<span><span class="co">#&gt; cortical_thickness       cortical_thickness continuous neuroimaging     87</span></span>
<span><span class="co">#&gt; cortical_surface_area cortical_surface_area continuous neuroimaging     87</span></span>
<span><span class="co">#&gt; subcortical_volume       subcortical_volume continuous neuroimaging     87</span></span>
<span><span class="co">#&gt; household_income           household_income continuous demographics     87</span></span>
<span><span class="co">#&gt; pubertal_status             pubertal_status continuous demographics     87</span></span>
<span><span class="co">#&gt;                       width</span></span>
<span><span class="co">#&gt; cortical_thickness      152</span></span>
<span><span class="co">#&gt; cortical_surface_area   152</span></span>
<span><span class="co">#&gt; subcortical_volume       31</span></span>
<span><span class="co">#&gt; household_income          2</span></span>
<span><span class="co">#&gt; pubertal_status           2</span></span></code></pre></div>
<p>Each input dataframe now has the same 87 subjects with complete data.
The width refers to the number of columns in each dataframe, which
equals 1 for the UID (subjectkey) column + the number of features in the
dataframe.</p>
<p><code>data_list</code> now stores all the variables we intend on
using for the clustering. We’re interested in knowing if any of the
clustering solutions we generate can distinguish children apart based on
their anxiety and depression scores. To do this, we’ll also create a
data list storing only variables that we’ll use for evaluating our
cluster solutions and not for the clustering itself. We’ll refer to this
as the “target_list”.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_dl.html">summarize_dl</a></span><span class="op">(</span><span class="va">target_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;                name    type    domain length width</span></span>
<span><span class="co">#&gt; anxiety     anxiety ordinal behaviour     87     2</span></span>
<span><span class="co">#&gt; depressed depressed ordinal behaviour     87     2</span></span></code></pre></div>
<p>Note that it is not necessary to make use of a partition of input and
out-of-model measures in this way. If you’d like to have no target list
and instead use every single variable of interest for the clustering,
you can stick to just using one data list.</p>
</div>
</div>
<div class="section level2">
<h2 id="building-a-space-of-settings-to-cluster-over">2. Building a space of settings to cluster over<a class="anchor" aria-label="anchor" href="#building-a-space-of-settings-to-cluster-over"></a>
</h2>
<p>The <code>settings_matrix</code> stores all the information about the
settings we’d like to use for each of our SNF runs. Calling the
<code>generate_settings_matrix</code> function with a specified number
of rows will automatically build a randomly populated
<code>settings_matrix</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">settings_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   row_id alpha  k  t snf_scheme clust_alg cont_dist disc_dist ord_dist cat_dist</span></span>
<span><span class="co">#&gt; 1      1   0.5 29 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 2      2   0.4 26 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 3      3   0.3 44 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 4      4   0.3 43 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 5      5   0.5 29 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt;   mix_dist inc_cortical_thickness inc_cortical_surface_area</span></span>
<span><span class="co">#&gt; 1        1                      1                         0</span></span>
<span><span class="co">#&gt; 2        1                      1                         1</span></span>
<span><span class="co">#&gt; 3        1                      1                         0</span></span>
<span><span class="co">#&gt; 4        1                      1                         1</span></span>
<span><span class="co">#&gt; 5        1                      1                         1</span></span>
<span><span class="co">#&gt;   inc_subcortical_volume inc_household_income inc_pubertal_status</span></span>
<span><span class="co">#&gt; 1                      1                    0                   1</span></span>
<span><span class="co">#&gt; 2                      1                    1                   1</span></span>
<span><span class="co">#&gt; 3                      0                    1                   1</span></span>
<span><span class="co">#&gt; 4                      0                    1                   1</span></span>
<span><span class="co">#&gt; 5                      1                    1                   1</span></span></code></pre></div>
<p>The columns are:</p>
<ul>
<li>
<code>row_id</code>: Integer to keep track of which row is
which</li>
<li>
<code>alpha</code> - A hyperparameter for SNF (variable that
influences the subtyping process)</li>
<li>
<code>k</code> - A hyperparameter for SNF</li>
<li>
<code>t</code> - A hyperparameter for SNF</li>
<li>
<code>snf_scheme</code> - the specific way in which input data gets
collapsed into a final fused network (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/snf_schemes.html">SNF
schemes vignette</a>)</li>
<li>
<code>clust_alg</code> - Which clustering algorithm will be applied
to the final fused network produced by SNF</li>
<li>
<code>*_dist</code> - Which distance metric will be used for the
different types of data (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics vignette</a>)</li>
<li>
<code>inc_*</code> - binary columns indicating whether or not an
input dataframe is included (1) or excluded (0) from the corresponding
SNF run (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/settings_matrix.html">settings
matrix vignette</a>)</li>
</ul>
<p>Without specifying any additional parameters,
<code>generate_settings_matrix</code> randomly populates these columns
and ensures that no generated rows are identical.</p>
<p>What’s important for now is that the matrix (technically a dataframe
in the R environment) contains several rows which each outline a
different but reasonable way in which the raw data could be converted
into patient subtypes. Further customization of the
<code>settings_matrix</code> will enable you to access the broadest
possible space of reasonable cluster solutions that your data can
produce using SNF and ideally get you closer to a generalizable and
useful solution for your context. More on <code>settings_matrix</code>
customization can be found in the <a href="https://branchlab.github.io/metasnf/articles/settings_matrix.html">settings
matrix vignette</a>.</p>
<p>Setting the optional <code>seed</code> parameter (which will affect
the seed of your entire R session) ensures that the same settings matrix
is generated each time we run the code.</p>
<p>While we end up with a random set of settings here, there is nothing
wrong with manually altering the settings matrix to suit your needs. For
example, if you wanted to know how much of a difference one input
dataframe made, you could ensure that half of the rows included this
input dataframe and the other half didn’t. You can also add random rows
to an already existing dataframe using the
<code>add_settings_matrix_rows</code> function (further discussed in the
vignette).</p>
</div>
<div class="section level2">
<h2 id="running-snf">3. Running SNF<a class="anchor" aria-label="anchor" href="#running-snf"></a>
</h2>
<p>The <code>batch_snf</code> function integrates the data in the
<code>data_list</code> using each of the sets of settings contained in
the <code>settings_matrix</code>. The resulting structure is an
<code>solutions_matrix</code> which is an extension of the
<code>settings_matrix</code> that contains columns specifying which
cluster each subject was assigned for the corresponding
<code>settings_matrix</code> row.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">settings_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/20 | Time remaining: 4 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 6/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 7/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 8/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 9/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 10/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 11/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 12/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 13/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 14/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 15/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 16/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 17/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 18/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 19/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 20/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 4 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "row_id"                    "alpha"                    </span></span>
<span><span class="co">#&gt;  [3] "k"                         "t"                        </span></span>
<span><span class="co">#&gt;  [5] "snf_scheme"                "clust_alg"                </span></span>
<span><span class="co">#&gt;  [7] "cont_dist"                 "disc_dist"                </span></span>
<span><span class="co">#&gt;  [9] "ord_dist"                  "cat_dist"                 </span></span>
<span><span class="co">#&gt; [11] "mix_dist"                  "inc_cortical_thickness"   </span></span>
<span><span class="co">#&gt; [13] "inc_cortical_surface_area" "inc_subcortical_volume"   </span></span>
<span><span class="co">#&gt; [15] "inc_household_income"      "inc_pubertal_status"      </span></span>
<span><span class="co">#&gt; [17] "nclust"                    "subject_NDAR_INV0567T2Y9" </span></span>
<span><span class="co">#&gt; [19] "subject_NDAR_INV0J4PYA5F"  "subject_NDAR_INV10OMKVLE" </span></span>
<span><span class="co">#&gt; [21] "subject_NDAR_INV15FPCW4O"  "subject_NDAR_INV19NB4RJK" </span></span>
<span><span class="co">#&gt; [23] "subject_NDAR_INV1HLGR738"  "subject_NDAR_INV1KR0EZFU" </span></span>
<span><span class="co">#&gt; [25] "subject_NDAR_INV1L3Y9EOP"  "subject_NDAR_INV1TCP5GNM" </span></span>
<span><span class="co">#&gt; [27] "subject_NDAR_INV1ZHRDJ6B"  "subject_NDAR_INV2EJ41YSZ" </span></span>
<span><span class="co">#&gt; [29] "subject_NDAR_INV2PK6C85M"  "subject_NDAR_INV2XO1PHCT"</span></span></code></pre></div>
<p>It goes on like this for some time.</p>
<p>Just like that, 20 different cluster solutions have been
generated!</p>
<p>In practice, you may end up wanting to create hundreds or thousands
of cluster solutions at a time. If you have access to a multi-core
system, <code>batch_snf</code> can be run with parallel processing
enabled. See <code><a href="../reference/batch_snf.html">?batch_snf</a></code> or the <a href="https://branchlab.github.io/metasnf/articles/parallel_processing.html">parallel
processing vignette</a> for more information.</p>
<p>You can pull the clustering results out of each row using the
<code>get_cluster_solutions</code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cluster_solutions.html">get_cluster_solutions</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cluster_solutions</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 5 3 1 1 1 1 1 3 3  2  6  1  1  3  2  1  1  1  1  1</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0J4PYA5F 2 3 7 2 6 2 4 4 3  4  5  7  2  3  2  4  2  7  2  3</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV10OMKVLE 1 2 3 1 4 2 3 1 2  2  7  2  2  2  1  1  3  4  2  2</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV15FPCW4O 1 2 5 2 5 2 3 1 2  3  7  5  2  2  1  1  2  5  2  3</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV19NB4RJK 4 2 9 1 7 2 3 2 2  3  8  6  2  2  1  6  3  2  2  2</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV1HLGR738 4 2 9 1 7 2 3 2 2  1  8  6  2  2  1  6  3  2  2  2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="identifying-and-visualizing-meta-clusters">4. Identifying and visualizing meta clusters<a class="anchor" aria-label="anchor" href="#identifying-and-visualizing-meta-clusters"></a>
</h2>
<p>Now that we have access to 20 different clustering solutions, we’ll
need to find some way to pick an optimal one to move forward with for
additional characterization. In this case, plotting or running stats
manually on each of the solutions might be a reasonable way to determine
which ones we like the most. But when the number of solutions generated
goes up into the hundreds (or thousands), we’re going to need some more
automated approaches.</p>
<p>The main approach we recommend using is the meta clustering approach
described in Caruana et al., 2016. Meta clustering is a good approach to
use when the criterion for what makes one cluster solution better than
another is hard to formalize quantitatively (and hence, hard to fully
automate).</p>
<p>The idea is to cluster the <em>clustering solutions themselves</em>
to arrive at a manageable number of qualitatively similar meta clusters.
From there, characterization of representative solutions from each meta
cluster can be done to efficiently identify the top choice.</p>
<p>The first step is to calculate the <a href="https://en.wikipedia.org/wiki/Rand_index" class="external-link">adjusted Rand index</a>
(ARI) between each pair of cluster solutions. This metric tells us how
similar the solutions are to each other, thereby allowing us to find
clusters of cluster solutions.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_aris.html">calc_aris</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; 52.63158% completed...</span></span>
<span><span class="co">#&gt; Done.</span></span></code></pre></div>
<p>We can visualize the resulting inter-cluster similarities with a
heatmap. First, call <code>get_matrix_order</code> to get a hierarchical
clustering-based ordering of the rows in the adjusted rand indices.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_cluster_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_matrix_order.html">get_matrix_order</a></span><span class="op">(</span><span class="va">solutions_matrix_aris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Just a vector of numbers</span></span>
<span><span class="va">meta_cluster_order</span></span>
<span><span class="co">#&gt;  [1] 10 19  6 13  3 18  5 12  7 17 20  4 15  9  2 14  1  8 11 16</span></span></code></pre></div>
<p>This order can be passed into the
<code>adjusted_rand_index_heatmap</code> function to get a clearer view
of existing meta clusters.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">ari_hm</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./adjusted_rand_index_heatmap.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">550</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/adjusted_rand_index_heatmap.png">
</center>
<p>The clustering solutions are along the rows and columns of the above
figure, and the cells at the intersection between two solutions show how
similar (big ARI) those solutions are to each other. The diagonals
should always be red, representing the maximum value of 1, as they show
the similarity between any clustering solution and itself.
Complete-linkage, Euclidean-distance based hierarchical clustering is
being applied to these solutions to obtain the row ordering. This is
also the default approach used by the <code>ComplexHeatmap</code>
package, the backbone of all heatmap functions in
<code>metaSNF</code>.</p>
<p>This heatmap is integral to understanding what meta clusters exist in
your data (given the space of parameters you explored in the settings
matrix). We will later see how to further customize this heatmap to add
in rich information about how each plotted cluster solution differs on
various measures of quality, different clustering settings, and
different levels of separation on input and out-of-model measures.</p>
<p>First, we’ll divide the heatmap into meta clusters by visual
inspection. The indices of our meta cluster boundaries can be passed
into the <code>adjusted_rand_index_heatmap</code> function as the
<code>split_vector</code> parameter. You can determine this vector
through trial and error or by using the <code>shiny_annotator</code>
function (a wrapper around functionality from the
<code>InteractiveComplexHeatmap</code> package).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/shiny_annotator.html">shiny_annotator</a></span><span class="op">(</span><span class="va">ari_hm</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/meta_cluster_shiny.png">
</center>
<p>A demonstration of the shiny app can be seen here: <a href="https://pvelayudhan.shinyapps.io/shiny/" class="external-link">Meta Cluster
Identification</a></p>
<p>Note that while the shiny app is running, your R console will be
unresponsive.</p>
<p>Clicking on cell boundaries and tracking the row/column indices
(printed to the R console as well as displayed in the app) can get us
results looking something like this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ari_mc_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">ari_mc_hm</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./ari_mc_hm.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">550</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/ari_mc_hm.png">
</center>
<p>At this point, we have our meta clusters but are not yet sure of how
they differ in terms of their structure across our input and
out-of-model variables.</p>
<p>We start by running the <code>extend_solutions</code> function, which
will calculate p-values representing the strength of the association
between cluster membership (treated as a categorical variable) and any
feature present in a provided data list and/or target_list.</p>
<p><code>extend_solutions</code> also adds summary p-value measures
(min, mean, and max) of any features present in the target list.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Only looking at our out-of-model p-values</span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    target_list <span class="op">=</span> <span class="va">target_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 6 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 7 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 8 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 9 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 10 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 11 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 12 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 13 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 14 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 15 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 16 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 17 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 18 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 19 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 20 of 20"</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># What columns have been added?</span></span>
<span><span class="va">old_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span><span class="va">new_cols</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="va">old_cols</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">[</span>, <span class="va">new_cols</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cbcl_anxiety_r_pval cbcl_depress_r_pval  min_pval mean_pval  max_pval</span></span>
<span><span class="co">#&gt; 1           0.7344315           0.7263495 0.7263495 0.7303905 0.7344315</span></span>
<span><span class="co">#&gt; 2           0.6644469           0.3238038 0.3238038 0.4941253 0.6644469</span></span>
<span><span class="co">#&gt; 3           0.3961268           0.6817113 0.3961268 0.5389191 0.6817113</span></span>
<span><span class="co">#&gt; 4           0.4843825           0.7564136 0.4843825 0.6203981 0.7564136</span></span>
<span><span class="co">#&gt; 5           0.2256718           0.7895325 0.2256718 0.5076021 0.7895325</span></span>
<span><span class="co">#&gt; 6           0.2566391           0.1324778 0.1324778 0.1945585 0.2566391</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Re-running to calculate the p-value for every single input and out-of-model</span></span>
<span><span class="co"># feature:</span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    target_list <span class="op">=</span> <span class="va">target_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 6 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 7 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 8 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 9 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 10 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 11 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 12 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 13 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 14 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 15 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 16 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 17 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 18 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 19 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 20 of 20"</span></span></code></pre></div>
<p>Functionally, the only difference between the <code>data_list</code>
and <code>target_list</code> arguments are that the
<code>target_list</code> features will also be a part of those summary
measures.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Also would work, but without any summary p-values</span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    data_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">target_list</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Also would work, but now every feature would be part of the summaries</span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    target_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">target_list</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The summary p-value measures can be suppressed by setting
<code>calculate_summaries = FALSE</code>.</p>
<p>This <code>extended_solutions_matrix</code> we created can be passed
into the <code>adjusted_rand_index_heatmap</code> function to easily
visualize the level of separation on each of our variables for each of
our cluster solutions.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotated_ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="va">extended_solutions_matrix</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Overall outcomes p-value"</span> <span class="op">=</span> <span class="st">"mean_pval"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Overall outcomes p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"mean_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">annotated_ari_hm</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./annotated_ari_hm.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">700</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/annotated_ari_hm.png">
</center>
<p>The <code>adjusted_rand_index_heatmap</code> function wraps around a
more generic <code>similarity_matrix_heatmap</code> function in this
package, which itself is a wrapper around
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code>. Consequently, anything that can
be done in the <code>ComplexHeatmap</code> package can be done here.
This also makes the documentation for the <code>ComplexHeatmap</code>
package one of the best places to learn more about what can be done for
these heatmaps.</p>
<p>The data for the annotations don’t necessarily need to come from
functions in metaSNF either. If you wanted to, for example, highlight
the solutions where two very specific patients happened to cluster
together, you could easily add that in as another annotation:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extended_solutions_matrix2</span> <span class="op">&lt;-</span> <span class="va">extended_solutions_matrix</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        key_patients_cluster_together <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">subject_NDAR_INVLF3TNDUZ</span> <span class="op">==</span> <span class="va">subject_NDAR_INVLDQH8ATK</span> <span class="op">~</span> <span class="cn">TRUE</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">annotated_ari_hm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="va">extended_solutions_matrix2</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Key Patients Clustered Together"</span> <span class="op">=</span> <span class="st">"key_patients_cluster_together"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Key Patients Clustered Together"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">annotated_ari_hm2</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./annotated_ari_hm2.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">700</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/annotated_ari_hm2.png">
</center>
<p>Now that we’ve visually delineated our meta clusters, we can get a
quick summary of what sort of separation exists across our input and
held out variables by taking a closer look at one representative cluster
solution from each meta cluster.</p>
<p>This can be achieved by the <code>get_representative_solutions</code>
function, which extracts one cluster solution per meta cluster based on
having the highest average ARI with the other solutions in that meta
cluster.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_representative_solutions.html">get_representative_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    <span class="va">extended_solutions_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mc_manhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc_manhattan_plot.html">mc_manhattan_plot</a></span><span class="op">(</span></span>
<span>    <span class="va">rep_solutions</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    target_list <span class="op">=</span> <span class="va">target_list</span>,</span>
<span>    hide_x_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    text_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    neg_log_pval_thresh <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span></span>
<span>    <span class="st">"mc_manhattan.png"</span>,</span>
<span>    <span class="va">mc_manhattan</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/mc_manhattan.png">
</center>
<p><code>neg_log_pval_thresh</code> sets a threshold for the negative
log of the p-values to be displayed. At a value of 5, any p-value that
is smaller than 1e-5 will be truncated to 1e-5.</p>
<p>Note that the Manhattan plot automatically uses a vertical line to
separate features in the data_list argument from those in the
target_list. Vertical boundaries can be controlled with the
<code>xints</code> parameter.</p>
<p>The plot as it is is a bit unwieldy plot given how many neuroimaging
ROIs are present. Let’s take out the cortical thickness and surface area
measures to make the plot a little clearer.</p>
<p>We’ll also be able to read some variable measures more clearly when
we dial the number of features plotted back a bit, as well.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_solutions_no_cort</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">rep_solutions</span>,</span>
<span>    <span class="op">-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"mrisdp"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mc_manhattan2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mc_manhattan_plot.html">mc_manhattan_plot</a></span><span class="op">(</span></span>
<span>    <span class="va">rep_solutions_no_cort</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    target_list <span class="op">=</span> <span class="va">target_list</span>,</span>
<span>    point_size <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    text_size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>    domain_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"neuroimaging"</span> <span class="op">=</span> <span class="st">"cadetblue"</span>,</span>
<span>        <span class="st">"demographics"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>        <span class="st">"behaviour"</span> <span class="op">=</span> <span class="st">"firebrick"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mc_manhattan2</span></span>
<span></span>
<span><span class="fu">ggsave</span><span class="op">(</span></span>
<span>    <span class="st">"mc_manhattan2.png"</span>,</span>
<span>    <span class="va">mc_manhattan2</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">8</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">12</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/mc_manhattan2.png">
</center>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/annotated_ari_hm2.png">
</center>
<p>If you see something interesting in your heatmap, you may be curious
to know how that corresponds to the settings that were in your settings
matrix.</p>
<p>You could certainly stack on each setting to the ARI heatmap as
annotations, but that may be a bit cumbersome given how many settings
there are. Another option is to start by taking a first look at entire
<code>settings_matrix</code>, sorted by the meta cluster results,
through the <code>settings_matrix_heatmap</code> function.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sm_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/settings_matrix_heatmap.html">settings_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">sm_hm</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./settings_matrix_heatmap_ordered.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">75</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/settings_matrix_heatmap_ordered.png">
</center>
<p>This heatmap rescales all the columns in the settings_matrix to have
a maximum value of 1. The purpose of re-ordering the settings matrix in
this way is to see if any associations exist between certain settings
values and pairwise cluster solution similarities.</p>
<p>This heatmap can show you if any settings values were associated with
a particular type of clustering result. If there are any particular
important settings, you can simply add them into your adjusted rand
index heatmap annotations. Recall that the <code>solutions_matrix</code>
(and, by extension, the <code>extended_solutions_matrix</code>) is an
extension of the settings matrix, so no further data manipulation is
needed to add a setting variable as a heatmap annotation.</p>
<p>Give it a try with the code below:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotated_ari_hm3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">14</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">extended_solutions_matrix</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>        <span class="st">"Key Patients Clustered Together"</span> <span class="op">=</span> <span class="st">"key_patients_cluster_together"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Clustering Algorithm"</span> <span class="op">=</span> <span class="st">"clust_alg"</span> <span class="co"># from the original settings</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bottom_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Number of Clusters"</span> <span class="op">=</span> <span class="st">"nclust"</span> <span class="co"># also from the original settings</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Key Patients Clustered Together"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"TRUE"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"FALSE"</span> <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="quality-measures">2. Quality measures<a class="anchor" aria-label="anchor" href="#quality-measures"></a>
</h3>
<p>Quality metrics are another useful heuristic for the goodness of a
cluster that don’t require any contextualization of results in the
domain they may be used in. metaSNF enables measures of silhouette
scores, Dunn indices, and Davies-Bouldin indices. To calculate these
values, we’ll need not only the cluster results but also the final fused
network (the similarity matrices produced by SNF) that the clusters came
from. These similarity matrices can be collected from the
<code>batch_snf</code> using the <code>return_similarity_matrices</code>
parameter:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_snf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    return_similarity_matrices <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/20 | Time remaining: 4 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 6/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 7/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 8/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 9/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 10/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 11/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 12/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 13/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 14/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 15/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 16/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 17/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 18/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 19/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 20/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 4 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"solutions_matrix"</span></span>
<span><span class="va">similarity_matrices</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"similarity_matrices"</span></span></code></pre></div>
<p>This time, the output of <code>batch_snf</code> is a list. The first
element of the list is a single solutions_matrix, like what we usually
get. The second element is <em>yet another list</em> containing one
final fused network (AKA similarity matrix / similarity matrix) per SNF
run. Using those two lists, we can calculate the above mentioned quality
metrics:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silhouette_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_silhouettes.html">calculate_silhouettes</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    <span class="va">similarity_matrices</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dunn_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_dunn_indices.html">calculate_dunn_indices</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    <span class="va">similarity_matrices</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_db_indices.html">calculate_db_indices</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    <span class="va">similarity_matrices</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first function is a wrapper around
<code><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">cluster::silhouette</a></code> while the second and third come from
the <em>clv</em> package. <em>clv</em> isn’t set as a mandatory part of
the installation, so you’ll ned to install it yourself to calculate
these two metrics.</p>
<p>The original documentation on these functions can be helpful for
interpreting and working with them:</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.rdocumentation.org/packages/cluster/versions/2.1.4/topics/silhouette" class="external-link"><code>cluster::silhouette</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Dunn" class="external-link"><code>clv::clv.Dunn</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Davies.Bouldin" class="external-link"><code>clv::clv.Davies.Bouldin</code>
documentation</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="stability-measures">3. Stability measures<a class="anchor" aria-label="anchor" href="#stability-measures"></a>
</h3>
<p>metaSNF offers tools to evaluate two different measures of
stability:</p>
<ol style="list-style-type: decimal">
<li>Pairwise adjusted Rand indices (across resamplings of the
clustering, on average, how similar was every pair of solutions
according to the adjusted Rand index?)</li>
<li>Fraction clustered together (what is the average fraction of times
that patients who clustered together in the full results clustered
together in resampled results?)</li>
</ol>
<p>To calculate either of these, you’ll need to first generate
subsamples of the data_list.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">30</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of patients</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>data_list_subsamples</code> is a list that now contains 30
smaller subsamples of the original data_list.</p>
<p>Then the stability calculations:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pairwise_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_pairwise_aris.html">subsample_pairwise_aris</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fraction_together</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fraction_clustered_together.html">fraction_clustered_together</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    <span class="va">solutions_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Be warned, that second function is especially extremely slow. As the
number of patients and number of solutions you’re evaluating grows,
these functions can get pretty slow. Consider only using them after
eliminating solutions that you are certainly not interested in further
characterizing.</p>
</div>
<div class="section level3">
<h3 id="evaluating-separation-across-target-variables-of-importance">4. Evaluating separation across “target variables” of
importance<a class="anchor" aria-label="anchor" href="#evaluating-separation-across-target-variables-of-importance"></a>
</h3>
<p>If you can specify a metric or objective function that may tell you
how useful a clustering solution will be for your purposes in advance,
that makes the cluster selection process much less arbitrary.</p>
<p>There are many ways to go about doing this, but this package offers
one way through a <code>target_list</code>. The <code>target_list</code>
contains dataframes what we can examine our clustering results over
through linear regression (continuous data), ordinal regression (ordinal
data), or the Chi-squared test (categorical data).</p>
<p>Just like when generating the initial <code>data_list</code>, we need
to specify the name of the column in the provided dataframes that is
originally being used to uniquely identify the different observations
from each other with the <code>uid</code> parameter.</p>
<p>We will next extend our <code>solutions_matrix</code> with p-values
from regressing the <code>target_list</code> features onto our generated
clusters.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span><span class="va">solutions_matrix</span>, <span class="va">target_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 6 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 7 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 8 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 9 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 10 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 11 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 12 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 13 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 14 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 15 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 16 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 17 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 18 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 19 of 20"</span></span>
<span><span class="co">#&gt; [1] "Processing row 20 of 20"</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "row_id"                    "alpha"                    </span></span>
<span><span class="co">#&gt;  [3] "k"                         "t"                        </span></span>
<span><span class="co">#&gt;  [5] "snf_scheme"                "clust_alg"                </span></span>
<span><span class="co">#&gt;  [7] "cont_dist"                 "disc_dist"                </span></span>
<span><span class="co">#&gt;  [9] "ord_dist"                  "cat_dist"                 </span></span>
<span><span class="co">#&gt; [11] "mix_dist"                  "inc_cortical_thickness"   </span></span>
<span><span class="co">#&gt; [13] "inc_cortical_surface_area" "inc_subcortical_volume"   </span></span>
<span><span class="co">#&gt; [15] "inc_household_income"      "inc_pubertal_status"      </span></span>
<span><span class="co">#&gt; [17] "nclust"                    "subject_NDAR_INV0567T2Y9" </span></span>
<span><span class="co">#&gt; [19] "subject_NDAR_INV0J4PYA5F"  "subject_NDAR_INV10OMKVLE" </span></span>
<span><span class="co">#&gt; [21] "subject_NDAR_INV15FPCW4O"  "subject_NDAR_INV19NB4RJK" </span></span>
<span><span class="co">#&gt; [23] "subject_NDAR_INV1HLGR738"  "subject_NDAR_INV1KR0EZFU" </span></span>
<span><span class="co">#&gt; [25] "subject_NDAR_INV1L3Y9EOP"</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Looking at the newly added columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/no_subs.html">no_subs</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   row_id alpha  k  t snf_scheme clust_alg cont_dist disc_dist ord_dist cat_dist</span></span>
<span><span class="co">#&gt; 1      1   0.5 29 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 2      2   0.4 26 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 3      3   0.3 44 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 4      4   0.3 43 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 5      5   0.5 29 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 6      6   0.4 26 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt;   mix_dist inc_cortical_thickness inc_cortical_surface_area</span></span>
<span><span class="co">#&gt; 1        1                      1                         0</span></span>
<span><span class="co">#&gt; 2        1                      1                         1</span></span>
<span><span class="co">#&gt; 3        1                      1                         0</span></span>
<span><span class="co">#&gt; 4        1                      1                         1</span></span>
<span><span class="co">#&gt; 5        1                      1                         1</span></span>
<span><span class="co">#&gt; 6        1                      1                         1</span></span>
<span><span class="co">#&gt;   inc_subcortical_volume inc_household_income inc_pubertal_status nclust</span></span>
<span><span class="co">#&gt; 1                      1                    0                   1      5</span></span>
<span><span class="co">#&gt; 2                      1                    1                   1      3</span></span>
<span><span class="co">#&gt; 3                      0                    1                   1      9</span></span>
<span><span class="co">#&gt; 4                      0                    1                   1      2</span></span>
<span><span class="co">#&gt; 5                      1                    1                   1      8</span></span>
<span><span class="co">#&gt; 6                      1                    1                   1      2</span></span>
<span><span class="co">#&gt;   cbcl_anxiety_r_pval cbcl_depress_r_pval  min_pval mean_pval  max_pval</span></span>
<span><span class="co">#&gt; 1           0.7344315           0.7263495 0.7263495 0.7303905 0.7344315</span></span>
<span><span class="co">#&gt; 2           0.6644469           0.3238038 0.3238038 0.4941253 0.6644469</span></span>
<span><span class="co">#&gt; 3           0.3961268           0.6817113 0.3961268 0.5389191 0.6817113</span></span>
<span><span class="co">#&gt; 4           0.4843825           0.7564136 0.4843825 0.6203981 0.7564136</span></span>
<span><span class="co">#&gt; 5           0.2256718           0.7895325 0.2256718 0.5076021 0.7895325</span></span>
<span><span class="co">#&gt; 6           0.2566391           0.1324778 0.1324778 0.1945585 0.2566391</span></span></code></pre></div>
<p>If you just want the p-values:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pvals.html">get_pvals</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">target_pvals</span><span class="op">)</span></span>
<span><span class="co">#&gt;   row_id cbcl_anxiety_r_pval cbcl_depress_r_pval  min_pval mean_pval  max_pval</span></span>
<span><span class="co">#&gt; 1      1           0.7344315           0.7263495 0.7263495 0.7303905 0.7344315</span></span>
<span><span class="co">#&gt; 2      2           0.6644469           0.3238038 0.3238038 0.4941253 0.6644469</span></span>
<span><span class="co">#&gt; 3      3           0.3961268           0.6817113 0.3961268 0.5389191 0.6817113</span></span>
<span><span class="co">#&gt; 4      4           0.4843825           0.7564136 0.4843825 0.6203981 0.7564136</span></span>
<span><span class="co">#&gt; 5      5           0.2256718           0.7895325 0.2256718 0.5076021 0.7895325</span></span>
<span><span class="co">#&gt; 6      6           0.2566391           0.1324778 0.1324778 0.1945585 0.2566391</span></span></code></pre></div>
<p>There is a heatmap for visualizing this too:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pval_heatmap.html">pval_heatmap</a></span><span class="op">(</span><span class="va">target_pvals</span>, order <span class="op">=</span> <span class="va">meta_cluster_order</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/save_heatmap.html">save_heatmap</a></span><span class="op">(</span></span>
<span>    heatmap <span class="op">=</span> <span class="va">pval_hm</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"./pval_heatmap_ordered.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">400</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    res <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/pval_heatmap_ordered.png">
</center>
<p>These p-values hold no real meaning for the traditional
hypothesis-testing context, but they are reasonable proxies of the
magnitude of the effect size / separation of the clusters across the
variables in question. Here, they are just a tool to find clustering
solutions that are well-separated according to the outcome measures
you’ve specified. Finding a cluster solution like this is similar to a
supervised learning approach, but where the optimization method is just
random sampling. The risk for overfitting your data with this approach
is considerable, so make sure you have some rigorous external validation
before reporting your findings.</p>
<p>We recommend using <em>label propagation</em> (provided by the
SNFtool package in the <code>groupPredict</code> function) for
validation: take the top clustering solutions found in some training
data, assign predicted clusters to some held out test subjects, and then
characterize those test subjects to see how well the clustering solution
seemed to have worked.</p>
</div>
</div>
<div class="section level2">
<h2 id="validating-results-with-label-propagation">Validating results with label propagation<a class="anchor" aria-label="anchor" href="#validating-results-with-label-propagation"></a>
</h2>
<p>Here’s a quick step through of the complete procedure, from the
beginning, with label propagation to validate our findings.</p>
<p>The <code>metasnf</code> package comes equipped with a function to do
the training/testing split for you :)</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All the subjects present in all dataframes with no NAs</span></span>
<span><span class="va">all_subjects</span> <span class="op">&lt;-</span> <span class="va">data_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="st">"data"</span><span class="op">$</span><span class="st">"subjectkey"</span></span>
<span></span>
<span><span class="co"># Remove the "subject_" prefix to allow merges with the original data</span></span>
<span><span class="va">all_subjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"subject_"</span>, <span class="st">""</span>, <span class="va">all_subjects</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dataframe assigning 80% of subjects to train and 20% to test</span></span>
<span><span class="va">assigned_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_test_assign.html">train_test_assign</a></span><span class="op">(</span>train_frac <span class="op">=</span> <span class="fl">0.8</span>, subjects <span class="op">=</span> <span class="va">all_subjects</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pulling the training and testing subjects specifically</span></span>
<span><span class="va">train_subs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"train"</span></span>
<span><span class="va">test_subs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"test"</span></span>
<span></span>
<span><span class="co"># Partition a training set</span></span>
<span><span class="va">train_abcd_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span><span class="op">[</span><span class="va">abcd_cort_t</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_cort_sa</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_sa</span><span class="op">[</span><span class="va">abcd_cort_sa</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_subc_v</span> <span class="op">&lt;-</span> <span class="va">abcd_subc_v</span><span class="op">[</span><span class="va">abcd_subc_v</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_h_income</span> <span class="op">&lt;-</span> <span class="va">abcd_h_income</span><span class="op">[</span><span class="va">abcd_h_income</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_pubertal</span> <span class="op">&lt;-</span> <span class="va">abcd_pubertal</span><span class="op">[</span><span class="va">abcd_pubertal</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span><span class="op">[</span><span class="va">abcd_anxiety</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_depress</span> <span class="op">&lt;-</span> <span class="va">abcd_depress</span><span class="op">[</span><span class="va">abcd_depress</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Partition a test set</span></span>
<span><span class="va">test_abcd_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span><span class="op">[</span><span class="va">abcd_cort_t</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_cort_sa</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_sa</span><span class="op">[</span><span class="va">abcd_cort_sa</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_subc_v</span> <span class="op">&lt;-</span> <span class="va">abcd_subc_v</span><span class="op">[</span><span class="va">abcd_subc_v</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_h_income</span> <span class="op">&lt;-</span> <span class="va">abcd_h_income</span><span class="op">[</span><span class="va">abcd_h_income</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_pubertal</span> <span class="op">&lt;-</span> <span class="va">abcd_pubertal</span><span class="op">[</span><span class="va">abcd_pubertal</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span><span class="op">[</span><span class="va">abcd_anxiety</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_depress</span> <span class="op">&lt;-</span> <span class="va">abcd_depress</span><span class="op">[</span><span class="va">abcd_depress</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># A data list with just training subjects</span></span>
<span><span class="va">train_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_cort_sa</span>, <span class="st">"cortical_sa"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A data list with training and testing subjects</span></span>
<span><span class="va">full_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_cort_sa</span>, <span class="st">"cortical_surface_area"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct the target lists</span></span>
<span><span class="va">train_target_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find a clustering solution in your training data</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">train_data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">train_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">train_data_list</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 1 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">train_solutions_matrix</span>,</span>
<span>    <span class="va">train_target_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 5"</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "row_id"                   "alpha"                   </span></span>
<span><span class="co">#&gt;  [3] "k"                        "t"                       </span></span>
<span><span class="co">#&gt;  [5] "snf_scheme"               "clust_alg"               </span></span>
<span><span class="co">#&gt;  [7] "cont_dist"                "disc_dist"               </span></span>
<span><span class="co">#&gt;  [9] "ord_dist"                 "cat_dist"                </span></span>
<span><span class="co">#&gt; [11] "mix_dist"                 "inc_cortical_thickness"  </span></span>
<span><span class="co">#&gt; [13] "inc_cortical_sa"          "inc_subcortical_volume"  </span></span>
<span><span class="co">#&gt; [15] "inc_household_income"     "inc_pubertal_status"     </span></span>
<span><span class="co">#&gt; [17] "nclust"                   "subject_NDAR_INV0567T2Y9"</span></span>
<span><span class="co">#&gt; [19] "subject_NDAR_INV0J4PYA5F" "subject_NDAR_INV10OMKVLE"</span></span>
<span><span class="co">#&gt; [21] "subject_NDAR_INV15FPCW4O" "subject_NDAR_INV19NB4RJK"</span></span>
<span><span class="co">#&gt; [23] "subject_NDAR_INV1HLGR738" "subject_NDAR_INV1KR0EZFU"</span></span>
<span><span class="co">#&gt; [25] "subject_NDAR_INV1L3Y9EOP" "subject_NDAR_INV1ZHRDJ6B"</span></span>
<span><span class="co">#&gt; [27] "subject_NDAR_INV2PK6C85M" "subject_NDAR_INV2XO1PHCT"</span></span>
<span><span class="co">#&gt; [29] "subject_NDAR_INV3CU5Y9BZ" "subject_NDAR_INV3MBSY16V"</span></span>
<span><span class="co">#&gt; [31] "subject_NDAR_INV3N0QFDLO" "subject_NDAR_INV3Y027GVK"</span></span>
<span><span class="co">#&gt; [33] "subject_NDAR_INV40Z7GVYJ" "subject_NDAR_INV49UPOXHJ"</span></span>
<span><span class="co">#&gt; [35] "subject_NDAR_INV4N5XGZE8" "subject_NDAR_INV4OWRB536"</span></span>
<span><span class="co">#&gt; [37] "subject_NDAR_INV4X80QUZY" "subject_NDAR_INV50JL2RXP"</span></span>
<span><span class="co">#&gt; [39] "subject_NDAR_INV5BRNFYQC" "subject_NDAR_INV6RVH5KZS"</span></span>
<span><span class="co">#&gt; [41] "subject_NDAR_INV6WBQCY2I" "subject_NDAR_INV752EFAQ0"</span></span>
<span><span class="co">#&gt; [43] "subject_NDAR_INV7QO93CJH" "subject_NDAR_INV84G9ONXP"</span></span>
<span><span class="co">#&gt; [45] "subject_NDAR_INV8EHP6W1U" "subject_NDAR_INV8MJFUKIW"</span></span>
<span><span class="co">#&gt; [47] "subject_NDAR_INV8WGK6ECZ" "subject_NDAR_INV94AKNGMJ"</span></span>
<span><span class="co">#&gt; [49] "subject_NDAR_INV9GAZYV8Q" "subject_NDAR_INV9IREH05N"</span></span>
<span><span class="co">#&gt; [51] "subject_NDAR_INV9KC3GVMU" "subject_NDAR_INV9NFKZ82A"</span></span>
<span><span class="co">#&gt; [53] "subject_NDAR_INV9S1BMDE5" "subject_NDAR_INVA68OU0YK"</span></span>
<span><span class="co">#&gt; [55] "subject_NDAR_INVADCYZ38B" "subject_NDAR_INVAYM8WTIN"</span></span>
<span><span class="co">#&gt; [57] "subject_NDAR_INVB8O4LAQV" "subject_NDAR_INVBAP80W1R"</span></span>
<span><span class="co">#&gt; [59] "subject_NDAR_INVBTRW1NUK" "subject_NDAR_INVCIXE0496"</span></span>
<span><span class="co">#&gt; [61] "subject_NDAR_INVCYBSZD0N" "subject_NDAR_INVD37Z9N61"</span></span>
<span><span class="co">#&gt; [63] "subject_NDAR_INVD61ZUBC7" "subject_NDAR_INVEQ1OBNSM"</span></span>
<span><span class="co">#&gt; [65] "subject_NDAR_INVEVBDLSTM" "subject_NDAR_INVEY0FMJDI"</span></span>
<span><span class="co">#&gt; [67] "subject_NDAR_INVFLU0YINE" "subject_NDAR_INVFNZPWMSI"</span></span>
<span><span class="co">#&gt; [69] "subject_NDAR_INVFY76P8AJ" "subject_NDAR_INVG3T0PXW6"</span></span>
<span><span class="co">#&gt; [71] "subject_NDAR_INVG8BRLSO9" "subject_NDAR_INVH1KV76BQ"</span></span>
<span><span class="co">#&gt; [73] "subject_NDAR_INVH3P4T8C2" "subject_NDAR_INVH4FZC2XB"</span></span>
<span><span class="co">#&gt; [75] "subject_NDAR_INVH8QN7WLT" "subject_NDAR_INVHERPS382"</span></span>
<span><span class="co">#&gt; [77] "subject_NDAR_INVHM3XS68O" "subject_NDAR_INVI1RKT9MX"</span></span>
<span><span class="co">#&gt; [79] "subject_NDAR_INVIZFV08RU" "subject_NDAR_INVJ574KX6A"</span></span>
<span><span class="co">#&gt; [81] "subject_NDAR_INVK3FL5CP2" "subject_NDAR_INVKB0CYO1H"</span></span>
<span><span class="co">#&gt; [83] "subject_NDAR_INVKHWS26UN" "subject_NDAR_INVKTUMPLXY"</span></span>
<span><span class="co">#&gt; [85] "subject_NDAR_INVL4NIUZYF" "subject_NDAR_INVLF3TNDUZ"</span></span>
<span><span class="co">#&gt; [87] "subject_NDAR_INVLI58ERQC" "subject_NDAR_INVLIQRM8KC"</span></span>
<span><span class="co">#&gt; [89] "subject_NDAR_INVLXDP1SWT" "subject_NDAR_INVMBOZVEA4"</span></span>
<span><span class="co">#&gt; [91] "subject_NDAR_INVMIWOSHJN" "cbcl_anxiety_r_pval"     </span></span>
<span><span class="co">#&gt; [93] "cbcl_depress_r_pval"      "min_pval"                </span></span>
<span><span class="co">#&gt; [95] "mean_pval"                "max_pval"</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># The fifth row had the lowest minimum p-value across our outcomes</span></span>
<span><span class="va">lowest_min_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"min_pval"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"min_pval"</span> <span class="op">==</span> <span class="va">lowest_min_pval</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Keep track of your top solution</span></span>
<span><span class="va">top_row</span> <span class="op">&lt;-</span> <span class="va">extended_solutions_matrix</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use the solutions matrix from the training subjects and the data list from</span></span>
<span><span class="co"># the training and testing subjects to propagate labels to the test subjects</span></span>
<span><span class="va">propagated_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lp_solutions_matrix.html">lp_solutions_matrix</a></span><span class="op">(</span><span class="va">top_row</span>, <span class="va">full_data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 1..."</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey group 4</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 train 1</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0J4PYA5F train 1</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV10OMKVLE train 2</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV15FPCW4O train 1</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV19NB4RJK train 2</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV1HLGR738 train 1</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  subjectkey group 4</span></span>
<span><span class="co">#&gt; 82 subject_NDAR_INVG5CI7XK4  test 1</span></span>
<span><span class="co">#&gt; 83 subject_NDAR_INVGDBYXWV4  test 1</span></span>
<span><span class="co">#&gt; 84 subject_NDAR_INVHEUWA52I  test 2</span></span>
<span><span class="co">#&gt; 85 subject_NDAR_INVK9ULDQA2  test 1</span></span>
<span><span class="co">#&gt; 86 subject_NDAR_INVKYH529RD  test 1</span></span>
<span><span class="co">#&gt; 87 subject_NDAR_INVLDQH8ATK  test 2</span></span></code></pre></div>
<p>You could, if you wanted, see how <em>all</em> of your clustering
solutions propagate to the test set, but that would mean reusing your
test set and removing the protection against overfitting conferred by
this procedure.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">propagated_labels_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lp_solutions_matrix.html">lp_solutions_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">extended_solutions_matrix</span>,</span>
<span>    <span class="va">full_data_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 5..."</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey group 1 2 3 4  5</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 train 1 1 5 1 10</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0J4PYA5F train 2 1 5 1  3</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV10OMKVLE train 1 1 3 2  5</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV15FPCW4O train 1 1 4 1  4</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV19NB4RJK train 1 1 8 2  9</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV1HLGR738 train 1 2 8 1  9</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  subjectkey group 1 2 3 4 5</span></span>
<span><span class="co">#&gt; 82 subject_NDAR_INVG5CI7XK4  test 1 1 2 1 2</span></span>
<span><span class="co">#&gt; 83 subject_NDAR_INVGDBYXWV4  test 1 1 4 1 4</span></span>
<span><span class="co">#&gt; 84 subject_NDAR_INVHEUWA52I  test 2 1 1 2 1</span></span>
<span><span class="co">#&gt; 85 subject_NDAR_INVK9ULDQA2  test 1 1 1 1 1</span></span>
<span><span class="co">#&gt; 86 subject_NDAR_INVKYH529RD  test 1 1 7 1 7</span></span>
<span><span class="co">#&gt; 87 subject_NDAR_INVLDQH8ATK  test 1 1 6 2 8</span></span></code></pre></div>
<p>That’s all!</p>
<p>If you have any questions, comments, suggestions, bugs, etc. feel
free to post an issue at <a href="https://github.com/BRANCHlab/metasnf" class="external-link">https://github.com/BRANCHlab/metasnf</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Caruana, Rich, Mohamed Elhawary, Nam Nguyen, and Casey Smith. 2006.
“Meta Clustering.” In Sixth International Conference on Data Mining
(ICDM’06), 107–18. <a href="https://doi.org/10.1109/ICDM.2006.103" class="external-link uri">https://doi.org/10.1109/ICDM.2006.103</a>.</p>
<p>Wang, Bo, Aziz M. Mezlini, Feyyaz Demir, Marc Fiume, Zhuowen Tu,
Michael Brudno, Benjamin Haibe-Kains, and Anna Goldenberg. 2014.
“Similarity Network Fusion for Aggregating Data Types on a Genomic
Scale.” Nature Methods 11 (3): 333–37. <a href="https://doi.org/10.1038/nmeth.2810" class="external-link uri">https://doi.org/10.1038/nmeth.2810</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
