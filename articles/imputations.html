<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>Imputations • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Imputations">
<meta property="og:description" content="metasnf">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Example workflows</h6>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_complete_example.html">A Less Simple Example</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Essentials</h6>
    <a class="dropdown-item" href="../articles/settings_matrix.html">The Settings Matrix</a>
    <a class="dropdown-item" href="../articles/data_list.html">The Data List</a>
    <a class="dropdown-item" href="../articles/snf_schemes.html">SNF schemes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Further customization</h6>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/clustering_algorithms.html">Clustering Algorithms</a>
    <a class="dropdown-item" href="../articles/feature_weights.html">Feature Weights</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Additional functionality</h6>
    <a class="dropdown-item" href="../articles/stability_measures.html">Stability Measures and Consensus Clustering</a>
    <a class="dropdown-item" href="../articles/quality_measures.html">Quality Measures</a>
    <a class="dropdown-item" href="../articles/confounders.html">Confounders and Unwanted Signal</a>
    <a class="dropdown-item" href="../articles/parallel_processing.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/label_propagation.html">Label propagation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plotting</h6>
    <a class="dropdown-item" href="../articles/similarity_matrix_heatmap.html">Similarity Matrix Heatmaps</a>
    <a class="dropdown-item" href="../articles/manhattan_plots.html">Manhattan Plots</a>
    <a class="dropdown-item" href="../articles/alluvial_plots.html">Alluvial Plots</a>
    <a class="dropdown-item" href="../articles/correlation_plots.html">Correlation Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Imputations</h1>
            
      
      
      <div class="d-none name"><code>imputations.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/imputations.Rmd" class="external-link">imputations.Rmd</a></p>
<p>Missing data can be difficult to handle, especially in the context of
unsupervised learning. In a supervised setting, multiply imputed
datasets can be used to generate pooled estimates of model
coefficients.</p>
<p>A somewhat analogous process is demonstrated in the code below. Here,
we pretend we’ve generated two different imputations of the data,
<code>data_list_imp1</code> and <code>data_list_imp2</code>. The mock
code below happens to use the base, unimputed data twice for
simplicity.</p>
<p>Separate cluster solutions are generated for the two sets of imputed
data, which then have their corresponding solutions matrices stacked
together and appended with an <code>imputation</code> column that
indicates which imputed dataset was used to generate that particular
cluster solution.</p>
<p>Moving through the rest of the meta clustering pipeline, the
influence of the imputation on meta clustering structure or on
separation of other variables in the data can be easily visualized in
the <code>adjusted_rand_index_heatmap</code> function through the use of
<code>ComplexHeatmap</code> annotations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First imputed dataset</span></span>
<span><span class="va">data_list_imp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second imputed dataset</span></span>
<span><span class="va">data_list_imp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generation of 20 cluster solutions</span></span>
<span><span class="va">solutions_matrix_imp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">data_list_imp1</span>, <span class="va">settings_matrix</span><span class="op">)</span></span>
<span><span class="va">solutions_matrix_imp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">data_list_imp2</span>, <span class="va">settings_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="va">solutions_matrix_imp1</span><span class="op">$</span><span class="st">"imputation"</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">solutions_matrix_imp1</span><span class="op">$</span><span class="st">"imputation"</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Create a stacked solution matrix that stores solutions from both imputations</span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">solutions_matrix_imp1</span>, <span class="va">solutions_matrix_imp2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate pairwise similarities across all solutions</span></span>
<span><span class="co"># (Including across imputations)</span></span>
<span><span class="va">solutions_matrix_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_aris.html">calc_aris</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meta_cluster_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_matrix_order.html">get_matrix_order</a></span><span class="op">(</span><span class="va">solutions_matrix_aris</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Base heatmap for identifying meta clusters</span></span>
<span><span class="va">ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify meta cluster boundaries</span></span>
<span><span class="fu"><a href="../reference/shiny_annotator.html">shiny_annotator</a></span><span class="op">(</span><span class="va">ari_hm</span><span class="op">)</span></span>
<span><span class="va">split_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ari_mc_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate how variables are distributed across solutions</span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize influence of imputation on meta clustering results</span></span>
<span><span class="va">annotated_ari_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix_aris</span>,</span>
<span>    order <span class="op">=</span> <span class="va">meta_cluster_order</span>,</span>
<span>    split_vector <span class="op">=</span> <span class="va">split_vec</span>,</span>
<span>    data <span class="op">=</span> <span class="va">extended_solutions_matrix</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="st">"cbcl_anxiety_r_pval"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Imputation"</span> <span class="op">=</span> <span class="st">"imputation"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Depression p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_depress_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Anxiety p-value"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"cbcl_anxiety_r_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="st">"Imputation"</span> <span class="op">=</span> <span class="fu"><a href="../reference/colour_scale.html">colour_scale</a></span><span class="op">(</span></span>
<span>            <span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"mean_pval"</span>,</span>
<span>            min_colour <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            max_colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
