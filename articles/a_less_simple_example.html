<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>A Less Simple Example • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Less Simple Example">
<meta property="og:description" content="metasnf">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Example workflows</h6>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_less_simple_example.html">A Less Simple Example</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Essentials</h6>
    <a class="dropdown-item" href="../articles/settings_matrix.html">The Settings Matrix</a>
    <a class="dropdown-item" href="../articles/data_list.html">The Data List</a>
    <a class="dropdown-item" href="../articles/snf_schemes.html">SNF schemes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Further customization</h6>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/clustering_algorithms.html">Clustering Algorithms</a>
    <a class="dropdown-item" href="../articles/feature_weights.html">Feature Weights</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Additional functionality</h6>
    <a class="dropdown-item" href="../articles/stability_measures.html">Stability Measures and Consensus Clustering</a>
    <a class="dropdown-item" href="../articles/confounders.html">Confounders and Unwanted Signal</a>
    <a class="dropdown-item" href="../articles/parallel_processing.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/label_propagation.html">Label propagation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plotting</h6>
    <a class="dropdown-item" href="../articles/similarity_matrix_heatmap.html">Similarity Matrix Heatmaps</a>
    <a class="dropdown-item" href="../articles/manhattan_plots.html">Manhattan Plots</a>
    <a class="dropdown-item" href="../articles/alluvial_plots.html">Alluvial Plots</a>
    <a class="dropdown-item" href="../articles/correlation_plots.html">Correlation Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>A Less Simple Example</h1>
            
      
      
      <div class="d-none name"><code>a_less_simple_example.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/a_less_simple_example.Rmd" class="external-link">a_less_simple_example.Rmd</a></p>
<p>We recommend you go through the <a href="https://branchlab.github.io/metasnf/articles/a_simple_example.html">simple
example</a> before working through this one!</p>
<p>This vignette walks through how this package can be used over a
complete SNF-subtyping pipeline.</p>
<div class="section level2">
<h2 id="data-set-up-and-pre-processing">Data set-up and pre-processing<a class="anchor" aria-label="anchor" href="#data-set-up-and-pre-processing"></a>
</h2>
<div class="section level3">
<h3 id="load-the-library-and-data-into-the-r-environment">1. Load the library and data into the R environment<a class="anchor" aria-label="anchor" href="#load-the-library-and-data-into-the-r-environment"></a>
</h3>
<p>Your data should be loaded into the R environment in the following
format:</p>
<ul>
<li>The data is in one or multiple <em>data.frame</em> objects</li>
<li>The data is in wide form (one row per patient)</li>
<li>Any dataframe should one column that uniquely identifies which
patient the row has data for</li>
</ul>
<p>It is fine to have missing data at this stage.</p>
<p>The package comes with a few mock dataframes based on real data from
the Adolescent Brain Cognitive Development study:</p>
<ul>
<li>
<code>abcd_anxiety</code> (anxiety scores from the CBCL)</li>
<li>
<code>abcd_depress</code> (depression scores from the CBCL)</li>
<li>
<code>abcd_cort_t</code> (cortical thicknesses)</li>
<li>
<code>abcd_cort_sa</code> (cortical surface areas in mm^2)</li>
<li>
<code>abcd_subc_v</code> (subcortical volumes in mm^3)</li>
<li>
<code>abcd_h_income</code> (household income on a 1-3 scale)</li>
<li>
<code>abcd_pubertal</code> (pubertal status on a 1-5 scale)</li>
</ul>
<p>Here’s what the cortical thickness data looks like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">abcd_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ patient : chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ mrisdp_1: num  2.6 2.62 2.62 2.6 2.53</span></span>
<span><span class="co">#&gt;  $ mrisdp_2: num  2.49 2.85 2.29 2.67 2.76</span></span>
<span><span class="co">#&gt;  $ mrisdp_3: num  2.8 2.78 2.53 2.68 2.83</span></span>
<span><span class="co">#&gt;  $ mrisdp_4: num  2.95 2.85 2.96 2.94 2.99</span></span>
<span></span>
<span><span class="va">abcd_cort_t</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;            patient mrisdp_1 mrisdp_2 mrisdp_3 mrisdp_4</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9    2.601    2.487    2.801    2.954</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W    2.619    2.851    2.784    2.846</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8    2.621    2.295    2.530    2.961</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F    2.599    2.670    2.676    2.938</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q    2.526    2.761    2.829    2.986</span></span></code></pre></div>
<p>The first column “patient” is the unique identifier (UID) for all
subjects in the data.</p>
<p>Here’s the household income data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">abcd_h_income</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">abcd_h_income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'tbl_df', 'tbl' and 'data.frame':    5 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ patient         : chr  "NDAR_INV0567T2Y9" "NDAR_INV0GLZNC2W" "NDAR_INV0IZ157F8" "NDAR_INV0J4PYA5F" ...</span></span>
<span><span class="co">#&gt;  $ household_income: num  3 NA 1 2 1</span></span>
<span></span>
<span><span class="va">abcd_h_income</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;            patient household_income</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9                3</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0GLZNC2W               NA</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0IZ157F8                1</span></span>
<span><span class="co">#&gt; 4 NDAR_INV0J4PYA5F                2</span></span>
<span><span class="co">#&gt; 5 NDAR_INV0OYE291Q                1</span></span></code></pre></div>
<p>Putting everything in a list will help us get quicker summaries of
all the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abcd_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">abcd_anxiety</span>,</span>
<span>    <span class="va">abcd_depress</span>,</span>
<span>    <span class="va">abcd_cort_t</span>,</span>
<span>    <span class="va">abcd_cort_sa</span>,</span>
<span>    <span class="va">abcd_subc_v</span>,</span>
<span>    <span class="va">abcd_h_income</span>,</span>
<span>    <span class="va">abcd_pubertal</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The number of rows in each dataframe:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">abcd_data</span>, <span class="va">dim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 188 152</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 174  31</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] 275   2</span></span>
<span></span>
<span><span class="co"># Whether or not each dataframe has missing values:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">abcd_data</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Some of our data has missing values and not all of our dataframes
have the same number of participants.</p>
</div>
</div>
<div class="section level2">
<h2 id="generating-the-data-list">Generating the data list<a class="anchor" aria-label="anchor" href="#generating-the-data-list"></a>
</h2>
<p>The <code>data_list</code> structure is a structured list of
dataframes (like the one already created), but with some additional
metadata about each dataframe. It should only contain the input
dataframes we want to directly use as inputs for the clustering. Out of
all the data we have available to us, we may be working in a context
where the anxiety and depression data are especially important patient
outcomes, and we want to know if we can find subtypes using the rest of
the data which still do a good job of separating out patients by their
anxiety and depression scores. We’ll set aside anxiety and depression
for now and use the rest of the data as inputs for our subtyping, which
means loading them into the data_list.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that you do not need to explicitly name every single named element</span></span>
<span><span class="co"># (data = ..., name = ..., etc.)</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_t</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_thickness"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_sa</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_surface_area"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_subc_v</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"subcortical_volume"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_h_income</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"household_income"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_pubertal</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"pubertal_status"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This process removes any patients who did not have complete data
across all provided input dataframes. If you’d like to keep track of
that information, you can set the “return_missing” parameter to
<code>TRUE</code> and receive a list containing the data_list as well as
the removed patients:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">generate_dl_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_t</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_thickness"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_cort_sa</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"cortical_surface_area"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_subc_v</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"subcortical_volume"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"neuroimaging"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_h_income</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"household_income"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">abcd_pubertal</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"pubertal_status"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"demographics"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span>,</span>
<span>    return_missing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You only need to do this if you've set `return_missing` to TRUE!</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="va">generate_dl_results</span><span class="op">$</span><span class="st">"data_list"</span></span>
<span><span class="va">removed_subjects</span> <span class="op">&lt;-</span> <span class="va">generate_dl_results</span><span class="op">$</span><span class="st">"removed_subjects"</span></span>
<span></span>
<span><span class="va">removed_subjects</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "NDAR_INV0GLZNC2W" "NDAR_INV0OYE291Q" "NDAR_INV0SM1JLXQ" "NDAR_INV0Z87UJDR"</span></span>
<span><span class="co">#&gt;  [5] "NDAR_INV1PK0JH8Z" "NDAR_INV1R56TIVS" "NDAR_INV1RX7QO0L" "NDAR_INV2DLP49QK"</span></span>
<span><span class="co">#&gt;  [9] "NDAR_INV2EGX5UMV" "NDAR_INV2UD95T0K"</span></span></code></pre></div>
<p>We can get a summary of our constructed <code>data_list</code> with
the <code>summarize_dl</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summarize_dl.html">summarize_dl</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    name       type       domain length width</span></span>
<span><span class="co">#&gt; 1    cortical_thickness continuous neuroimaging    100   152</span></span>
<span><span class="co">#&gt; 2 cortical_surface_area continuous neuroimaging    100   152</span></span>
<span><span class="co">#&gt; 3    subcortical_volume continuous neuroimaging    100    31</span></span>
<span><span class="co">#&gt; 4      household_income continuous demographics    100     2</span></span>
<span><span class="co">#&gt; 5       pubertal_status continuous demographics    100     2</span></span></code></pre></div>
<p>Each input dataframe now has the same 100 subjects with complete
data.</p>
</div>
<div class="section level2">
<h2 id="generating-the-settings-matrix">Generating the settings matrix<a class="anchor" aria-label="anchor" href="#generating-the-settings-matrix"></a>
</h2>
<p>The <code>settings_matrix</code> stores all the information about the
settings we’d like to use for each of our SNF runs. Calling the
<code>generate_settings_matrix</code> function with a specified number
of rows will automatically build a randomly populated
<code>settings_matrix</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span>
<span></span>
<span><span class="va">settings_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span><span class="co">#&gt;   row_id alpha  k  t snf_scheme clust_alg cont_dist disc_dist ord_dist cat_dist</span></span>
<span><span class="co">#&gt; 1      1   0.5 29 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 2      2   0.4 26 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 3      3   0.3 44 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 4      4   0.3 43 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 5      5   0.5 29 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt;   mix_dist inc_cortical_thickness inc_cortical_surface_area</span></span>
<span><span class="co">#&gt; 1        1                      1                         0</span></span>
<span><span class="co">#&gt; 2        1                      1                         1</span></span>
<span><span class="co">#&gt; 3        1                      1                         0</span></span>
<span><span class="co">#&gt; 4        1                      1                         1</span></span>
<span><span class="co">#&gt; 5        1                      1                         1</span></span>
<span><span class="co">#&gt;   inc_subcortical_volume inc_household_income inc_pubertal_status</span></span>
<span><span class="co">#&gt; 1                      1                    0                   1</span></span>
<span><span class="co">#&gt; 2                      1                    1                   1</span></span>
<span><span class="co">#&gt; 3                      0                    1                   1</span></span>
<span><span class="co">#&gt; 4                      0                    1                   1</span></span>
<span><span class="co">#&gt; 5                      1                    1                   1</span></span></code></pre></div>
<p>The columns are:</p>
<ul>
<li>
<code>row_id</code>: Integer to keep track of which row is
which</li>
<li>
<code>alpha</code> - A hyperparameter for SNF (variable that
influences the subtyping process)</li>
<li>
<code>k</code> - A hyperparameter for SNF</li>
<li>
<code>t</code> - A hyperparameter for SNF</li>
<li>
<code>snf_scheme</code> - the specific way in which input data gets
collapsed into a final fused network (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/snf_schemes.html">SNF
schemes vignette</a>)</li>
<li>
<code>clust_alg</code> - Which clustering algorithm will be applied
to the final fused network produced by SNF</li>
<li>
<code>*_dist</code> - Which distance metric will be used for the
different types of data (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/distance_metrics.html">distance
metrics vignette</a>)</li>
<li>
<code>inc_*</code> - binary columns indicating whether or not an
input dataframe is included (1) or excluded (0) from the corresponding
SNF run (discussed further in the <a href="https://branchlab.github.io/metasnf/articles/settings_matrix.html">settings
matrix vignette</a>)</li>
</ul>
<p>Without specifying any additional parameters,
<code>generate_settings_matrix</code> randomly populates these columns
and ensures that no generated rows are identical.</p>
<p>What’s important for now is that the matrix (technically a dataframe
in the R environment) contains several rows which each outline a
different but reasonable way in which the raw data could be converted
into patient subtypes. Further customization of the
<code>settings_matrix</code> will enable you to access the broadest
possible space of reasonable cluster solutions that your data can
produce using SNF and ideally get you closer to a generalizable and
useful solution for your context. More on <code>settings_matrix</code>
customization can be found in the <a href="https://branchlab.github.io/metasnf/articles/settings_matrix.html">settings
matrix vignette</a></p>
<p>Setting the optional <code>seed</code> parameter (which will affect
the seed of your entire R session) ensures that the same settings matrix
is generated each time we run the code.</p>
<p>While we end up with a random set of settings here, there is nothing
wrong with manually altering the settings matrix to suit your needs. For
example, if you wanted to know how much of a difference one input
dataframe made, you could ensure that half of the rows included this
input dataframe and the other half didn’t. You can also add random rows
to an already existing dataframe using the
<code>add_settings_matrix_rows</code> function (further discussed in the
vignette).</p>
</div>
<div class="section level2">
<h2 id="running-snf-for-all-the-rows-in-the-settings-matrix">Running SNF for all the rows in the settings matrix<a class="anchor" aria-label="anchor" href="#running-snf-for-all-the-rows-in-the-settings-matrix"></a>
</h2>
<p>The <code>batch_snf</code> function integrates the data in the
<code>data_list</code> using each of the sets of settings contained in
the <code>settings_matrix</code>. The resulting structure is an
<code>solutions_matrix</code> which is an extension of the
<code>settings_matrix</code> that contains columns specifying which
cluster each subject was assigned for the corresponding
<code>settings_matrix</code> row.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">settings_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/20 | Time remaining: 4 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/20 | Time remaining: 4 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 6/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 7/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 8/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 9/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 10/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 11/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 12/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 13/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 14/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 15/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 16/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 17/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 18/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 19/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 20/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 4 seconds."</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "row_id"                    "alpha"                    </span></span>
<span><span class="co">#&gt;  [3] "k"                         "t"                        </span></span>
<span><span class="co">#&gt;  [5] "snf_scheme"                "clust_alg"                </span></span>
<span><span class="co">#&gt;  [7] "cont_dist"                 "disc_dist"                </span></span>
<span><span class="co">#&gt;  [9] "ord_dist"                  "cat_dist"                 </span></span>
<span><span class="co">#&gt; [11] "mix_dist"                  "inc_cortical_thickness"   </span></span>
<span><span class="co">#&gt; [13] "inc_cortical_surface_area" "inc_subcortical_volume"   </span></span>
<span><span class="co">#&gt; [15] "inc_household_income"      "inc_pubertal_status"      </span></span>
<span><span class="co">#&gt; [17] "nclust"                    "subject_NDAR_INV0567T2Y9" </span></span>
<span><span class="co">#&gt; [19] "subject_NDAR_INV0IZ157F8"  "subject_NDAR_INV0J4PYA5F" </span></span>
<span><span class="co">#&gt; [21] "subject_NDAR_INV10OMKVLE"  "subject_NDAR_INV15FPCW4O" </span></span>
<span><span class="co">#&gt; [23] "subject_NDAR_INV19NB4RJK"  "subject_NDAR_INV1HLGR738" </span></span>
<span><span class="co">#&gt; [25] "subject_NDAR_INV1KR0EZFU"  "subject_NDAR_INV1L3Y9EOP" </span></span>
<span><span class="co">#&gt; [27] "subject_NDAR_INV1TCP5GNM"  "subject_NDAR_INV1ZHRDJ6B" </span></span>
<span><span class="co">#&gt; [29] "subject_NDAR_INV2EJ41YSZ"  "subject_NDAR_INV2PK6C85M"</span></span></code></pre></div>
<p>It goes on like this for some time.</p>
<p>Just like that, the clustering is done!</p>
<p>You can pull the clustering results out of each row using the
<code>get_cluster_df</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cluster_solutions.html">get_cluster_solutions</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cluster_solutions</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey 1 2  3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 1 2  1 2 1 1 1 5 2  2  3  1  1  2  1  2  6  1  1  1</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0IZ157F8 2 1 10 1 2 2 2 4 1  1  6  7  2  1  1  1  2  7  8  3</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV0J4PYA5F 1 2  8 2 3 2 3 2 2  3  7  6  2  2  2  2  3  5  6  2</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV10OMKVLE 1 1  3 1 4 2 2 1 1  1  8  4  2  1  1  1  5  3  5  3</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV15FPCW4O 1 2  5 2 7 2 2 1 2  1  1  3  2  2  2  2  1  8  3  2</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV19NB4RJK 1 2  7 2 2 2 2 3 2  4  5  7  2  2  2  2  4  7  8  3</span></span></code></pre></div>
<p><em>Note: Parallel processing is available on an older release of the
package (v0.2.0) and will be integrated into the latest release shortly.
See the “processes” parameter in <code><a href="../reference/batch_snf.html">?batch_snf</a></code>.</em></p>
</div>
<div class="section level2">
<h2 id="picking-a-solution">Picking a solution<a class="anchor" aria-label="anchor" href="#picking-a-solution"></a>
</h2>
<p>Now that we have access to 20 different clustering solutions, we’ll
need to find some way to pick a favourite (or a few). In this case,
plotting or running stats manually on each of the solutions might be a
reasonable way to determine which ones we like the most. But when the
number of solutions generated goes up into the hundreds (or thousands),
we’re going to need some more automated approaches.</p>
<p>Below are some different tools that you can use to try to pick a
solution that is the best for your purposes.</p>
<div class="section level3">
<h3 id="examining-meta-clusters">1: Examining “meta clusters”<a class="anchor" aria-label="anchor" href="#examining-meta-clusters"></a>
</h3>
<p>This is the approach introduced by the original meta clustering
paper. This is a good approach to use when you can’t quantitatively
describe what makes one cluster solution better than another, but you
can have an expert compare the two solutions and “intuit” which of the
two is more desirable.</p>
<p>The idea is to cluster the clustering solutions themselves to arrive
at a small number of qualitatively different solutions. From there, a
user can manually pick out some representative solutions and do the
evaluations themselves.</p>
<p>The first step is to calculate the <a href="https://en.wikipedia.org/wiki/Rand_index" class="external-link">adjusted Rand index</a>
(ARI) between each pair of cluster solutions. This metric tells us how
similar the solutions are to each other, thereby allowing us to find
clusters of cluster solutions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_om_aris.html">calc_om_aris</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Please wait - this may take a minute."</span></span></code></pre></div>
<p>We can visualize the resulting inter-cluster similarities with a
heatmap:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/adjusted_rand_index_heatmap.html">adjusted_rand_index_heatmap</a></span><span class="op">(</span><span class="va">solutions_matrix_aris</span><span class="op">)</span></span></code></pre></div>
<p>You can optionally save your heatmap by specifying a path with the
<code>save</code> parameter (e.g.,
<code>adjusted_rand_index_heatmap(solutions_matrix_aris, save = "./adjusted_rand_index_heatmap.png")</code>).</p>
<div class="figure">
<img src="adjusted_rand_index_heatmap.png" width="400" alt=""><p class="caption">.</p>
</div>
<p>The clustering solutions are along the rows and columns of the above
figure, and the cells at the intersection between two solutions show how
similar (big ARI) those solutions are to each other. The diagonals
should always be red, representing the maximum value of 1, as they show
the similarity between any clustering solution and itself. Agglomerative
hierarchical clustering is being applied to these solutions by default
(thank you, <code>pheatmap</code> package) so the orders of the
clustering solutions here do not exactly line up with the order of the
clustering solutions present in the settings matrix.</p>
<p>If you see something interesting in your heatmap, you may be curious
to know how that corresponds to the settings that were in your settings
matrix.</p>
<p>First, extract the ordering of the rows obtained from the clustering
of the cluster solutions:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_cluster_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_heatmap_order.html">get_heatmap_order</a></span><span class="op">(</span><span class="va">solutions_matrix_aris</span><span class="op">)</span></span></code></pre></div>
<p>The order is just a vector of numbers…</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta_cluster_order</span></span>
<span><span class="co">#&gt;  [1] 11  8 17  3 19 18  5 12  7 20 10  6 13  1 15 16  2  9  4 14</span></span></code></pre></div>
<p>… which can be passed into the <code>settings_matrix_heatmap</code>
function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/settings_matrix_heatmap.html">settings_matrix_heatmap</a></span><span class="op">(</span><span class="va">settings_matrix</span>, order <span class="op">=</span> <span class="va">meta_cluster_order</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="settings_matrix_heatmap_ordered.png" width="400">
</center>
<p>This heatmap rescales all the columns in the settings_matrix to have
a maximum value of 1. The purpose of re-ordering the settings matrix in
this way is to see if any associations exist between certain settings
values and pairwise cluster solution similarities.</p>
<p>Maybe you’ll see something interesting!</p>
</div>
<div class="section level3">
<h3 id="quality-measures">2. Quality measures<a class="anchor" aria-label="anchor" href="#quality-measures"></a>
</h3>
<p>Quality metrics are another useful heuristic for the goodness of a
cluster that don’t require any contextualization of results in the
domain they may be used in. r-package enables measures of silhouette
scores, Dunn indices, and Davies-Bouldin indices. To calculate these
values, we’ll need not only the cluster results but also the final fused
network (the similarity matrices produced by SNF) that the clusters came
from. These similarity matrices can be collected from the
<code>batch_snf</code> using the <code>return_similarity_matrices</code>
parameter:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_snf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    return_similarity_matrices <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/20 | Time remaining: 4 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 6/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 7/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 8/20 | Time remaining: 3 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 9/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 10/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 11/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 12/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 13/20 | Time remaining: 2 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 14/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 15/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 16/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 17/20 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 18/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 19/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 20/20 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 5 seconds."</span></span>
<span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"solutions_matrix"</span></span>
<span><span class="va">similarity_matrices</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"similarity_matrices"</span></span></code></pre></div>
<p>This time, the output of <code>batch_snf</code> is a list. The first
element of the list is a single solutions_matrix, like what we usually
get. The second element is <em>yet another list</em> containing one
final fused network (AKA similarity matrix / similarity matrix) per SNF
run. Using those two lists, we can calculate the above mentioned quality
metrics:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">silhouette_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_silhouettes.html">calculate_silhouettes</a></span><span class="op">(</span><span class="va">solutions_matrix</span>, <span class="va">similarity_matrices</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dunn_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_dunn_indices.html">calculate_dunn_indices</a></span><span class="op">(</span><span class="va">solutions_matrix</span>, <span class="va">similarity_matrices</span><span class="op">)</span></span>
<span></span>
<span><span class="va">db_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_db_indices.html">calculate_db_indices</a></span><span class="op">(</span><span class="va">solutions_matrix</span>, <span class="va">similarity_matrices</span><span class="op">)</span></span></code></pre></div>
<p>The first function is a wrapper around
<code><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">cluster::silhouette</a></code> while the second and third come from
the <em>clv</em> package. <em>clv</em> isn’t set as a mandatory part of
the installation, so you’ll ned to install it yourself to calculate
these two metrics.</p>
<p>The original documentation on these functions can be helpful for
interpreting and working with them:</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.rdocumentation.org/packages/cluster/versions/2.1.4/topics/silhouette" class="external-link"><code>cluster::silhouette</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Dunn" class="external-link"><code>clv::clv.Dunn</code>
documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/clv/versions/0.3-2.1/topics/clv.Davies.Bouldin" class="external-link"><code>clv::clv.Davies.Bouldin</code>
documentation</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="stability-measures">3. Stability measures<a class="anchor" aria-label="anchor" href="#stability-measures"></a>
</h3>
<p>r-package offers tools to evaluate two different measures of
stability:</p>
<ol style="list-style-type: decimal">
<li>Pairwise adjusted Rand indices (across resamplings of the
clustering, on average, how similar was every pair of solutions
according to the adjusted Rand index?)</li>
<li>Fraction clustered together (what is the average fraction of times
that patients who clustered together in the full results clustered
together in resampled results?)</li>
</ol>
<p>To calculate either of these, you’ll need to first generate
subsamples of the data_list.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list_subsamples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_data_list.html">subsample_data_list</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    n_subsamples <span class="op">=</span> <span class="fl">30</span>, <span class="co"># calculate 30 subsamples</span></span>
<span>    subsample_fraction <span class="op">=</span> <span class="fl">0.8</span> <span class="co"># for each subsample, use random 80% of patients</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>data_list_subsamples</code> is a list that now contains 30
smaller subsamples of the original data_list.</p>
<p>Then the stability calculations:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pairwise_aris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample_pairwise_aris.html">subsample_pairwise_aris</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fraction_together</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fraction_clustered_together.html">fraction_clustered_together</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list_subsamples</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    <span class="va">solutions_matrix</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Be warned, that second function is especially extremely slow. As the
number of patients and number of solutions you’re evaluating grows,
these functions can get pretty slow. Consider only using them after
eliminating solutions that you are certainly not interested in further
characterizing.</p>
</div>
<div class="section level3">
<h3 id="evaluating-separation-across-target-variables-of-importance">4. Evaluating separation across “target variables” of
importance<a class="anchor" aria-label="anchor" href="#evaluating-separation-across-target-variables-of-importance"></a>
</h3>
<p><strong>Warning: This approach can very easily result in <a href="https://en.wikipedia.org/wiki/Overfitting" class="external-link">overfitting</a> your
data and producing clustering results that generalize poorly to subjects
outside of your dataset. Consider setting aside some data to validate
your results to avoid this issue.</strong></p>
<p>If you can specify a metric or objective function that may tell you
how useful a clustering solution will be for your purposes in advance,
that makes the cluster selection process much less arbitrary.</p>
<p>There are many ways to go about doing this, but this package offers
one way through the <code>target_list</code> structure. The
<code>target_list</code> contains dataframes what we can examine our
clustering results over through linear regression (continuous data),
ordinal regression (ordinal data), or the Chi-squared test (categorical
data).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_target_list.html">generate_target_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_target_list.html">summarize_target_list</a></span><span class="op">(</span><span class="va">target_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;        name    type length width</span></span>
<span><span class="co">#&gt; 1   anxiety ordinal    275     2</span></span>
<span><span class="co">#&gt; 2 depressed ordinal    275     2</span></span></code></pre></div>
<p>The <code>target_list</code> is like the <code>data_list</code>, but
without the domain attribute. At this time, each dataframe used to build
an target_list must be a single-feature.</p>
<p>Just like when generating the initial <code>data_list</code>, we need
to specify the name of the column in the provided dataframes that is
originally being used to uniquely identify the different observations
from each other with the <code>uid</code> parameter.</p>
<p>We will next extend our <code>solutions_matrix</code> with p-values
from regressing the <code>target_list</code> features onto our generated
clusters.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span><span class="va">solutions_matrix</span>, <span class="va">target_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "row_id"                    "alpha"                    </span></span>
<span><span class="co">#&gt;  [3] "k"                         "t"                        </span></span>
<span><span class="co">#&gt;  [5] "snf_scheme"                "clust_alg"                </span></span>
<span><span class="co">#&gt;  [7] "cont_dist"                 "disc_dist"                </span></span>
<span><span class="co">#&gt;  [9] "ord_dist"                  "cat_dist"                 </span></span>
<span><span class="co">#&gt; [11] "mix_dist"                  "inc_cortical_thickness"   </span></span>
<span><span class="co">#&gt; [13] "inc_cortical_surface_area" "inc_subcortical_volume"   </span></span>
<span><span class="co">#&gt; [15] "inc_household_income"      "inc_pubertal_status"      </span></span>
<span><span class="co">#&gt; [17] "nclust"                    "subject_NDAR_INV0567T2Y9" </span></span>
<span><span class="co">#&gt; [19] "subject_NDAR_INV0IZ157F8"  "subject_NDAR_INV0J4PYA5F" </span></span>
<span><span class="co">#&gt; [21] "subject_NDAR_INV10OMKVLE"  "subject_NDAR_INV15FPCW4O" </span></span>
<span><span class="co">#&gt; [23] "subject_NDAR_INV19NB4RJK"  "subject_NDAR_INV1HLGR738" </span></span>
<span><span class="co">#&gt; [25] "subject_NDAR_INV1KR0EZFU"</span></span>
<span></span>
<span><span class="co"># Looking at the newly added columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/no_subs.html">no_subs</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   row_id alpha  k  t snf_scheme clust_alg cont_dist disc_dist ord_dist cat_dist</span></span>
<span><span class="co">#&gt; 1      1   0.5 29 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 2      2   0.4 26 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 3      3   0.3 44 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 4      4   0.3 43 20          1         1         1         1        1        1</span></span>
<span><span class="co">#&gt; 5      5   0.5 29 20          2         2         1         1        1        1</span></span>
<span><span class="co">#&gt; 6      6   0.4 26 20          2         1         1         1        1        1</span></span>
<span><span class="co">#&gt;   mix_dist inc_cortical_thickness inc_cortical_surface_area</span></span>
<span><span class="co">#&gt; 1        1                      1                         0</span></span>
<span><span class="co">#&gt; 2        1                      1                         1</span></span>
<span><span class="co">#&gt; 3        1                      1                         0</span></span>
<span><span class="co">#&gt; 4        1                      1                         1</span></span>
<span><span class="co">#&gt; 5        1                      1                         1</span></span>
<span><span class="co">#&gt; 6        1                      1                         1</span></span>
<span><span class="co">#&gt;   inc_subcortical_volume inc_household_income inc_pubertal_status nclust</span></span>
<span><span class="co">#&gt; 1                      1                    0                   1      2</span></span>
<span><span class="co">#&gt; 2                      1                    1                   1      2</span></span>
<span><span class="co">#&gt; 3                      0                    1                   1     10</span></span>
<span><span class="co">#&gt; 4                      0                    1                   1      2</span></span>
<span><span class="co">#&gt; 5                      1                    1                   1      8</span></span>
<span><span class="co">#&gt; 6                      1                    1                   1      2</span></span>
<span><span class="co">#&gt;    cbcl_anxiety_r_p   cbcl_depress_r_p  min_p_val mean_p_val</span></span>
<span><span class="co">#&gt; 1 0.758497782121108  0.253657581105355 0.25365758  0.5060777</span></span>
<span><span class="co">#&gt; 2 0.436382083446635 0.0851033924288317 0.08510339  0.2607427</span></span>
<span><span class="co">#&gt; 3 0.590342125663898  0.331219583636934 0.33121958  0.4607809</span></span>
<span><span class="co">#&gt; 4 0.672455644238922  0.863299444565211 0.67245564  0.7678775</span></span>
<span><span class="co">#&gt; 5 0.224206099694958  0.528033268858081 0.22420610  0.3761197</span></span>
<span><span class="co">#&gt; 6 0.677526005779245  0.127648264212471 0.12764826  0.4025871</span></span></code></pre></div>
<p>If you just want the p-values:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_val_select.html">p_val_select</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">target_pvals</span><span class="op">)</span></span>
<span><span class="co">#&gt;   row_id cbcl_anxiety_r_p cbcl_depress_r_p</span></span>
<span><span class="co">#&gt; 1      1        0.7584978       0.25365758</span></span>
<span><span class="co">#&gt; 2      2        0.4363821       0.08510339</span></span>
<span><span class="co">#&gt; 3      3        0.5903421       0.33121958</span></span>
<span><span class="co">#&gt; 4      4        0.6724556       0.86329944</span></span>
<span><span class="co">#&gt; 5      5        0.2242061       0.52803327</span></span>
<span><span class="co">#&gt; 6      6        0.6775260       0.12764826</span></span></code></pre></div>
<p>There is a heatmap for visualizing this too:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pvals_heatmap.html">pvals_heatmap</a></span><span class="op">(</span><span class="va">target_pvals</span>, order <span class="op">=</span> <span class="va">meta_cluster_order</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="pvals_heatmap_ordered.png" width="400">
</center>
<p>These p-values hold no real meaning for the traditional
hypothesis-testing context, but they are reasonable proxies of the
magnitude of the effect size / separation of the clusters across the
variables in question. Here, they are just a tool to find clustering
solutions that are well-separated according to the outcome measures
you’ve specified. Finding a cluster solution like this is similar to a
supervised learning approach, but where the optimization method is just
random sampling. The risk for overfitting your data with this approach
is considerable, so make sure you have some rigorous external validation
before reporting your findings.</p>
<p>We recommend using <em>label propagation</em> (provided by the
SNFtool package in the <code>groupPredict</code> function) for
validation: take the top clustering solutions found in some training
data, assign predicted clusters to some held out test subjects, and then
characterize those test subjects to see how well the clustering solution
seemed to have worked.</p>
</div>
</div>
<div class="section level2">
<h2 id="validating-results-with-label-propagation">Validating results with label propagation<a class="anchor" aria-label="anchor" href="#validating-results-with-label-propagation"></a>
</h2>
<p>Here’s a quick step through of the complete procedure, from the
beginning, with label propagation to validate our findings.</p>
<p>The <code>metasnf</code> package comes equipped with a function to do
the training/testing split for you :)</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># All the subjects present in all dataframes with no NAs</span></span>
<span><span class="va">all_subjects</span> <span class="op">&lt;-</span> <span class="va">data_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="st">"data"</span><span class="op">$</span><span class="st">"subjectkey"</span></span>
<span></span>
<span><span class="co"># Remove the "subject_" prefix to allow merges with the original data</span></span>
<span><span class="va">all_subjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"subject_"</span>, <span class="st">""</span>, <span class="va">all_subjects</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dataframe assigning 80% of subjects to train and 20% to test</span></span>
<span><span class="va">assigned_splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_test_assign.html">train_test_assign</a></span><span class="op">(</span>train_frac <span class="op">=</span> <span class="fl">0.8</span>, subjects <span class="op">=</span> <span class="va">all_subjects</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">assigned_splits</span><span class="op">)</span></span>
<span><span class="co">#&gt;         subjectkey split</span></span>
<span><span class="co">#&gt; 1 NDAR_INV0567T2Y9 train</span></span>
<span><span class="co">#&gt; 2 NDAR_INV0IZ157F8 train</span></span>
<span><span class="co">#&gt; 3 NDAR_INV0J4PYA5F train</span></span>
<span><span class="co">#&gt; 4 NDAR_INV10OMKVLE train</span></span>
<span><span class="co">#&gt; 5 NDAR_INV15FPCW4O train</span></span>
<span><span class="co">#&gt; 6 NDAR_INV19NB4RJK train</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">assigned_splits</span><span class="op">)</span></span>
<span><span class="co">#&gt;           subjectkey split</span></span>
<span><span class="co">#&gt; 95  NDAR_INVGDBYXWV4  test</span></span>
<span><span class="co">#&gt; 96  NDAR_INVHEUWA52I  test</span></span>
<span><span class="co">#&gt; 97  NDAR_INVK9ULDQA2  test</span></span>
<span><span class="co">#&gt; 98  NDAR_INVKYH529RD  test</span></span>
<span><span class="co">#&gt; 99  NDAR_INVL045Z1TY  test</span></span>
<span><span class="co">#&gt; 100 NDAR_INVLDQH8ATK  test</span></span>
<span></span>
<span><span class="co"># Pulling the training and testing subjects specifically</span></span>
<span><span class="va">train_subs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"subjectkey"</span><span class="op">[</span><span class="va">assigned_splits</span><span class="op">$</span><span class="st">"split"</span> <span class="op">==</span> <span class="st">"train"</span><span class="op">]</span></span>
<span><span class="va">test_subs</span> <span class="op">&lt;-</span> <span class="va">assigned_splits</span><span class="op">$</span><span class="st">"subjectkey"</span><span class="op">[</span><span class="va">assigned_splits</span><span class="op">$</span><span class="st">"split"</span> <span class="op">==</span> <span class="st">"test"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Partition a training set</span></span>
<span><span class="va">train_abcd_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span><span class="op">[</span><span class="va">abcd_cort_t</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_cort_sa</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_sa</span><span class="op">[</span><span class="va">abcd_cort_sa</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_subc_v</span> <span class="op">&lt;-</span> <span class="va">abcd_subc_v</span><span class="op">[</span><span class="va">abcd_subc_v</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_h_income</span> <span class="op">&lt;-</span> <span class="va">abcd_h_income</span><span class="op">[</span><span class="va">abcd_h_income</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_pubertal</span> <span class="op">&lt;-</span> <span class="va">abcd_pubertal</span><span class="op">[</span><span class="va">abcd_pubertal</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span><span class="op">[</span><span class="va">abcd_anxiety</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span><span class="va">train_abcd_depress</span> <span class="op">&lt;-</span> <span class="va">abcd_depress</span><span class="op">[</span><span class="va">abcd_depress</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">train_subs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Partition a test set</span></span>
<span><span class="va">test_abcd_cort_t</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_t</span><span class="op">[</span><span class="va">abcd_cort_t</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_cort_sa</span> <span class="op">&lt;-</span> <span class="va">abcd_cort_sa</span><span class="op">[</span><span class="va">abcd_cort_sa</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_subc_v</span> <span class="op">&lt;-</span> <span class="va">abcd_subc_v</span><span class="op">[</span><span class="va">abcd_subc_v</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_h_income</span> <span class="op">&lt;-</span> <span class="va">abcd_h_income</span><span class="op">[</span><span class="va">abcd_h_income</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_pubertal</span> <span class="op">&lt;-</span> <span class="va">abcd_pubertal</span><span class="op">[</span><span class="va">abcd_pubertal</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_anxiety</span> <span class="op">&lt;-</span> <span class="va">abcd_anxiety</span><span class="op">[</span><span class="va">abcd_anxiety</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span><span class="va">test_abcd_depress</span> <span class="op">&lt;-</span> <span class="va">abcd_depress</span><span class="op">[</span><span class="va">abcd_depress</span><span class="op">$</span><span class="st">"patient"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_subs</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># A data list with just training subjects</span></span>
<span><span class="va">train_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_cort_sa</span>, <span class="st">"cortical_sa"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A data list with training and testing subjects</span></span>
<span><span class="va">full_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_cort_t</span>, <span class="st">"cortical_thickness"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_cort_sa</span>, <span class="st">"cortical_surface_area"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span>,</span>
<span>    assigned_splits <span class="op">=</span> <span class="va">assigned_splits</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct the target lists</span></span>
<span><span class="va">train_target_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_target_list.html">generate_target_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">train_abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find a clustering solution in your training data</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">train_data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    min_k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">30</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span>
<span></span>
<span><span class="va">train_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">train_data_list</span>,</span>
<span>    <span class="va">settings_matrix</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/5 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 1 seconds."</span></span>
<span></span>
<span><span class="va">extended_solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">train_solutions_matrix</span>,</span>
<span>    <span class="va">train_target_list</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The fifth row had the lowest minimum p-value across our outcomes</span></span>
<span><span class="va">lowest_min_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"min_p_val"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">extended_solutions_matrix</span><span class="op">$</span><span class="st">"min_p_val"</span> <span class="op">==</span> <span class="va">lowest_min_p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co"># Keep track of your top solution</span></span>
<span><span class="va">top_row</span> <span class="op">&lt;-</span> <span class="va">extended_solutions_matrix</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Use the solutions matrix from the training subjects and the data list from</span></span>
<span><span class="co"># the training and testing subjects to propagate labels to the test subjects</span></span>
<span><span class="va">propagated_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lp_solutions_matrix.html">lp_solutions_matrix</a></span><span class="op">(</span><span class="va">top_row</span>, <span class="va">full_data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 1..."</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey group 4</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 train 2</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0IZ157F8 train 1</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV0J4PYA5F train 2</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV10OMKVLE train 2</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV15FPCW4O train 2</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV19NB4RJK train 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   subjectkey group 4</span></span>
<span><span class="co">#&gt; 95  subject_NDAR_INVGDBYXWV4  test 2</span></span>
<span><span class="co">#&gt; 96  subject_NDAR_INVHEUWA52I  test 2</span></span>
<span><span class="co">#&gt; 97  subject_NDAR_INVK9ULDQA2  test 2</span></span>
<span><span class="co">#&gt; 98  subject_NDAR_INVKYH529RD  test 2</span></span>
<span><span class="co">#&gt; 99  subject_NDAR_INVL045Z1TY  test 2</span></span>
<span><span class="co">#&gt; 100 subject_NDAR_INVLDQH8ATK  test 2</span></span></code></pre></div>
<p>You could, if you wanted, see how <em>all</em> of your clustering
solutions propagate to the test set, but that would mean reusing your
test set and removing the protection against overfitting conferred by
this procedure.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">propagated_labels_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lp_solutions_matrix.html">lp_solutions_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">extended_solutions_matrix</span>,</span>
<span>    <span class="va">full_data_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 5..."</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 5..."</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 subjectkey group 1 2  3 4 5</span></span>
<span><span class="co">#&gt; 1 subject_NDAR_INV0567T2Y9 train 5 2 10 2 1</span></span>
<span><span class="co">#&gt; 2 subject_NDAR_INV0IZ157F8 train 4 1 10 1 2</span></span>
<span><span class="co">#&gt; 3 subject_NDAR_INV0J4PYA5F train 6 2  8 2 2</span></span>
<span><span class="co">#&gt; 4 subject_NDAR_INV10OMKVLE train 1 1  3 2 2</span></span>
<span><span class="co">#&gt; 5 subject_NDAR_INV15FPCW4O train 1 2  7 2 2</span></span>
<span><span class="co">#&gt; 6 subject_NDAR_INV19NB4RJK train 3 2 10 2 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">propagated_labels_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   subjectkey group 1 2 3 4 5</span></span>
<span><span class="co">#&gt; 95  subject_NDAR_INVGDBYXWV4  test 1 2 7 2 2</span></span>
<span><span class="co">#&gt; 96  subject_NDAR_INVHEUWA52I  test 4 2 6 2 2</span></span>
<span><span class="co">#&gt; 97  subject_NDAR_INVK9ULDQA2  test 3 2 6 2 1</span></span>
<span><span class="co">#&gt; 98  subject_NDAR_INVKYH529RD  test 6 2 2 2 2</span></span>
<span><span class="co">#&gt; 99  subject_NDAR_INVL045Z1TY  test 1 2 1 2 2</span></span>
<span><span class="co">#&gt; 100 subject_NDAR_INVLDQH8ATK  test 1 2 1 2 2</span></span></code></pre></div>
<p>That’s all!</p>
<p>If you have any questions, comments, suggestions, bugs, etc. feel
free to post an issue at <a href="https://github.com/BRANCHlab/metasnf" class="external-link">https://github.com/BRANCHlab/metasnf</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Caruana, Rich, Mohamed Elhawary, Nam Nguyen, and Casey Smith. 2006.
“Meta Clustering.” In Sixth International Conference on Data Mining
(ICDM’06), 107–18. <a href="https://doi.org/10.1109/ICDM.2006.103" class="external-link uri">https://doi.org/10.1109/ICDM.2006.103</a>.</p>
<p>Wang, Bo, Aziz M. Mezlini, Feyyaz Demir, Marc Fiume, Zhuowen Tu,
Michael Brudno, Benjamin Haibe-Kains, and Anna Goldenberg. 2014.
“Similarity Network Fusion for Aggregating Data Types on a Genomic
Scale.” Nature Methods 11 (3): 333–37. <a href="https://doi.org/10.1038/nmeth.2810" class="external-link uri">https://doi.org/10.1038/nmeth.2810</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
