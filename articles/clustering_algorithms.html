<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>Clustering Algorithms • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Clustering Algorithms">
<meta property="og:description" content="metasnf">
<meta name="google-site-verification" content="Xzz1SIDqvPwru_mXKCXAkX2pNfOz5PO_QO02QG98tZI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Example workflows</h6>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/a_complete_example.html">A Less Simple Example</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Essentials</h6>
    <a class="dropdown-item" href="../articles/settings_matrix.html">The Settings Matrix</a>
    <a class="dropdown-item" href="../articles/data_list.html">The Data List</a>
    <a class="dropdown-item" href="../articles/snf_schemes.html">SNF schemes</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Further customization</h6>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/clustering_algorithms.html">Clustering Algorithms</a>
    <a class="dropdown-item" href="../articles/feature_weights.html">Feature Weights</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Additional functionality</h6>
    <a class="dropdown-item" href="../articles/stability_measures.html">Stability Measures and Consensus Clustering</a>
    <a class="dropdown-item" href="../articles/quality_measures.html">Quality Measures</a>
    <a class="dropdown-item" href="../articles/confounders.html">Confounders and Unwanted Signal</a>
    <a class="dropdown-item" href="../articles/parallel_processing.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/label_propagation.html">Label propagation</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Plotting</h6>
    <a class="dropdown-item" href="../articles/similarity_matrix_heatmap.html">Similarity Matrix Heatmaps</a>
    <a class="dropdown-item" href="../articles/manhattan_plots.html">Manhattan Plots</a>
    <a class="dropdown-item" href="../articles/alluvial_plots.html">Alluvial Plots</a>
    <a class="dropdown-item" href="../articles/correlation_plots.html">Correlation Plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Clustering Algorithms</h1>
            
      
      
      <div class="d-none name"><code>clustering_algorithms.Rmd</code></div>
    </div>

    
    
<style>
div.aside { background-color:#fff2e6; }
</style>
<p>Download a copy of the vignette to follow along here: <a href="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/vignettes/clustering_algorithms.Rmd" class="external-link">clustering_algorithms.Rmd</a></p>
<div class="section level2">
<h2 id="clustering-algorithms">Clustering Algorithms<a class="anchor" aria-label="anchor" href="#clustering-algorithms"></a>
</h2>
<p>SNF produces a single similarity matrix that is meant to describe how
similar all the initial patients (or participants, or instances) are to
each other across all the provided input features. Dividing that
similarity matrix into subtypes requires can be done using clustering
algorithms. Within the metasnf package, clustering is done by default
using the spectral clustering algorithm (as implemented by the original
SNFtool package). The code below goes over what the default clustering
looks like.</p>
<div class="section level3">
<h3 id="default-clustering">Default clustering<a class="anchor" aria-label="anchor" href="#default-clustering"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start by making a data list containing all our dataframes to more easily</span></span>
<span><span class="co"># identify subjects without missing data</span></span>
<span><span class="va">full_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_subc_v</span>, <span class="st">"subcortical_volume"</span>, <span class="st">"neuroimaging"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_h_income</span>, <span class="st">"household_income"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_pubertal</span>, <span class="st">"pubertal_status"</span>, <span class="st">"demographics"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_anxiety</span>, <span class="st">"anxiety"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abcd_depress</span>, <span class="st">"depressed"</span>, <span class="st">"behaviour"</span>, <span class="st">"ordinal"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Partition into a data and target list (optional)</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="va">full_data_list</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">target_list</span> <span class="op">&lt;-</span> <span class="va">full_data_list</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Specifying 5 different sets of settings for SNF</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># This matrix has clustering solutions for each of the 5 SNF runs!</span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span><span class="va">data_list</span>, <span class="va">settings_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/5 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 1 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">extended_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extend_solutions.html">extend_solutions</a></span><span class="op">(</span></span>
<span>    <span class="va">solutions_matrix</span>,</span>
<span>    <span class="va">target_list</span>,</span>
<span>    cat_test <span class="op">=</span> <span class="st">"fisher_exact"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing row 1 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 2 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 3 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 4 of 5"</span></span>
<span><span class="co">#&gt; [1] "Processing row 5 of 5"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust_esm_manhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/esm_manhattan_plot.html">esm_manhattan_plot</a></span><span class="op">(</span></span>
<span>    <span class="va">extended_solutions</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    bonferroni_line <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>    <span class="st">"clust_esm_manhattan.png"</span>,</span>
<span>    <span class="va">clust_esm_manhattan</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    dpi <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/BRANCHlab/metasnf/main/media/clust_esm_manhattan.png">
</center>
<p>The Manhattan plot shows the p-values (y-axis) of the associations
between our target variables (x-axis) and each cluster solution we
calculated (colour) for each row of the settings matrix.</p>
<p>The information about the clustering used is tucked away in the
settings matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings_matrix</span><span class="op">$</span><span class="st">"clust_alg"</span></span>
<span><span class="co">#&gt; [1] 2 1 2 1 1</span></span></code></pre></div>
<p>The “1” corresponds to spectral clustering using the eigen-gap
heuristic to determine the number of clusters, while the “2” corresponds
to spectral clustering using the rotation cost heuristic to determine
the number of clusters. You can find this information by running
<code><a href="../reference/generate_settings_matrix.html">?generate_settings_matrix</a></code>.</p>
</div>
<div class="section level3">
<h3 id="other-built-in-clustering-options">Other built-in clustering options<a class="anchor" aria-label="anchor" href="#other-built-in-clustering-options"></a>
</h3>
<p>Currently, the available clustering algorithms are:</p>
<ul>
<li><code>spectral_eigen</code></li>
<li><code>spectral_rot</code></li>
<li><code>spectral_two</code></li>
<li><code>spectral_three</code></li>
<li><code>spectral_four</code></li>
<li><code>spectral_five</code></li>
<li><code>spectral_six</code></li>
<li><code>spectral_seven</code></li>
<li><code>spectral_eight</code></li>
</ul>
<p>The first two are the defaults, and the remaining ones specifically
use 2, 3, 4, … and so on as their number of clusters rather than
whatever is calculated by a separate heuristic function.</p>
<p>To make use of any of these alternative algorithms, you’ll need to
provide <code>batch_snf</code> with a custom
<code>clust_algs_list</code>. Here’s what that looks like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clust_algs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_clust_algs_list.html">generate_clust_algs_list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The default list:</span></span>
<span><span class="va">clust_algs_list</span></span>
<span><span class="co">#&gt; $spectral_eigen</span></span>
<span><span class="co">#&gt; function (similarity_matrix) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     estimated_n &lt;- SNFtool::estimateNumberOfClustersGivenGraph(W = similarity_matrix, </span></span>
<span><span class="co">#&gt;         NUMC = 2:10)</span></span>
<span><span class="co">#&gt;     number_of_clusters &lt;- estimated_n$`Eigen-gap best`</span></span>
<span><span class="co">#&gt;     solution &lt;- SNFtool::spectralClustering(similarity_matrix, </span></span>
<span><span class="co">#&gt;         number_of_clusters)</span></span>
<span><span class="co">#&gt;     solution_data &lt;- list(solution = solution, nclust = number_of_clusters)</span></span>
<span><span class="co">#&gt;     if (number_of_clusters != length(unique(solution))) {</span></span>
<span><span class="co">#&gt;         warning("Spectral clustering provided a solution of size ", </span></span>
<span><span class="co">#&gt;             length(unique(solution)), " when the number requested based on the eigen-gap heuristic", </span></span>
<span><span class="co">#&gt;             " was ", number_of_clusters, ".")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(solution_data)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55dd14b2db38&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:metasnf&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $spectral_rot</span></span>
<span><span class="co">#&gt; function (similarity_matrix) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     estimated_n &lt;- SNFtool::estimateNumberOfClustersGivenGraph(W = similarity_matrix, </span></span>
<span><span class="co">#&gt;         NUMC = 2:10)</span></span>
<span><span class="co">#&gt;     number_of_clusters &lt;- estimated_n$`Rotation cost best`</span></span>
<span><span class="co">#&gt;     solution &lt;- SNFtool::spectralClustering(similarity_matrix, </span></span>
<span><span class="co">#&gt;         number_of_clusters)</span></span>
<span><span class="co">#&gt;     solution_data &lt;- list(solution = solution, nclust = number_of_clusters)</span></span>
<span><span class="co">#&gt;     if (number_of_clusters != length(unique(solution))) {</span></span>
<span><span class="co">#&gt;         warning("Spectral clustering provided a solution of size ", </span></span>
<span><span class="co">#&gt;             length(unique(solution)), " when the number requested based on the rotation cost heuristic", </span></span>
<span><span class="co">#&gt;             " was ", number_of_clusters, ".")</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(solution_data)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55dd14b2fc88&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:metasnf&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># A prettier format:</span></span>
<span><span class="fu"><a href="../reference/summarize_clust_algs_list.html">summarize_clust_algs_list</a></span><span class="op">(</span><span class="va">clust_algs_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;   alg_number      algorithm</span></span>
<span><span class="co">#&gt; 1          1 spectral_eigen</span></span>
<span><span class="co">#&gt; 2          2   spectral_rot</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Adding algorithms provided by the package</span></span>
<span><span class="va">clust_algs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_clust_algs_list.html">generate_clust_algs_list</a></span><span class="op">(</span></span>
<span>    <span class="st">"two_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_two</span>,</span>
<span>    <span class="st">"five_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_five</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that this one has the default algorithms as well as the newly added ones</span></span>
<span><span class="fu"><a href="../reference/summarize_clust_algs_list.html">summarize_clust_algs_list</a></span><span class="op">(</span><span class="va">clust_algs_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;   alg_number             algorithm</span></span>
<span><span class="co">#&gt; 1          1        spectral_eigen</span></span>
<span><span class="co">#&gt; 2          2          spectral_rot</span></span>
<span><span class="co">#&gt; 3          3  two_cluster_spectral</span></span>
<span><span class="co">#&gt; 4          4 five_cluster_spectral</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># This list has only the newly added ones, thanks to the disable_base parameter</span></span>
<span><span class="va">clust_algs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_clust_algs_list.html">generate_clust_algs_list</a></span><span class="op">(</span></span>
<span>    <span class="st">"two_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_two</span>,</span>
<span>    <span class="st">"five_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_five</span>,</span>
<span>    disable_base <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/summarize_clust_algs_list.html">summarize_clust_algs_list</a></span><span class="op">(</span><span class="va">clust_algs_list</span><span class="op">)</span></span>
<span><span class="co">#&gt;   alg_number             algorithm</span></span>
<span><span class="co">#&gt; 1          1  two_cluster_spectral</span></span>
<span><span class="co">#&gt; 2          2 five_cluster_spectral</span></span></code></pre></div>
<p><strong>By default, the settings matrix only varies over the values 1
and 2</strong>. This is because, by default, it only expects you to use
the default clustering algorithms. If your custom list is two algorithms
long, that’s fine, but if it isn’t, it’s imperative that you either
manually adjust the numbers in <code>settings_matrix$"clust_algs"</code>
or (more easily) you supply your custom list during settings matrix
generation:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This list has only the newly added ones, thanks to the disable_base parameter</span></span>
<span><span class="va">clust_algs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_clust_algs_list.html">generate_clust_algs_list</a></span><span class="op">(</span></span>
<span>    <span class="st">"two_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_two</span>,</span>
<span>    <span class="st">"three_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_three</span>,</span>
<span>    <span class="st">"five_cluster_spectral"</span> <span class="op">=</span> <span class="va">spectral_five</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specifying 5 different sets of settings for SNF</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span>,</span>
<span>    clustering_algorithms <span class="op">=</span> <span class="va">clust_algs_list</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">settings_matrix</span><span class="op">$</span><span class="st">"clust_alg"</span></span>
<span><span class="co">#&gt;  [1] 3 1 1 5 2 2 4 1 3 3</span></span></code></pre></div>
<p>Then, make sure to provide the <code>clust_algs_list</code> once more
during the call to <code>batch_snf</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    clust_algs_list <span class="op">=</span> <span class="va">clust_algs_list</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="structure-of-a-clustering-algorithm-function">Structure of a clustering algorithm function<a class="anchor" aria-label="anchor" href="#structure-of-a-clustering-algorithm-function"></a>
</h3>
<p>Any clustering algorithm can be used as long as you can write a
function for it with the following format:</p>
<ol style="list-style-type: decimal">
<li>Takes a single N*N similarity_matrix as its only input</li>
<li>Returns a named list:
<ul>
<li>The first item (named “solution”) is a single N-dimensional vector
of numbers corresponding to the observations in the similarity
matrix</li>
<li>The second item (named “nclust”) is a single integer indicating the
number of clusters that the algorithm is supposed to have generated</li>
</ul>
</li>
</ol>
<p>That second point seems redundant in that it could be calculated by
simply running <code>length(unique(solution))</code>, but it’s useful to
keep track of it separately for troubleshooting purposes.</p>
<p>Note that the function should <em>not</em> take number of clusters as
an argument - if you want to explore the same clustering algorithm with
a varying number of clusters, you’ll need to provide a separate function
for each number of clusters you’re interested in.</p>
<p>The source code for the two default functions are shown below:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default clustering algorithm #1</span></span>
<span><span class="va">spectral_eigen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">similarity_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">estimated_n</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/estimateNumberOfClustersGivenGraph.html" class="external-link">estimateNumberOfClustersGivenGraph</a></span><span class="op">(</span></span>
<span>        <span class="va">similarity_matrix</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">number_of_clusters</span> <span class="op">&lt;-</span> <span class="va">estimated_n</span><span class="op">$</span><span class="va">`Eigen-gap best`</span></span>
<span>    <span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/spectralClustering.html" class="external-link">spectralClustering</a></span><span class="op">(</span></span>
<span>        <span class="va">similarity_matrix</span>,</span>
<span>        <span class="va">number_of_clusters</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"solution"</span> <span class="op">=</span> <span class="va">solution</span>, <span class="st">"nclust"</span> <span class="op">=</span> <span class="va">number_of_clusters</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Default clustering algorithm #2</span></span>
<span><span class="va">spectral_rot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">similarity_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">estimated_n</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/estimateNumberOfClustersGivenGraph.html" class="external-link">estimateNumberOfClustersGivenGraph</a></span><span class="op">(</span><span class="va">similarity_matrix</span><span class="op">)</span></span>
<span>    <span class="va">number_of_clusters</span> <span class="op">&lt;-</span> <span class="va">estimated_n</span><span class="op">$</span><span class="va">`Rotation cost best`</span></span>
<span>    <span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu">SNFtool</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SNFtool/man/spectralClustering.html" class="external-link">spectralClustering</a></span><span class="op">(</span><span class="va">similarity_matrix</span>, <span class="va">number_of_clusters</span><span class="op">)</span></span>
<span>    <span class="va">solution_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"solution"</span> <span class="op">=</span> <span class="va">solution</span>, <span class="st">"nclust"</span> <span class="op">=</span> <span class="va">number_of_clusters</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">solution_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="non-automated-clustering">Non-automated clustering<a class="anchor" aria-label="anchor" href="#non-automated-clustering"></a>
</h3>
<p>You can also extract the similarity matrices for each computed row of
the settings matrix and perform the clustering more “manually”. This is
particularly useful for clustering procedures where the transition from
a similarity matrix to the final solution requires human intervention
(e.g., judgement for clustering hyperparameters).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">batch_snf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    clust_algs_list <span class="op">=</span> <span class="va">clust_algs_list</span>,</span>
<span>    return_similarity_matrices <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/10 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/10 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/10 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/10 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 6/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 7/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 8/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 9/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 10/10 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 1 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">batch_snf_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "solutions_matrix"    "similarity_matrices"</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"solutions_matrix"</span></span>
<span></span>
<span><span class="co"># Similarity matrices are in the list below:</span></span>
<span><span class="va">similarity_matrices</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"similarity_matrices"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">similarity_matrices</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">similarity_matrices</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 87 87</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Your manual clustering goes here...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-of-non-automated-clustering-dbscan">Example of non-automated clustering: DBSCAN<a class="anchor" aria-label="anchor" href="#example-of-non-automated-clustering-dbscan"></a>
</h3>
<p>Let’s say we wanted to cluster our similarity matrices with DBSCAN
rather than with spectral clustering. Start by taking a look at the
documentation for running the DBSCAN function from the dbscan R package
<a href="https://cran.r-project.org/web/packages/dbscan/dbscan.pdf" class="external-link">https://cran.r-project.org/web/packages/dbscan/dbscan.pdf</a>:</p>
<p>DBSCAN is about as challenging as custom clustering can get, as the
suggested process for specifying the number of clusters is recommended
to involve human intervention and the function itself operates on
dissimilarity (distance) matrices rather than similarity matrices.</p>
<p>Below is a slightly adjusted form of their <code>dbscan</code>
example. You can work through this on your own.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/dbscan" class="external-link">dbscan</a></span><span class="op">)</span></span>
<span><span class="co">## Example 1: use dbscan on the iris data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">iris_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Find suitable DBSCAN parameters:</span></span>
<span><span class="co">## 1. We use minPts = dim + 1 = 5 for iris. A larger value can also be used.</span></span>
<span><span class="co">## 2. We inspect the k-NN distance plot for k = minPts - 1 = 4</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/kNNdist.html" class="external-link">kNNdistplot</a></span><span class="op">(</span><span class="va">iris</span>, minPts <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Noise seems to start around a 4-NN distance of .7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">.7</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html" class="external-link">dbscan</a></span><span class="op">(</span><span class="va">iris_dist</span>, eps <span class="op">=</span> <span class="fl">0.7</span>, minPts <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The 1 is added to ensure that those with no cluster (cluster 0) are still</span></span>
<span><span class="co"># plotted.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">iris</span>, col <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">cluster</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>After some poking around, you will often see people mentioning that
DBSCAN just isn’t meant to be automated. You need to look at your data
to have a good idea of what values to use for the hyperparameters
<code>eps</code> and <code>minPts</code>. When you need to get involved
manually, that’s the perfect time to manage the many similarity matrices
you’ve created with <code>batch_snf</code> through meta clustering.
Generate a wide range of similarity matrices and apply meta clustering
to find a few representative similarity matrices. One way to do this
would be based on how the spectral-clustering derived solutions end up
clustering together (see <a href="https://branchlab.github.io/metasnf/articles/a_complete_example.html#examining-meta-clusters">example</a>).
Then take the corresponding affinity matrices and go through the dbscan
clustering process manually.</p>
<p>Based on <code><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html" class="external-link">?dbscan</a></code>, it looks like the function can accept
precomputed distance matrices (instead of
<code>precomputed_nn_object</code>s) as long as they actually are
<code>dist</code> objects (which can be done using the
<code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist()</a></code> function). There are many formulas to convert
between similarity matrices and distance matrices which have their own
pros and cons. Here, we’ll use a common approach of
<code>distance = max(similarity) - similarity</code>. Whichever matrix
values had the maximum similarity will now have a distance of 0, and
whichever matrix values had the lowest amount of similarity will have
distance values that are the closest to the former maximum similarity
value.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/dbscan" class="external-link">dbscan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dbscan'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     as.dendrogram</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">expression_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"genes_1_and_2_exp"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"gene_expression"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">methylation_df</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"genes_1_and_2_meth"</span>,</span>
<span>        domain <span class="op">=</span> <span class="st">"gene_methylation"</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"continuous"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "The global seed has been changed!"</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">batch_snf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    return_similarity_matrices <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Row: 1/5 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 2/5 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 3/5 | Time remaining: 1 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 4/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Row: 5/5 | Time remaining: 0 seconds"</span></span>
<span><span class="co">#&gt; [1] "Total time taken: 2 seconds."</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">similarity_matrices</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"similarity_matrices"</span></span>
<span></span>
<span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"solutions_matrix"</span></span>
<span></span>
<span><span class="va">representative_sm</span> <span class="op">&lt;-</span> <span class="va">similarity_matrices</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">representative_sms</span> <span class="op">&lt;-</span> <span class="va">similarity_matrices</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">distance_matrix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">representative_sm</span><span class="op">)</span> <span class="op">-</span> <span class="va">representative_sm</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/kNNdist.html" class="external-link">kNNdistplot</a></span><span class="op">(</span></span>
<span>    <span class="va">distance_matrix1</span>,</span>
<span>    minPts <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Maybe there?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.4872</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_algorithms_files/figure-html/unnamed-chunk-11-1.png" width="480"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dbscan_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html" class="external-link">dbscan</a></span><span class="op">(</span><span class="va">distance_matrix1</span>, eps <span class="op">=</span> <span class="fl">0.4872</span>, minPts <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="st">"cluster"</span></span>
<span></span>
<span><span class="va">spectral_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clusters.html">get_clusters</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dbscan_vs_spectral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    dbscan <span class="op">=</span> <span class="va">dbscan_results</span>,</span>
<span>    spectral <span class="op">=</span> <span class="va">spectral_results</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dbscan_vs_spectral</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dbscan</span>, y <span class="op">=</span> <span class="va">spectral</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.1</span>, width <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="clustering_algorithms_files/figure-html/unnamed-chunk-11-2.png" width="480"></p>
<p>There’s one bold lie in the code chunk above, which is how easy it
was to find that magic hyperparameter combination of
<code>minPts = 10</code> and <code>eps = 0.487</code> parameter value of
0.4872. It wasn’t based off of the visual inspection of the kNNdistplot,
but rather through a lot of trial and error.</p>
<p>Something along the lines of:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.485</span>, <span class="fl">0.488</span>, by <span class="op">=</span> <span class="fl">0.0001</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dbscan/man/dbscan.html" class="external-link">dbscan</a></span><span class="op">(</span><span class="va">distance_matrix1</span>, eps <span class="op">=</span> <span class="va">i</span>, minPts <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="st">"cluster"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In this specific instance, those hyperparameters are incredibly
sensitive - a slight change will get very different results. That is
likely due to the shape of the actual data being clustered. Your mileage
may vary!</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Madeline Couse, Julia Smith, Maria T Secara, Nick Denson, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Shihao Ma, Anna Goldenberg, Bo Wang, Linda T Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
