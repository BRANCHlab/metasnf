<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metasnf">
<title>Plotting Similarity Matrices • metasnf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting Similarity Matrices">
<meta property="og:description" content="metasnf">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metasnf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/a_less_simple_example.html">A Less Simple Example</a>
    <a class="dropdown-item" href="../articles/a_simple_example.html">A Simple Example</a>
    <a class="dropdown-item" href="../articles/alluvial_plots.html">Alluvial Plots</a>
    <a class="dropdown-item" href="../articles/distance_metrics.html">Distance Metrics</a>
    <a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/manhattan_plots.html">Manhattan Plots</a>
    <a class="dropdown-item" href="../articles/similarity_matrix_heatmap.html">Plotting Similarity Matrices</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plotting Similarity Matrices</h1>
            
      
      
      <div class="d-none name"><code>similarity_matrix_heatmap.Rmd</code></div>
    </div>

    
    
<p>This vignette walks through usage of
<code>similarity_matrix_heatmap</code> to visualize the final similarity
matrix produced by a run of SNF and how that matrix associates with
other patient attributes.</p>
<div class="section level2">
<h2 id="data-set-up">Data set-up<a class="anchor" aria-label="anchor" href="#data-set-up"></a>
</h2>
<p>Mock data setup is below. This example currently makes use of the
mock “Data1” and “Data2” objects that are made available by loading the
SNFtool package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SNFtool</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://branchlab.github.io/metasnf/">metasnf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load in data from SNFtool</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Data1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Data2</span><span class="op">)</span></span></code></pre></div>
<p>By default, these two objects are sorted such that the first 100
patients were drawn from one distribution and the second set of 100
patients were drawn from another. We’ll extend this data with some fake
additional associations. The first 100 patients (who come from one
cluster) will be more likely to be females with a higher chance of
having a definite positive asthma diagnosis and of having atopic asthma
than the second set of 100 patients.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the possible values</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span></span>
<span><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"definite asthma"</span>, <span class="st">"possible asthma"</span>, <span class="st">"no asthma"</span><span class="op">)</span></span>
<span><span class="va">atopic_asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Yes"</span>, <span class="st">"No"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># C1: mostly F, mostly "definite asthma", mostly "Yes" to atopic asthma</span></span>
<span><span class="va">c1_genders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">gender</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c1_diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c1_asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">atopic_asthma</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c1_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c2_genders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">gender</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c2_diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">diagnosis</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c2_asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">atopic_asthma</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">c2_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>,<span class="op">)</span></span>
<span></span>
<span><span class="va">genders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c1_genders</span>, <span class="va">c2_genders</span><span class="op">)</span></span>
<span><span class="va">diagnoses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c1_diagnosis</span>, <span class="va">c2_diagnosis</span><span class="op">)</span></span>
<span><span class="va">asthmas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c1_asthma</span>, <span class="va">c2_asthma</span><span class="op">)</span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c1_ages</span>, <span class="va">c2_ages</span><span class="op">)</span></span>
<span></span>
<span><span class="va">additional_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    gender <span class="op">=</span> <span class="va">genders</span>,</span>
<span>    diagnosis <span class="op">=</span> <span class="va">diagnoses</span>,</span>
<span>    asthma <span class="op">=</span> <span class="va">asthmas</span>,</span>
<span>    age <span class="op">=</span> <span class="va">ages</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">additional_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   gender       diagnosis asthma age</span></span>
<span><span class="co">## 1   male       no asthma    Yes  16</span></span>
<span><span class="co">## 2   male definite asthma    Yes  16</span></span>
<span><span class="co">## 3 female possible asthma    Yes  18</span></span>
<span><span class="co">## 4 female       no asthma    Yes  17</span></span>
<span><span class="co">## 5 female possible asthma     No  16</span></span>
<span><span class="co">## 6 female definite asthma    Yes  17</span></span></code></pre>
<p>The patient unique IDs are randomly shuffled in this example to
replicate scenarios where the original data doesn’t begin ordered by the
true cluster labels.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign unique patient identifiers to each patient</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">random_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">100</span><span class="op">:</span><span class="fl">999</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Data1</span><span class="op">$</span><span class="st">"patient_id"</span> <span class="op">&lt;-</span> <span class="va">random_ids</span></span>
<span><span class="va">Data2</span><span class="op">$</span><span class="st">"patient_id"</span> <span class="op">&lt;-</span> <span class="va">random_ids</span></span>
<span><span class="va">additional_data</span><span class="op">$</span><span class="st">"patient_id"</span> <span class="op">&lt;-</span> <span class="va">random_ids</span></span></code></pre></div>
<p>Then the subtyping and clustering proceeds as shown in previous
vignettes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate data_list</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data_list.html">generate_data_list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Data1</span>, <span class="st">"genes_1_and_2_exp"</span>, <span class="st">"gene_expression"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Data2</span>, <span class="st">"genes_1_and_2_meth"</span>, <span class="st">"gene_methylation"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">additional_data</span>, <span class="st">"additional_data"</span>, <span class="st">"miscellaneous"</span>, <span class="st">"mixed"</span><span class="op">)</span>,</span>
<span>    uid <span class="op">=</span> <span class="st">"patient_id"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate settings_matrix</span></span>
<span><span class="va">settings_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_settings_matrix.html">generate_settings_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    max_k <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">42</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "The global seed has been changed!"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run SNF and clustering</span></span>
<span><span class="va">batch_snf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_snf.html">batch_snf</a></span><span class="op">(</span></span>
<span>    <span class="va">data_list</span>,</span>
<span>    <span class="va">settings_matrix</span>,</span>
<span>    return_similarity_matrices <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Row: 1/1 | Time remaining: 0 seconds"</span></span>
<span><span class="co">## [1] "Total time taken: 0 seconds."</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">solutions_matrix</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"solutions_matrix"</span></span>
<span><span class="va">similarity_matrices</span> <span class="op">&lt;-</span> <span class="va">batch_snf_results</span><span class="op">$</span><span class="st">"similarity_matrices"</span></span>
<span></span>
<span><span class="co"># The first (and only) similarity matrix:</span></span>
<span><span class="va">similarity_matrix</span> <span class="op">&lt;-</span> <span class="va">similarity_matrices</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># The first (and only) cluster solution:</span></span>
<span><span class="va">cluster_solution</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cluster_solutions.html">get_cluster_solutions</a></span><span class="op">(</span><span class="va">solutions_matrix</span><span class="op">)</span><span class="op">$</span><span class="st">"1"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-similarity-matrices-sorted-by-cluster-label">Visualize similarity matrices sorted by cluster label<a class="anchor" aria-label="anchor" href="#visualize-similarity-matrices-sorted-by-cluster-label"></a>
</h2>
<p><code>similarity_matrix_heatmap</code> is a wrapper for
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap</a></code>, but with some convenient default
transformations and parameters for viewing a similarity matrix.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span>,</span>
<span>    heatmap_height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    heatmap_width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Sorting by cluster solution.</span></span></code></pre>
<p><img src="similarity_matrix_heatmap_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>The default transformations include plotting log(Similarity) rather
than the default similarity matrix as well as rescaling the diagonal of
the matrix to the average value of the off-diagonals. Additionally, the
similarity matrix gets reordered according to the provided cluster
solution. Here’s what the same similarity matrix looks like without
those transformations:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    scale_diag <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    log_graph <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    heatmap_height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    heatmap_width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="similarity_matrix_heatmap_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="exporting-heatmaps">Exporting heatmaps<a class="anchor" aria-label="anchor" href="#exporting-heatmaps"></a>
</h2>
<p>Here’s an example of how you can save this heatmap (or any other
heatmap created by <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap</a></code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span></span>
<span>    <span class="st">"my_heatmap.png"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">300</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"px"</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="annotations">Annotations<a class="anchor" aria-label="anchor" href="#annotations"></a>
</h2>
<p>One piece of functionality provided by
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap</a></code> is the ability to supply visual
annotations along the rows and columns of a heatmap.</p>
<p>You can always build annotations using the standard approaches
outline in the <a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/index.html" class="external-link">ComplexHeatmap
Complete Reference</a>. In addition to that, this package offers some
convenient functionality to specify regular heatmap annotations and
barplot annotations directly through a provided dataframe or data_list
(or both).</p>
<p>In the example below, we make use of data supplied through a
data_list.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Providing the data for the annotations through a data_list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span>,</span>
<span>    scale_diag <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    log_graph <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Diagnosis"</span> <span class="op">=</span> <span class="st">"diagnosis"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Gender"</span> <span class="op">=</span> <span class="st">"gender"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Age"</span> <span class="op">=</span> <span class="st">"age"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    heatmap_height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    heatmap_width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Sorting by cluster solution.</span></span></code></pre>
<p><img src="similarity_matrix_heatmap_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>The chunk below gives an identical plot, but using a dataframe
instead of a data_list.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_dl.html">collapse_dl</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span> <span class="co"># Pools all the data in a data_list to a single df</span></span>
<span></span>
<span><span class="co"># Providing the data for the annotations through an external dataframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span>,</span>
<span>    scale_diag <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    log_graph <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Diagnosis"</span> <span class="op">=</span> <span class="st">"diagnosis"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Gender"</span> <span class="op">=</span> <span class="st">"gender"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Age"</span> <span class="op">=</span> <span class="st">"age"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We needed to call <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> because by default,
<code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap</a></code> randomly generates colours for
heatmap annotations. You can instead specify your own colours using the
<code>annotation_colours</code> parameter:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span>,</span>
<span>    scale_diag <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    log_graph <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    data_list <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>    left_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Diagnosis"</span> <span class="op">=</span> <span class="st">"diagnosis"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_hm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Gender"</span> <span class="op">=</span> <span class="st">"gender"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    top_bar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"Age"</span> <span class="op">=</span> <span class="st">"age"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        Diagnosis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"definite asthma"</span> <span class="op">=</span> <span class="st">"red3"</span>,</span>
<span>            <span class="st">"possible asthma"</span> <span class="op">=</span> <span class="st">"pink1"</span>,</span>
<span>            <span class="st">"no asthma"</span> <span class="op">=</span> <span class="st">"bisque1"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        Gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"female"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            <span class="st">"male"</span> <span class="op">=</span> <span class="st">"lightgreen"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    heatmap_height <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>    heatmap_width <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"cm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Sorting by cluster solution.</span></span></code></pre>
<p><img src="similarity_matrix_heatmap_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>The colours <code>red3</code>, <code>pink1</code>, etc. are built-in
R colours that you can browse by calling <code><a href="https://rdrr.io/r/grDevices/colors.html" class="external-link">colours()</a></code>.</p>
<p>For reference, the code below shows how you would achieve these
annotations using standard <code>ComplexHeatmap</code> syntax.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse_dl.html">collapse_dl</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="va">order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">cluster_solution</span>, index.return <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="st">"ix"</span></span>
<span><span class="va">merged_df</span> <span class="op">&lt;-</span> <span class="va">merged_df</span><span class="op">[</span><span class="va">order</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">top_annotations</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html" class="external-link">HeatmapAnnotation</a></span><span class="op">(</span></span>
<span>    Age <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_barplot.html" class="external-link">anno_barplot</a></span><span class="op">(</span><span class="va">merged_df</span><span class="op">$</span><span class="st">"age"</span><span class="op">)</span>,</span>
<span>    Gender <span class="op">=</span> <span class="va">merged_df</span><span class="op">$</span><span class="st">"gender"</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        Gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"female"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>            <span class="st">"male"</span> <span class="op">=</span> <span class="st">"lightgreen"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    show_legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">left_annotations</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html" class="external-link">rowAnnotation</a></span><span class="op">(</span></span>
<span>    Diagnosis <span class="op">=</span> <span class="va">merged_df</span><span class="op">$</span><span class="st">"diagnosis"</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        Diagnosis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"definite asthma"</span> <span class="op">=</span> <span class="st">"red3"</span>,</span>
<span>            <span class="st">"possible asthma"</span> <span class="op">=</span> <span class="st">"pink1"</span>,</span>
<span>            <span class="st">"no asthma"</span> <span class="op">=</span> <span class="st">"bisque1"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    show_legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/similarity_matrix_heatmap.html">similarity_matrix_heatmap</a></span><span class="op">(</span></span>
<span>    similarity_matrix <span class="op">=</span> <span class="va">similarity_matrix</span>,</span>
<span>    cluster_solution <span class="op">=</span> <span class="va">cluster_solution</span>,</span>
<span>    scale_diag <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    log_graph <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">df</span>,</span>
<span>    top_annotation <span class="op">=</span> <span class="va">top_annotations</span>,</span>
<span>    left_annotation <span class="op">=</span> <span class="va">left_annotations</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Take a look at the <a href="https://jokergoo.github.io/ComplexHeatmap-reference/book/index.html" class="external-link">ComplexHeatmap
Complete Reference</a> to learn more about what is possible with this
package.</p>
</div>
<div class="section level2">
<h2 id="more-on-sorting">More on sorting<a class="anchor" aria-label="anchor" href="#more-on-sorting"></a>
</h2>
<p>Be aware that the ordering of both your data and your similarity
matrix will be influenced if you supply values for the
<code>cluster_solution</code> or <code>order</code> parameters. If you
don’t think your data is lining up properly, consider manually making
sure your <code>similarity_matrix</code> rows and columns are sorted to
your preference (e.g., based on cluster) and that the order of your data
matches. This will be easier to do with a <code>dataframe</code> than
with a <code>data_list</code>, as the <code>data_list</code> forces
patients to be sorted by their unique IDs upon generation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Prashanth Velayudhan, Nicholas Chan, Xiaoqiao Xu, Prajkta Kallurkar, Shihao Ma, Stephanie H Ameis, Ana Patricia Balbon, Adam Taback, Brian Cox, Anna Goldenberg, Bo Wang, Linda Hiraki, Anne L Wheeler, Jasbir Dhaliwal, Colin Hawco, Lauren Erdman.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
